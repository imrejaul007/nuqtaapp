<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nuqta Financial Model 2026 - Complete Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: white;
            min-height: 100vh;
            padding: 0;
        }

        .container {
            max-width: 100%;
            margin: 0;
            background: white;
            border-radius: 0;
            box-shadow: none;
            overflow: visible;
        }

        .header {
            display: none; /* Hidden when in iframe - parent page has header */
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .tabs {
            display: none; /* Hidden when in iframe - parent page has tabs */
        }

        .tab {
            padding: 15px 20px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 0.95rem;
            font-weight: 600;
            color: #495057;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .content {
            padding: 20px;
            max-height: 100%;
            overflow-y: auto;
        }

        .sheet {
            display: none;
        }

        .sheet.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .assumptions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .assumption-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .assumption-card label {
            display: block;
            font-weight: 600;
            margin-bottom: 6px;
            color: #2d3748;
            font-size: 0.85rem;
        }

        .assumption-card input, .assumption-card select {
            width: 100%;
            padding: 10px;
            border: 2px solid #cbd5e0;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
        }

        .assumption-card input:focus, .assumption-card select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .assumption-card .unit {
            display: inline-block;
            margin-top: 5px;
            color: #718096;
            font-size: 0.8rem;
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: white;
            padding: 15px;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            text-align: center;
            transition: all 0.3s;
        }

        .metric-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .metric-card .label {
            font-size: 0.75rem;
            color: #718096;
            margin-bottom: 6px;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .metric-card .value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 3px;
        }

        .metric-card .subtext {
            font-size: 0.7rem;
            color: #a0aec0;
        }

        .metric-card.success {
            border-color: #48bb78;
            background: linear-gradient(135deg, #f0fff4 0%, #c6f6d5 100%);
        }

        .metric-card.success .value {
            color: #22543d;
        }

        .metric-card.warning {
            border-color: #ed8936;
            background: linear-gradient(135deg, #fffaf0 0%, #feebc8 100%);
        }

        .metric-card.warning .value {
            color: #7c2d12;
        }

        .metric-card.danger {
            border-color: #f56565;
            background: linear-gradient(135deg, #fff5f5 0%, #fed7d7 100%);
        }

        .metric-card.danger .value {
            color: #742a2a;
        }

        .table-container {
            overflow-x: auto;
            margin-bottom: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            font-size: 0.9rem;
        }

        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        th {
            padding: 12px 10px;
            text-align: left;
            font-weight: 600;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            padding: 10px;
            border-bottom: 1px solid #e2e8f0;
        }

        tbody tr:hover {
            background: #f7fafc;
        }

        .section-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: #2d3748;
            padding-bottom: 8px;
            border-bottom: 3px solid #667eea;
        }

        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .alert-info {
            background: #ebf8ff;
            border-left: 4px solid #3182ce;
            color: #2c5282;
        }

        .alert-warning {
            background: #fffaf0;
            border-left: 4px solid #ed8936;
            color: #7c2d12;
        }

        .alert-success {
            background: #f0fff4;
            border-left: 4px solid #48bb78;
            color: #22543d;
        }

        .alert-danger {
            background: #fff5f5;
            border-left: 4px solid #f56565;
            color: #742a2a;
        }

        .highlight {
            background: #fef5e7;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }

        /* Quick Testing Panel */
        .test-panel {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            margin: 0 0 20px 0;
            border-radius: 0;
        }

        .test-panel-title {
            color: white;
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .scenario-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .scenario-btn {
            padding: 12px 20px;
            border: 2px solid white;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .scenario-btn:hover {
            background: white;
            color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .scenario-btn.active {
            background: white;
            color: #667eea;
            border-color: #fbbf24;
            box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.3);
        }

        .scenario-btn .amount {
            font-size: 1.1rem;
            font-weight: 700;
        }

        .scenario-btn .label {
            font-size: 0.75rem;
            opacity: 0.9;
        }

        .quick-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 8px;
        }

        .quick-input {
            display: flex;
            flex-direction: column;
        }

        .quick-input label {
            font-size: 0.8rem;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 5px;
        }

        .quick-input input {
            padding: 8px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 0.95rem;
            transition: all 0.3s;
        }

        .quick-input input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Executive Summary Dashboard */
        .executive-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
            transition: all 0.3s;
            cursor: pointer;
        }

        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .summary-card.positive {
            border-left-color: #48bb78;
            background: linear-gradient(135deg, #f0fff4 0%, #c6f6d5 100%);
        }

        .summary-card.negative {
            border-left-color: #f56565;
            background: linear-gradient(135deg, #fff5f5 0%, #fed7d7 100%);
        }

        .summary-card.warning {
            border-left-color: #ed8936;
            background: linear-gradient(135deg, #fffaf0 0%, #feebc8 100%);
        }

        .summary-card .card-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            font-weight: 600;
            color: #718096;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }

        .summary-card .card-value {
            font-size: 2rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .summary-card .card-change {
            font-size: 0.85rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .summary-card .card-change.up {
            color: #22543d;
        }

        .summary-card .card-change.down {
            color: #742a2a;
        }

        /* Change Highlighting in Tables */
        td.changed {
            position: relative;
            animation: highlightChange 1s ease-out;
        }

        td.changed::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(251, 191, 36, 0.2);
            pointer-events: none;
        }

        @keyframes highlightChange {
            0% { background: #fef3c7; }
            100% { background: transparent; }
        }

        td.increased {
            color: #22543d;
            font-weight: 600;
        }

        td.decreased {
            color: #742a2a;
            font-weight: 600;
        }

        /* Comparison Toggle */
        .comparison-toggle {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .toggle-label {
            font-weight: 600;
            color: #2d3748;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: #cbd5e0;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .toggle-switch.active {
            background: #667eea;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .toggle-switch.active::after {
            left: 33px;
        }

        /* Enhanced Table Styling */
        .enhanced-table {
            position: relative;
        }

        .enhanced-table thead th {
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .metric-row {
            transition: all 0.2s;
        }

        .metric-row:hover {
            background: #edf2f7 !important;
            transform: scale(1.01);
        }

        .section-header-row {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%) !important;
            color: white !important;
        }

        .section-header-row td {
            color: white !important;
            font-weight: 700 !important;
            padding: 12px 10px !important;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Loading Indicator */
        .calculating-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .calculating-overlay.active {
            display: flex;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }

            .assumptions-grid,
            .metric-grid {
                grid-template-columns: 1fr;
            }

            .content {
                padding: 15px;
            }
        }

        .subsection {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px dashed #e2e8f0;
        }

        .subsection-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 15px;
        }

        /* Visual Analytics Dashboard */
        .charts-dashboard {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
            border-radius: 16px;
            padding: 24px;
            margin: 32px 0;
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        .section-header {
            text-align: center;
            margin-bottom: 28px;
        }

        .charts-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #667eea;
            margin: 0 0 8px 0;
        }

        .charts-subtitle {
            font-size: 0.95rem;
            color: #64748b;
            margin: 0;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .chart-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .chart-card:hover {
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.15);
            transform: translateY(-2px);
        }

        .chart-header {
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid #f1f5f9;
        }

        .chart-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 4px;
        }

        .chart-subtitle {
            font-size: 0.85rem;
            color: #64748b;
        }

        .chart-legend {
            display: flex;
            gap: 16px;
            margin-top: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            color: #475569;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .legend-dot.blue {
            background: #3b82f6;
        }

        .legend-dot.green {
            background: #22c55e;
        }

        .legend-dot.purple {
            background: #a855f7;
        }

        .legend-dot.orange {
            background: #f97316;
        }

        .legend-dot.pink {
            background: #ec4899;
        }

        .chart-container {
            width: 100%;
            min-height: 200px;
            position: relative;
        }

        .chart-container svg {
            width: 100%;
            height: auto;
            display: block;
        }

        .donut-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 250px;
        }

        .donut-container svg {
            max-width: 250px;
        }

        /* Chart Elements */
        .chart-line {
            fill: none;
            stroke-width: 2.5;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .chart-area {
            opacity: 0.1;
        }

        .chart-dot {
            r: 4;
            fill: white;
            stroke-width: 2;
        }

        .chart-grid-line {
            stroke: #e2e8f0;
            stroke-width: 1;
            stroke-dasharray: 4 4;
        }

        .chart-axis {
            stroke: #cbd5e1;
            stroke-width: 1;
        }

        .chart-label {
            font-size: 11px;
            fill: #64748b;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        /* Revenue Bar Chart */
        .revenue-bar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            padding: 0 12px;
            color: white;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.2);
        }

        .revenue-bar:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }

        .revenue-bar-label {
            flex: 0 0 180px;
            font-weight: 600;
        }

        .revenue-bar-fill {
            flex: 1;
            background: rgba(255, 255, 255, 0.2);
            height: 6px;
            border-radius: 3px;
            margin: 0 12px;
            position: relative;
            overflow: hidden;
        }

        .revenue-bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: white;
            border-radius: 3px;
            width: var(--fill-width, 0%);
            transition: width 1s ease-out;
        }

        .revenue-bar-value {
            font-weight: 700;
            min-width: 80px;
            text-align: right;
        }

        /* Mobile Responsive */
        @media (max-width: 1024px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }

            .charts-dashboard {
                padding: 20px;
                margin: 24px 0;
            }
        }

        @media (max-width: 640px) {
            .charts-title {
                font-size: 1.4rem;
            }

            .chart-card {
                padding: 16px;
            }

            .revenue-bar {
                flex-direction: column;
                align-items: flex-start;
                height: auto;
                padding: 10px;
                gap: 6px;
            }

            .revenue-bar-label {
                flex: none;
                width: 100%;
            }

            .revenue-bar-fill {
                width: 100%;
                margin: 0;
            }

            .revenue-bar-value {
                width: 100%;
                text-align: left;
            }

            .chart-legend {
                flex-wrap: wrap;
                gap: 8px;
            }

            .donut-container svg {
                max-width: 200px;
            }
        }

        /* Loading Animation */
        @keyframes pulse {
            0%, 100% {
                opacity: 0.5;
            }
            50% {
                opacity: 1;
            }
        }

        .chart-loading {
            animation: pulse 1.5s ease-in-out infinite;
        }

        /* Collapsible Sections for Mobile */
        .collapsible-section {
            margin: 20px 0;
        }

        .collapsible-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 14px 18px;
            cursor: pointer;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .collapsible-header:hover {
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .collapsible-header::after {
            content: '‚ñº';
            transition: transform 0.3s ease;
        }

        .collapsible-header.collapsed::after {
            transform: rotate(-90deg);
        }

        .collapsible-content {
            max-height: 5000px;
            overflow: hidden;
            transition: max-height 0.4s ease;
        }

        .collapsible-content.collapsed {
            max-height: 0;
        }

        /* Table Mobile Enhancements */
        @media (max-width: 768px) {
            .table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .enhanced-table table {
                min-width: 800px;
            }

            .enhanced-table th:first-child,
            .enhanced-table td:first-child {
                position: sticky;
                left: 0;
                background: white;
                z-index: 2;
                box-shadow: 2px 0 4px rgba(0, 0, 0, 0.05);
            }

            .enhanced-table thead th:first-child {
                z-index: 3;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Nuqta Financial Model 2026 - Complete Edition</h1>
            <p>All 70+ Parameters | Advanced SaaS Metrics | Cash Flow Tracking | AED Currency</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showSheet('h1-monthly')">üìä H1 Monthly</button>
            <button class="tab" onclick="showSheet('h2-monthly')">üìÖ H2 Monthly</button>
            <button class="tab" onclick="showSheet('h3-monthly')">üìÖ H3 Monthly</button>
            <button class="tab" onclick="showSheet('dashboard')">üìà Dashboard</button>
            <button class="tab" onclick="showSheet('assumptions')">üéØ Assumptions</button>
            <button class="tab" onclick="showSheet('advanced-metrics')">üìä Advanced Metrics</button>
            <button class="tab" onclick="showSheet('cash-flow')">üíµ Cash Flow</button>
            <button class="tab" onclick="showSheet('income')">üí∞ P&L</button>
            <button class="tab" onclick="showSheet('sensitivity')">üîÑ Sensitivity</button>
        </div>

        <div class="content">
            <!-- DASHBOARD SHEET -->
            <div id="dashboard" class="sheet">
                <h2 class="section-title">Executive Dashboard</h2>

                <div class="alert alert-success">
                    <strong>üéØ H1 Target (~5 months, $200K Tranche 1):</strong> 5,000 MAU (conservative) ‚Ä¢ 250 Merchants (minimum) ‚Ä¢ Launch: Feb 28, 2026 ‚Ä¢ Tranche 2 at milestones: 10 merchants, 1K MAU, CTO hired
                </div>

                <div class="alert alert-info" style="margin-top: 10px;">
                    <strong>üìä Funding Structure:</strong> $400K total at $5M cap | Tranche 1: $200K (now) | Tranche 2: $200K (at milestones) |
                    <a href="/master-roadmap" style="color: #667eea; font-weight: 600; text-decoration: underline;">View Master Roadmap ‚Üí</a>
                </div>

                <div class="alert alert-warning" style="margin-top: 10px; background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-left: 4px solid #f59e0b;">
                    <strong>‚ö†Ô∏è Budget Allocation:</strong> 50-60% Marketing (user/merchant acquisition) | 20-30% Salaries (founder, co-founder, key hires) | 10-20% Tech/Ops. Flexible formula adjusts based on funding received. CAC assumptions (AED 35 baseline) require validation in first 90 days.
                </div>

                <h3 class="subsection-title">Key Performance Indicators</h3>
                <div class="metric-grid">
                    <div class="metric-card success">
                        <div class="label">LTV:CAC Ratio</div>
                        <div class="value" id="dash-ltvcac">10.3x</div>
                        <div class="subtext">Target: ‚â•8x</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">CAC Payback</div>
                        <div class="value" id="dash-payback">1.2</div>
                        <div class="subtext">months</div>
                    </div>

                    <div class="metric-card success">
                        <div class="label">Gross Margin</div>
                        <div class="value" id="dash-gross-margin">100%</div>
                        <div class="subtext">Digital product</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Burn Multiple</div>
                        <div class="value" id="dash-burn-multiple">2.7</div>
                        <div class="subtext">Lower is better</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Magic Number</div>
                        <div class="value" id="dash-magic-number">0.8</div>
                        <div class="subtext">Sales efficiency</div>
                    </div>

                    <div class="metric-card warning">
                        <div class="label">Monthly Burn</div>
                        <div class="value" id="dash-burn">AED 121K</div>
                        <div class="subtext">8-10mo runway</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">MRR (H1 End)</div>
                        <div class="value" id="dash-mrr">AED 83K</div>
                        <div class="subtext">Monthly recurring</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">ARR Run Rate</div>
                        <div class="value" id="dash-arr">AED 996K</div>
                        <div class="subtext">MRR √ó 12</div>
                    </div>
                </div>

                <h3 class="subsection-title">Unit Economics</h3>
                <div class="metric-grid">
                    <div class="metric-card">
                        <div class="label">ARPU (Monthly)</div>
                        <div class="value" id="dash-arpu">AED 30</div>
                        <div class="subtext">Revenue per MAU</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Contribution Margin</div>
                        <div class="value" id="dash-cm">AED 30</div>
                        <div class="subtext">ARPU - Var Cost</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Break-even MAU</div>
                        <div class="value" id="dash-breakeven-mau">4,033</div>
                        <div class="subtext">Fixed √∑ CM</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">GMV per MAU</div>
                        <div class="value" id="dash-gmv-mau">AED 400</div>
                        <div class="subtext">AOV √ó Frequency</div>
                    </div>
                </div>

                <h3 class="subsection-title">Growth Metrics</h3>
                <div class="metric-grid">
                    <div class="metric-card">
                        <div class="label">CMGR (H1)</div>
                        <div class="value" id="dash-cmgr">56%</div>
                        <div class="subtext">Compound monthly</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">User Churn</div>
                        <div class="value" id="dash-user-churn">8.3%</div>
                        <div class="subtext">Monthly average</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Merchant Churn</div>
                        <div class="value" id="dash-merchant-churn">5%</div>
                        <div class="subtext">Monthly logo churn</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">NRR (Projected)</div>
                        <div class="value" id="dash-nrr">92%</div>
                        <div class="subtext">Net revenue retention</div>
                    </div>
                </div>

                <!-- Cash Runway Alert -->
                <div id="cash-runway-alert" style="display: none; margin-top: 20px;"></div>

                <!-- Budget Freeze Alert -->
                <div id="budget-freeze-alert" style="display: none; margin-top: 10px;"></div>
            </div>

            <!-- ASSUMPTIONS SHEET -->
            <div id="assumptions" class="sheet">
                <h2 class="section-title">Core Assumptions (Editable)</h2>

                <div class="alert alert-info">
                    <strong>üí° Interactive Model:</strong> Change any assumption and watch all 70+ metrics update automatically!
                </div>

                <h3 class="subsection-title">User Economics</h3>
                <div class="assumptions-grid">
                    <div class="assumption-card">
                        <label for="aov">Average Order Value (AOV)</label>
                        <input type="number" id="aov" value="100" step="10" oninput="updateAll()">
                        <span class="unit">AED per transaction</span>
                    </div>

                    <div class="assumption-card">
                        <label for="frequency">Transaction Frequency</label>
                        <input type="number" id="frequency" value="4" step="0.5" oninput="updateAll()">
                        <span class="unit">transactions/user/month</span>
                    </div>

                    <div class="assumption-card">
                        <label for="cac">Blended CAC</label>
                        <input type="number" id="cac" value="35" step="5" oninput="updateAll()">
                        <span class="unit">AED per user</span>
                    </div>

                    <div class="assumption-card">
                        <label for="retention-months">Average Retention</label>
                        <input type="number" id="retention-months" value="24" step="1" min="1" oninput="updateAll()">
                        <span class="unit">months</span>
                    </div>

                    <div class="assumption-card">
                        <label for="activation-rate">Activation Rate</label>
                        <input type="number" id="activation-rate" value="40" step="5" min="0" max="100" oninput="updateAll()">
                        <span class="unit">%</span>
                    </div>

                    <div class="assumption-card">
                        <label for="user-churn">Monthly User Churn</label>
                        <input type="number" id="user-churn" value="5" step="0.5" min="0" max="100" oninput="updateAll()">
                        <span class="unit">%</span>
                    </div>
                </div>

                <h3 class="subsection-title">Revenue Model (7 Streams)</h3>

                <div class="alert alert-info">
                    <strong>üí∞ Revenue Breakdown:</strong> Configure all 7 revenue streams. Total revenue is calculated from GMV √ó applicable rates + subscriptions.
                </div>

                <div class="subsection-title" style="font-size: 1rem; margin-top: 20px; margin-bottom: 10px;">1Ô∏è‚É£ Commission on Sales (Base + Social Sharing)</div>
                <div class="assumptions-grid">
                    <div class="assumption-card">
                        <label for="base-commission">Base Commission Rate</label>
                        <input type="number" id="base-commission" value="5" step="0.5" min="0" max="100" oninput="updateAll()">
                        <span class="unit">% of GMV</span>
                    </div>

                    <div class="assumption-card">
                        <label for="no-share-bonus">No-Share Bonus Commission</label>
                        <input type="number" id="no-share-bonus" value="5" step="0.5" min="0" max="100" oninput="updateAll()">
                        <span class="unit">% (if user doesn't share on social)</span>
                    </div>

                    <div class="assumption-card">
                        <label for="no-share-rate">% of Users NOT Sharing</label>
                        <input type="number" id="no-share-rate" value="40" step="5" min="0" max="100" oninput="updateAll()">
                        <span class="unit">% (avg users who don't share)</span>
                    </div>

                    <div class="assumption-card">
                        <label for="avg-commission-rate">Avg Commission Rate (Auto)</label>
                        <input type="number" id="avg-commission-rate" value="7" step="0.1" readonly style="background: #f0f0f0;">
                        <span class="unit">% (weighted average)</span>
                    </div>
                </div>

                <div class="subsection-title" style="font-size: 1rem; margin-top: 20px; margin-bottom: 10px;">2Ô∏è‚É£ Promoted Sales (Merchant Ads)</div>
                <div class="assumptions-grid">
                    <div class="assumption-card">
                        <label for="promoted-commission">Promoted Sales Commission</label>
                        <input type="number" id="promoted-commission" value="5" step="0.5" min="0" max="100" oninput="updateAll()">
                        <span class="unit">% of promoted GMV</span>
                    </div>

                    <div class="assumption-card">
                        <label for="promoted-gmv-pct">% of GMV from Promoted Sales</label>
                        <input type="number" id="promoted-gmv-pct" value="30" step="5" min="0" max="100" oninput="updateAll()">
                        <span class="unit">% of total GMV</span>
                    </div>
                </div>

                <div class="subsection-title" style="font-size: 1rem; margin-top: 20px; margin-bottom: 10px;">3Ô∏è‚É£ Business Subscription (Merchant SaaS)</div>
                <div class="assumptions-grid">
                    <div class="assumption-card">
                        <label for="merchant-sub-price">Merchant Subscription (Monthly)</label>
                        <input type="number" id="merchant-sub-price" value="100" step="50" oninput="updateAll()">
                        <span class="unit">AED per merchant/month</span>
                    </div>

                    <div class="assumption-card">
                        <label for="merchant-sub-attach">Merchant Subscription Attach Rate</label>
                        <input type="number" id="merchant-sub-attach" value="20" step="5" min="0" max="100" oninput="updateAll()">
                        <span class="unit">% of merchants paying</span>
                    </div>
                </div>

                <div class="subsection-title" style="font-size: 1rem; margin-top: 20px; margin-bottom: 10px;">4Ô∏è‚É£ Cash Store Affiliates Commission</div>
                <div class="assumptions-grid">
                    <div class="assumption-card">
                        <label for="affiliate-commission">Affiliate Commission Rate</label>
                        <input type="number" id="affiliate-commission" value="3" step="0.5" min="0" max="100" oninput="updateAll()">
                        <span class="unit">% of affiliate GMV</span>
                    </div>

                    <div class="assumption-card">
                        <label for="affiliate-gmv-pct">% of GMV from Affiliates</label>
                        <input type="number" id="affiliate-gmv-pct" value="10" step="5" min="0" max="100" oninput="updateAll()">
                        <span class="unit">% of total GMV</span>
                    </div>
                </div>

                <div class="alert alert-success" style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); border-left: 4px solid #10b981; margin: 20px 0; padding: 16px; border-radius: 8px;">
                    <div style="display: flex; align-items: start; gap: 10px;">
                        <span style="font-size: 20px;">üéÅ</span>
                        <div>
                            <strong style="color: #065f46; font-size: 1rem;">Year 1 FREE Policy</strong>
                            <p style="color: #047857; margin: 6px 0 0 0; font-size: 0.9rem; line-height: 1.5;">
                                Streams 5-7 (User Subscriptions, Finance Revenue, B2B Commission) are <strong>FREE for the first 12 months</strong> to drive adoption and build loyalty. Revenue kicks in from Month 13+ once the platform has proven value. This aligns with our merchant-led positioning in H1.
                            </p>
                        </div>
                    </div>
                </div>

                <div class="subsection-title" style="font-size: 1rem; margin-top: 20px; margin-bottom: 10px;">5Ô∏è‚É£ User Subscription (Premium Features) <span style="color: #10b981; font-size: 0.85rem; font-weight: 600;">[FREE YEAR 1]</span></div>
                <div class="assumptions-grid">
                    <div class="assumption-card">
                        <label for="user-sub-price">User Subscription (Monthly)</label>
                        <input type="number" id="user-sub-price" value="1" step="5" oninput="updateAll()">
                        <span class="unit">AED per user/month</span>
                    </div>

                    <div class="assumption-card">
                        <label for="user-sub-attach">User Subscription Attach Rate</label>
                        <input type="number" id="user-sub-attach" value="5" step="1" min="0" max="100" oninput="updateAll()">
                        <span class="unit">% of MAU paying</span>
                    </div>
                </div>

                <div class="subsection-title" style="font-size: 1rem; margin-top: 20px; margin-bottom: 10px;">6Ô∏è‚É£ Finance (BNPL / Lending) <span style="color: #10b981; font-size: 0.85rem; font-weight: 600;">[FREE YEAR 1]</span></div>
                <div class="assumptions-grid">
                    <div class="assumption-card">
                        <label for="finance-revenue-per-user">Finance Revenue per MAU</label>
                        <input type="number" id="finance-revenue-per-user" value="10" step="1" oninput="updateAll()">
                        <span class="unit">AED per MAU/month</span>
                    </div>

                    <div class="assumption-card">
                        <label for="finance-attach">Finance Attach Rate</label>
                        <input type="number" id="finance-attach" value="15" step="5" min="0" max="100" oninput="updateAll()">
                        <span class="unit">% of MAU using finance</span>
                    </div>
                </div>

                <div class="subsection-title" style="font-size: 1rem; margin-top: 20px; margin-bottom: 10px;">7Ô∏è‚É£ B2B Buying (Bulk Orders) <span style="color: #10b981; font-size: 0.85rem; font-weight: 600;">[FREE YEAR 1]</span></div>
                <div class="assumptions-grid">
                    <div class="assumption-card">
                        <label for="b2b-commission">B2B Commission Rate</label>
                        <input type="number" id="b2b-commission" value="3" step="0.5" min="0" max="100" oninput="updateAll()">
                        <span class="unit">% of B2B GMV</span>
                    </div>

                    <div class="assumption-card">
                        <label for="b2b-gmv-pct">% of GMV from B2B</label>
                        <input type="number" id="b2b-gmv-pct" value="5" step="1" min="0" max="100" oninput="updateAll()">
                        <span class="unit">% of total GMV</span>
                    </div>
                </div>

                <div class="subsection-title" style="font-size: 1rem; margin-top: 20px; margin-bottom: 10px;">üìä Total Revenue Summary (Auto-Calculated)</div>
                <div class="assumptions-grid">
                    <div class="assumption-card">
                        <label for="total-take-rate">Blended Take Rate (Auto)</label>
                        <input type="number" id="total-take-rate" value="0" step="0.1" readonly style="background: #f0f0f0;">
                        <span class="unit">% of GMV</span>
                    </div>

                    <div class="assumption-card">
                        <label for="monthly-rpu">Monthly RPU (Auto)</label>
                        <input type="number" id="monthly-rpu" value="30" readonly style="background: #f0f0f0;">
                        <span class="unit">AED (total revenue per MAU)</span>
                    </div>
                </div>

                <h3 class="subsection-title">Budget Allocation & Cost Structure</h3>

                <div class="alert alert-info" style="margin-bottom: 15px;">
                    <strong>üí∞ Flexible Budget Formula:</strong> Budget allocation follows your preferences:<br>
                    <strong>Marketing:</strong> 50-60% (User & Merchant Acquisition)<br>
                    <strong>Salaries/Team:</strong> 20-30% (Founder, Co-founder, Key Hires)<br>
                    <strong>Tech & Ops:</strong> 10-20% (Infrastructure, Operations, Rent)
                </div>

                <div class="assumptions-grid">
                    <div class="assumption-card" style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);">
                        <label for="marketing-pct">Marketing Budget %</label>
                        <input type="number" id="marketing-pct" value="55" step="5" min="0" max="100" oninput="updateAll()">
                        <span class="unit">% of monthly budget (Target: 50-60%)</span>
                    </div>

                    <div class="assumption-card" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);">
                        <label for="salary-pct">Salaries/Team Budget %</label>
                        <input type="number" id="salary-pct" value="25" step="5" min="0" max="100" oninput="updateAll()">
                        <span class="unit">% of monthly budget (Target: 20-30%)</span>
                    </div>

                    <div class="assumption-card" style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);">
                        <label for="techops-pct">Tech & Ops Budget %</label>
                        <input type="number" id="techops-pct" value="20" step="5" min="0" max="100" oninput="updateAll()">
                        <span class="unit">% of monthly budget (Target: 10-20%)</span>
                    </div>

                    <div class="assumption-card">
                        <label for="customer-acq-pct">Customer Acquisition % of Marketing</label>
                        <input type="number" id="customer-acq-pct" value="60" step="5" min="0" max="100" oninput="updateAll()">
                        <span class="unit">%</span>
                    </div>

                    <div class="assumption-card">
                        <label for="merchant-acq-pct">Merchant Acquisition % of Marketing</label>
                        <input type="number" id="merchant-acq-pct" value="40" step="5" min="0" max="100" oninput="updateAll()">
                        <span class="unit">%</span>
                    </div>

                    <div class="assumption-card">
                        <label for="rent-fixed">Rent (Fixed Monthly)</label>
                        <input type="number" id="rent-fixed" value="5000" step="500" oninput="updateAll()">
                        <span class="unit">AED</span>
                    </div>

                    <div class="assumption-card">
                        <label for="fixed-monthly-budget">Fixed Monthly Budget (Auto-Calculated)</label>
                        <input type="number" id="fixed-monthly-budget" value="100000" step="1000" readonly style="background-color: #f0f0f0; cursor: not-allowed;">
                        <span class="unit">AED/month (= Initial Budget √∑ Target Runway)</span>
                    </div>
                </div>

                <h3 class="subsection-title">Merchant Metrics</h3>
                <div class="assumptions-grid">
                    <div class="assumption-card">
                        <label for="merchant-churn">Merchant Churn Rate</label>
                        <input type="number" id="merchant-churn" value="5" step="1" min="0" max="100" oninput="updateAll()">
                        <span class="unit">% monthly</span>
                    </div>

                    <div class="assumption-card">
                        <label for="cam">CAM (Merchant Acquisition Cost)</label>
                        <input type="number" id="cam" value="100" step="100" oninput="updateAll()">
                        <span class="unit">AED per merchant</span>
                    </div>
                </div>

                <h3 class="subsection-title">Initial Funding & Cash</h3>
                <div class="alert alert-success" style="margin-bottom: 15px; background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); border-left: 4px solid #10b981;">
                    <strong>üí∞ Tranched Funding Structure:</strong><br>
                    <strong>Tranche 1:</strong> $200K (AED 734K) - Immediately upon funding<br>
                    <strong>Tranche 2:</strong> $200K (AED 734K) - Upon milestones: 10 live merchants, 1,000 MAU, CTO hired<br>
                    <strong>Total Ask:</strong> $400K at $5M valuation cap (SAFE with 20% discount)
                </div>
                <div class="alert alert-info" style="margin-bottom: 15px;">
                    <strong>üí° How It Works:</strong> Monthly Budget = Initial Budget √∑ Target Runway. Formula is flexible - if you have more/less funding, allocations adjust automatically. Launch Date: <strong>Feb 28, 2026</strong>
                </div>
                <div class="assumptions-grid">
                    <div class="assumption-card" style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);">
                        <label for="initial-budget-aed">Tranche 1 Budget (Starting Cash)</label>
                        <input type="number" id="initial-budget-aed" value="734000" step="10000" oninput="updateAll()">
                        <span class="unit">AED ($200K USD @ 3.67 rate) - First tranche</span>
                    </div>

                    <div class="assumption-card">
                        <label for="runway-months">Target Runway</label>
                        <input type="number" id="runway-months" value="5" step="1" min="1" oninput="updateAll()">
                        <span class="unit">months</span>
                    </div>
                </div>

                <h3 class="subsection-title">Additional Funding (Optional)</h3>
                <div class="assumptions-grid">
                    <div class="assumption-card">
                        <label for="funding-m1">Month 1 Additional Funding</label>
                        <input type="number" id="funding-m1" value="0" step="10000" oninput="updateAll()">
                        <span class="unit">AED</span>
                    </div>

                    <div class="assumption-card">
                        <label for="funding-m2">Month 2 Additional Funding</label>
                        <input type="number" id="funding-m2" value="0" step="10000" oninput="updateAll()">
                        <span class="unit">AED</span>
                    </div>

                    <div class="assumption-card">
                        <label for="funding-m3">Month 3 Additional Funding</label>
                        <input type="number" id="funding-m3" value="0" step="10000" oninput="updateAll()">
                        <span class="unit">AED</span>
                    </div>

                    <div class="assumption-card">
                        <label for="funding-m4">Month 4 Additional Funding</label>
                        <input type="number" id="funding-m4" value="0" step="10000" oninput="updateAll()">
                        <span class="unit">AED</span>
                    </div>

                    <div class="assumption-card">
                        <label for="funding-m5">Month 5 Additional Funding</label>
                        <input type="number" id="funding-m5" value="0" step="10000" oninput="updateAll()">
                        <span class="unit">AED</span>
                    </div>

                    <div class="assumption-card">
                        <label for="funding-m6">Month 6 Additional Funding</label>
                        <input type="number" id="funding-m6" value="0" step="10000" oninput="updateAll()">
                        <span class="unit">AED</span>
                    </div>

                    <div class="assumption-card">
                        <label for="funding-m7">Month 7 Additional Funding</label>
                        <input type="number" id="funding-m7" value="0" step="10000" oninput="updateAll()">
                        <span class="unit">AED</span>
                    </div>

                    <div class="assumption-card">
                        <label for="funding-m8">Month 8 Additional Funding</label>
                        <input type="number" id="funding-m8" value="0" step="10000" oninput="updateAll()">
                        <span class="unit">AED</span>
                    </div>

                    <div class="assumption-card">
                        <label for="funding-m9">Month 9 Additional Funding</label>
                        <input type="number" id="funding-m9" value="0" step="10000" oninput="updateAll()">
                        <span class="unit">AED</span>
                    </div>

                    <div class="assumption-card">
                        <label for="funding-m10">Month 10 Additional Funding</label>
                        <input type="number" id="funding-m10" value="0" step="10000" oninput="updateAll()">
                        <span class="unit">AED</span>
                    </div>

                    <div class="assumption-card">
                        <label for="funding-m11">Month 11 Additional Funding</label>
                        <input type="number" id="funding-m11" value="0" step="10000" oninput="updateAll()">
                        <span class="unit">AED</span>
                    </div>

                    <div class="assumption-card">
                        <label for="funding-m12">Month 12 Additional Funding</label>
                        <input type="number" id="funding-m12" value="0" step="10000" oninput="updateAll()">
                        <span class="unit">AED</span>
                    </div>
                </div>

                <h3 class="subsection-title">One-Time Expenses (Optional)</h3>
                <div class="alert alert-info">
                    <strong>üí∏ One-Time Costs:</strong> Add any exceptional expenses for specific months (hiring bonuses, equipment, legal fees, office setup, etc.). These reduce available cash and marketing budget for that month only.
                </div>
                <div class="assumptions-grid">
                    <div class="assumption-card">
                        <label for="expense-m1">Month 1 One-Time Expense</label>
                        <input type="number" id="expense-m1" value="0" step="5000" oninput="updateAll()">
                        <span class="unit">AED</span>
                    </div>

                    <div class="assumption-card">
                        <label for="expense-m2">Month 2 One-Time Expense</label>
                        <input type="number" id="expense-m2" value="0" step="5000" oninput="updateAll()">
                        <span class="unit">AED</span>
                    </div>

                    <div class="assumption-card">
                        <label for="expense-m3">Month 3 One-Time Expense</label>
                        <input type="number" id="expense-m3" value="0" step="5000" oninput="updateAll()">
                        <span class="unit">AED</span>
                    </div>

                    <div class="assumption-card">
                        <label for="expense-m4">Month 4 One-Time Expense</label>
                        <input type="number" id="expense-m4" value="0" step="5000" oninput="updateAll()">
                        <span class="unit">AED</span>
                    </div>

                    <div class="assumption-card">
                        <label for="expense-m5">Month 5 One-Time Expense</label>
                        <input type="number" id="expense-m5" value="0" step="5000" oninput="updateAll()">
                        <span class="unit">AED</span>
                    </div>

                    <div class="assumption-card">
                        <label for="expense-m6">Month 6 One-Time Expense</label>
                        <input type="number" id="expense-m6" value="0" step="5000" oninput="updateAll()">
                        <span class="unit">AED</span>
                    </div>

                    <div class="assumption-card">
                        <label for="expense-m7">Month 7 One-Time Expense</label>
                        <input type="number" id="expense-m7" value="0" step="5000" oninput="updateAll()">
                        <span class="unit">AED</span>
                    </div>

                    <div class="assumption-card">
                        <label for="expense-m8">Month 8 One-Time Expense</label>
                        <input type="number" id="expense-m8" value="0" step="5000" oninput="updateAll()">
                        <span class="unit">AED</span>
                    </div>

                    <div class="assumption-card">
                        <label for="expense-m9">Month 9 One-Time Expense</label>
                        <input type="number" id="expense-m9" value="0" step="5000" oninput="updateAll()">
                        <span class="unit">AED</span>
                    </div>

                    <div class="assumption-card">
                        <label for="expense-m10">Month 10 One-Time Expense</label>
                        <input type="number" id="expense-m10" value="0" step="5000" oninput="updateAll()">
                        <span class="unit">AED</span>
                    </div>

                    <div class="assumption-card">
                        <label for="expense-m11">Month 11 One-Time Expense</label>
                        <input type="number" id="expense-m11" value="0" step="5000" oninput="updateAll()">
                        <span class="unit">AED</span>
                    </div>

                    <div class="assumption-card">
                        <label for="expense-m12">Month 12 One-Time Expense</label>
                        <input type="number" id="expense-m12" value="0" step="5000" oninput="updateAll()">
                        <span class="unit">AED</span>
                    </div>
                </div>

                <h3 class="subsection-title">KPI-Gated Phase Progression</h3>
                <div class="alert alert-info">
                    <strong>üìä Data-Driven Progression:</strong> Phases advance when KPI targets are hit, not based on time. The model continues running each month until the next phase gate is achieved (or max months/cash depletion). Set gates below for H1‚ÜíH2‚ÜíH3‚ÜíPhase2 transitions.
                </div>

                <h4 style="margin-top: 20px; color: #667eea; font-size: 1.1rem;">H1 ‚Üí H2 Gate (Validate Categories) - Conservative Targets</h4>
                <div class="assumptions-grid">
                    <div class="assumption-card" style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);">
                        <label for="h2-gate-mau">MAU Target for H2</label>
                        <input type="number" id="h2-gate-mau" value="5000" step="1000" min="0" oninput="updateAll()">
                        <span class="unit">users (Conservative target)</span>
                    </div>

                    <div class="assumption-card" style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);">
                        <label for="h2-gate-merchants">Merchants Target for H2</label>
                        <input type="number" id="h2-gate-merchants" value="250" step="10" min="0" oninput="updateAll()">
                        <span class="unit">merchants (Minimum target)</span>
                    </div>

                    <div class="assumption-card">
                        <label for="h2-gate-gmv">GMV Target for H2</label>
                        <input type="number" id="h2-gate-gmv" value="10000000" step="1000000" min="0" oninput="updateAll()">
                        <span class="unit">AED (cumulative)</span>
                    </div>

                    <div class="assumption-card">
                        <label for="h2-gate-ltvcac">LTV:CAC Target for H2</label>
                        <input type="number" id="h2-gate-ltvcac" value="10" step="1" min="0" oninput="updateAll()">
                        <span class="unit">ratio (10x = healthy)</span>
                    </div>
                </div>

                <h4 style="margin-top: 20px; color: #667eea; font-size: 1.1rem;">H2 ‚Üí H3 Gate (Scale Categories)</h4>
                <div class="assumptions-grid">
                    <div class="assumption-card">
                        <label for="h3-gate-mau">MAU Target for H3</label>
                        <input type="number" id="h3-gate-mau" value="75000" step="5000" min="0" oninput="updateAll()">
                        <span class="unit">users</span>
                    </div>

                    <div class="assumption-card">
                        <label for="h3-gate-merchants">Merchants Target for H3</label>
                        <input type="number" id="h3-gate-merchants" value="500" step="50" min="0" oninput="updateAll()">
                        <span class="unit">merchants</span>
                    </div>

                    <div class="assumption-card">
                        <label for="h3-gate-gmv">GMV Target for H3</label>
                        <input type="number" id="h3-gate-gmv" value="50000000" step="5000000" min="0" oninput="updateAll()">
                        <span class="unit">AED (cumulative)</span>
                    </div>

                    <div class="assumption-card">
                        <label for="h3-gate-retention">D30 Retention Target for H3</label>
                        <input type="number" id="h3-gate-retention" value="30" step="5" min="0" max="100" oninput="updateAll()">
                        <span class="unit">%</span>
                    </div>
                </div>

                <h4 style="margin-top: 20px; color: #667eea; font-size: 1.1rem;">H3 ‚Üí Phase 2 Gate (B2B Infrastructure)</h4>
                <div class="assumptions-grid">
                    <div class="assumption-card">
                        <label for="phase2-gate-mau">MAU Target for Phase 2</label>
                        <input type="number" id="phase2-gate-mau" value="150000" step="10000" min="0" oninput="updateAll()">
                        <span class="unit">users</span>
                    </div>

                    <div class="assumption-card">
                        <label for="phase2-gate-merchants">Merchants Target for Phase 2</label>
                        <input type="number" id="phase2-gate-merchants" value="1000" step="100" min="0" oninput="updateAll()">
                        <span class="unit">merchants</span>
                    </div>

                    <div class="assumption-card">
                        <label for="phase2-gate-ebitda">EBITDA Margin Target for Phase 2</label>
                        <input type="number" id="phase2-gate-ebitda" value="30" step="5" min="0" max="100" oninput="updateAll()">
                        <span class="unit">%</span>
                    </div>

                    <div class="assumption-card">
                        <label for="phase2-gate-gmv">GMV Target for Phase 2</label>
                        <input type="number" id="phase2-gate-gmv" value="200000000" step="10000000" min="0" oninput="updateAll()">
                        <span class="unit">AED (cumulative)</span>
                    </div>
                </div>

                <h4 style="margin-top: 20px; color: #667eea; font-size: 1.1rem;">Location & Projection Settings</h4>
                <div class="assumptions-grid">
                    <div class="assumption-card">
                        <label for="location-expansion-mau">Location 2 Triggers at MAU</label>
                        <input type="number" id="location-expansion-mau" value="50000" step="5000" min="0" oninput="updateAll()">
                        <span class="unit">users (0 = no expansion)</span>
                    </div>

                    <div class="assumption-card">
                        <label for="max-months">Maximum Projection Months</label>
                        <input type="number" id="max-months" value="36" step="6" min="12" max="60" oninput="updateAll()">
                        <span class="unit">months (continues until gates hit or limit reached)</span>
                    </div>

                    <div class="assumption-card">
                        <label for="support-cost-per-1k">Customer Support Cost per 1K MAU</label>
                        <input type="number" id="support-cost-per-1k" value="2000" step="100" oninput="updateAll()">
                        <span class="unit">AED/month (AED 2/MAU - 1 support agent + chatbot)</span>
                    </div>

                    <div class="assumption-card">
                        <label for="funding-allocation-window">Funding Allocation Window</label>
                        <input type="number" id="funding-allocation-window" value="3" step="1" min="1" max="12" oninput="updateAll()">
                        <span class="unit">months (spread new funding over this period)</span>
                    </div>
                </div>

                <div class="alert alert-info" style="margin-top: 15px;">
                    <strong>üí° Funding Strategy:</strong> When additional funding is received, it's allocated evenly over the next X months (default: 3). This prevents user acquisition spikes and ensures sustainable growth. If new funding arrives during the window, it resets for another X months.
                </div>
            </div>

            <!-- ADVANCED METRICS SHEET -->
            <div id="advanced-metrics" class="sheet">
                <h2 class="section-title">Advanced SaaS Metrics</h2>

                <div class="alert alert-info">
                    <strong>üí° Pro Metrics:</strong> These metrics are auto-calculated based on your assumptions and help evaluate business health at institutional investor level.
                </div>

                <h3 class="subsection-title">üéØ Unit Economics Deep Dive</h3>
                <div class="metric-grid">
                    <div class="metric-card">
                        <div class="label">Annual LTV</div>
                        <div class="value" id="adv-ltv">AED 360</div>
                        <div class="subtext">RPU √ó Retention</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Blended CAC</div>
                        <div class="value" id="adv-cac">AED 35</div>
                        <div class="subtext">User acquisition</div>
                    </div>

                    <div class="metric-card success">
                        <div class="label">LTV:CAC Ratio</div>
                        <div class="value" id="adv-ltvcac">10.3x</div>
                        <div class="subtext">Excellent (‚â•3x)</div>
                    </div>

                    <div class="metric-card success">
                        <div class="label">CAC Payback Period</div>
                        <div class="value" id="adv-cac-payback">1.2</div>
                        <div class="subtext">months</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">ARPU (Monthly)</div>
                        <div class="value" id="adv-arpu">AED 30</div>
                        <div class="subtext">Revenue per active user</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Contribution Margin</div>
                        <div class="value" id="adv-cm">AED 30</div>
                        <div class="subtext">ARPU - Variable Costs</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">CM per User</div>
                        <div class="value" id="adv-cm-per-user">AED 30</div>
                        <div class="subtext">Monthly basis</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Gross Margin</div>
                        <div class="value" id="adv-gross-margin">100%</div>
                        <div class="subtext">Digital product</div>
                    </div>
                </div>

                <h3 class="subsection-title">üí∞ Revenue & Growth Metrics</h3>
                <div class="metric-grid">
                    <div class="metric-card">
                        <div class="label">MRR (Month 5)</div>
                        <div class="value" id="adv-mrr">AED 83K</div>
                        <div class="subtext">Monthly recurring revenue</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">ARR Run Rate</div>
                        <div class="value" id="adv-arr">AED 996K</div>
                        <div class="subtext">MRR √ó 12</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">CMGR (H1)</div>
                        <div class="value" id="adv-cmgr">56%</div>
                        <div class="subtext">Compound monthly growth</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Annual Growth Rate</div>
                        <div class="value" id="adv-annual-growth">650%</div>
                        <div class="subtext">Year-over-year</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Rule of 40</div>
                        <div class="value" id="adv-rule40">N/A</div>
                        <div class="subtext">Growth + Margin (Post-revenue)</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">GMV (H1 Cumulative)</div>
                        <div class="value" id="adv-gmv">AED 2.95M</div>
                        <div class="subtext">5 months total</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Take Rate</div>
                        <div class="value" id="adv-take-rate">7.5%</div>
                        <div class="subtext">Net revenue on GMV</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Net Revenue Retention</div>
                        <div class="value" id="adv-nrr">92%</div>
                        <div class="subtext">1 - Churn rate</div>
                    </div>
                </div>

                <h3 class="subsection-title">üî• Burn & Efficiency Metrics</h3>
                <div class="metric-grid">
                    <div class="metric-card warning">
                        <div class="label">Monthly Burn Rate</div>
                        <div class="value" id="adv-burn">AED 121K</div>
                        <div class="subtext">H1 average</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Burn Multiple</div>
                        <div class="value" id="adv-burn-multiple">2.7</div>
                        <div class="subtext">Net Burn √∑ ARR Growth (Target: <2)</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Magic Number</div>
                        <div class="value" id="adv-magic">0.8</div>
                        <div class="subtext">Sales efficiency (Target: >0.75)</div>
                    </div>

                    <div class="metric-card success">
                        <div class="label">Runway Remaining</div>
                        <div class="value" id="adv-runway">9</div>
                        <div class="subtext">months</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Cash in Hand</div>
                        <div class="value" id="adv-cash">AED 1.10M</div>
                        <div class="subtext">After raise</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Break-even MAU</div>
                        <div class="value" id="adv-breakeven">4,033</div>
                        <div class="subtext">Fixed cost √∑ CM</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Break-even Point</div>
                        <div class="value" id="adv-breakeven-year">Year 4</div>
                        <div class="subtext">Projected profitability</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Months to Breakeven</div>
                        <div class="value" id="adv-months-breakeven">36+</div>
                        <div class="subtext">From H1 start</div>
                    </div>
                </div>

                <h3 class="subsection-title">üìä Cost Structure</h3>
                <div class="metric-grid">
                    <div class="metric-card">
                        <div class="label">Fixed Costs (Monthly)</div>
                        <div class="value" id="adv-fixed-cost">AED 48K</div>
                        <div class="subtext">40% of burn</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Variable Costs (Monthly)</div>
                        <div class="value" id="adv-variable-cost">AED 73K</div>
                        <div class="subtext">60% of burn (mostly CAC)</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Marketing Spend</div>
                        <div class="value" id="adv-marketing">AED 73K</div>
                        <div class="subtext">60% of expenses</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Tech & Infrastructure</div>
                        <div class="value" id="adv-tech">AED 24K</div>
                        <div class="subtext">20% of expenses</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Operations</div>
                        <div class="value" id="adv-ops">AED 24K</div>
                        <div class="subtext">20% of expenses</div>
                    </div>
                </div>

                <h3 class="subsection-title">üë• User & Merchant Metrics</h3>
                <div class="metric-grid">
                    <div class="metric-card">
                        <div class="label">Total Downloads (H1)</div>
                        <div class="value" id="adv-downloads">10,000</div>
                        <div class="subtext">New user signups</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Activation Rate</div>
                        <div class="value" id="adv-activation">30%</div>
                        <div class="subtext">Download ‚Üí Active (Target: 40%)</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Monthly Active Users</div>
                        <div class="value" id="adv-mau">7,366</div>
                        <div class="subtext">Cumulative by Month 5</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">User Churn Rate</div>
                        <div class="value" id="adv-user-churn-display">8.3%</div>
                        <div class="subtext">Monthly average</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Active Merchants</div>
                        <div class="value" id="adv-merchants">215</div>
                        <div class="subtext">Month 5 (Target: 250)</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Merchant Churn (Logo)</div>
                        <div class="value" id="adv-merchant-churn-display">5%</div>
                        <div class="subtext">Monthly rate</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Users per Merchant</div>
                        <div class="value" id="adv-users-per-merchant">34</div>
                        <div class="subtext">MAU √∑ Merchants</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Trans/Merchant/Day</div>
                        <div class="value" id="adv-trans-merchant">5</div>
                        <div class="subtext">Penetration indicator</div>
                    </div>
                </div>

                <h3 class="subsection-title">üåç Market Metrics</h3>
                <div class="metric-grid">
                    <div class="metric-card">
                        <div class="label">SAM (Serviceable Market)</div>
                        <div class="value">$35B</div>
                        <div class="subtext">GCC - H1 categories only</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">SOM (Obtainable)</div>
                        <div class="value">$350M</div>
                        <div class="subtext">1% of SAM (3-year target)</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Number of Cities</div>
                        <div class="value">1</div>
                        <div class="subtext">Dubai (H1)</div>
                    </div>
                </div>
            </div>

            <!-- CASH FLOW SHEET -->
            <div id="cash-flow" class="sheet">
                <h2 class="section-title">Cash Flow & Budget Tracking</h2>

                <div class="alert alert-warning">
                    <strong>‚ö†Ô∏è Cash Management:</strong> Track monthly cash balance, surplus rollover, and dynamic budget allocation based on 3-month safety buffer.
                </div>

                <h3 class="subsection-title">üíµ H1 Cash Flow (5 Months)</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Month 1</th>
                                <th>Month 2</th>
                                <th>Month 3</th>
                                <th>Month 4</th>
                                <th>Month 5</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="background: #e8f8f5;">
                                <td><strong>Cash In Hand (Start)</strong></td>
                                <td id="cf-cash-m1-start">AED 1,101K</td>
                                <td id="cf-cash-m2-start">AED 989K</td>
                                <td id="cf-cash-m3-start">AED 889K</td>
                                <td id="cf-cash-m4-start">AED 811K</td>
                                <td id="cf-cash-m5-start">AED 754K</td>
                            </tr>
                            <tr style="background: #f0fff4;">
                                <td>Revenue (Previous Month)</td>
                                <td id="cf-revenue-m1">AED 0K</td>
                                <td id="cf-revenue-m2">AED 22K</td>
                                <td id="cf-revenue-m3">AED 43K</td>
                                <td id="cf-revenue-m4">AED 64K</td>
                                <td id="cf-revenue-m5">AED 83K</td>
                            </tr>
                            <tr style="background: #e8f8ff;">
                                <td>Additional Funding</td>
                                <td id="cf-funding-m1">AED 0K</td>
                                <td id="cf-funding-m2">AED 0K</td>
                                <td id="cf-funding-m3">AED 0K</td>
                                <td id="cf-funding-m4">AED 0K</td>
                                <td id="cf-funding-m5">AED 0K</td>
                            </tr>
                            <tr style="background: #fff5f5;">
                                <td>Rent (Fixed)</td>
                                <td id="cf-rent-m1">AED 3K</td>
                                <td id="cf-rent-m2">AED 3K</td>
                                <td id="cf-rent-m3">AED 3K</td>
                                <td id="cf-rent-m4">AED 3K</td>
                                <td id="cf-rent-m5">AED 3K</td>
                            </tr>
                            <tr style="background: #fff5f5;">
                                <td>Tech Budget</td>
                                <td id="cf-tech-m1">AED 10K</td>
                                <td id="cf-tech-m2">AED 10K</td>
                                <td id="cf-tech-m3">AED 10K</td>
                                <td id="cf-tech-m4">AED 20K</td>
                                <td id="cf-tech-m5">AED 20K</td>
                            </tr>
                            <tr style="background: #fff5f5;">
                                <td>Operations Budget</td>
                                <td id="cf-ops-m1">AED 5K</td>
                                <td id="cf-ops-m2">AED 5K</td>
                                <td id="cf-ops-m3">AED 5K</td>
                                <td id="cf-ops-m4">AED 7.5K</td>
                                <td id="cf-ops-m5">AED 7.5K</td>
                            </tr>
                            <tr style="background: #fff5f5;">
                                <td>Marketing Budget</td>
                                <td id="cf-marketing-m1">AED 103K</td>
                                <td id="cf-marketing-m2">AED 103K</td>
                                <td id="cf-marketing-m3">AED 103K</td>
                                <td id="cf-marketing-m4">AED 91K</td>
                                <td id="cf-marketing-m5">AED 91K</td>
                            </tr>
                            <tr style="background: #e8f5e9;">
                                <td><strong>Customer Acquisition Budget</strong></td>
                                <td id="cf-cust-acq-m1">AED 41K</td>
                                <td id="cf-cust-acq-m2">AED 41K</td>
                                <td id="cf-cust-acq-m3">AED 41K</td>
                                <td id="cf-cust-acq-m4">AED 36K</td>
                                <td id="cf-cust-acq-m5">AED 36K</td>
                            </tr>
                            <tr style="background: #e8f5e9;">
                                <td><strong>Merchant Acquisition Budget</strong></td>
                                <td id="cf-merch-acq-m1">AED 21K</td>
                                <td id="cf-merch-acq-m2">AED 21K</td>
                                <td id="cf-merch-acq-m3">AED 21K</td>
                                <td id="cf-merch-acq-m4">AED 18K</td>
                                <td id="cf-merch-acq-m5">AED 18K</td>
                            </tr>
                            <tr style="background: #fff3cd;">
                                <td><strong>New Users Acquired</strong></td>
                                <td id="cf-new-users-m1">1,177</td>
                                <td id="cf-new-users-m2">1,177</td>
                                <td id="cf-new-users-m3">1,177</td>
                                <td id="cf-new-users-m4">1,034</td>
                                <td id="cf-new-users-m5">1,034</td>
                            </tr>
                            <tr style="background: #fff3cd;">
                                <td><strong>New Merchants Acquired</strong></td>
                                <td id="cf-new-merchants-m1">21</td>
                                <td id="cf-new-merchants-m2">21</td>
                                <td id="cf-new-merchants-m3">21</td>
                                <td id="cf-new-merchants-m4">18</td>
                                <td id="cf-new-merchants-m5">18</td>
                            </tr>
                            <tr>
                                <td><strong>Total Expenses</strong></td>
                                <td id="cf-total-exp-m1">AED 121K</td>
                                <td id="cf-total-exp-m2">AED 121K</td>
                                <td id="cf-total-exp-m3">AED 121K</td>
                                <td id="cf-total-exp-m4">AED 121K</td>
                                <td id="cf-total-exp-m5">AED 121K</td>
                            </tr>
                            <tr style="background: #fef5e7;">
                                <td><strong>Cash In Hand (End)</strong></td>
                                <td id="cf-cash-m1-end">AED 980K</td>
                                <td id="cf-cash-m2-end">AED 880K</td>
                                <td id="cf-cash-m3-end">AED 802K</td>
                                <td id="cf-cash-m4-end">AED 745K</td>
                                <td id="cf-cash-m5-end">AED 707K</td>
                            </tr>
                            <tr style="background: #e8f5e9;">
                                <td><strong>Surplus Cash (Above 3-mo Buffer)</strong></td>
                                <td id="cf-surplus-m1">AED 617K</td>
                                <td id="cf-surplus-m2">AED 517K</td>
                                <td id="cf-surplus-m3">AED 439K</td>
                                <td id="cf-surplus-m4">AED 382K</td>
                                <td id="cf-surplus-m5">AED 344K</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="alert alert-info">
                    <strong>üí° Dynamic Budget Allocation:</strong> Monthly budgets are calculated based on available cash after maintaining a 3-month safety buffer (AED 363K).
                    Tech and Operations budgets scale up in Month 4-5, while Marketing gets all remaining funds.
                </div>

                <h3 class="subsection-title">üìä H1 Summary</h3>
                <div class="metric-grid">
                    <div class="metric-card success">
                        <div class="label">Total Users Acquired</div>
                        <div class="value" id="cf-total-users">5,599</div>
                        <div class="subtext">H1 total</div>
                    </div>

                    <div class="metric-card success">
                        <div class="label">Total Merchants Acquired</div>
                        <div class="value" id="cf-total-merchants">100</div>
                        <div class="subtext">H1 total</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Final Cash Balance</div>
                        <div class="value" id="cf-final-cash">AED 707K</div>
                        <div class="subtext">End of Month 5</div>
                    </div>

                    <div class="metric-card">
                        <div class="label">Runway Remaining</div>
                        <div class="value" id="cf-runway">5.8</div>
                        <div class="subtext">months (at current burn)</div>
                    </div>
                </div>
            </div>

            <!-- H1 MONTHLY SHEET -->
            <div id="h1-monthly" class="sheet active">

                <!-- Quick Testing Panel -->
                <div class="test-panel">
                    <div class="test-panel-title">
                        ‚ö° Quick Scenario Testing
                    </div>

                    <div class="scenario-buttons">
                        <button class="scenario-btn" onclick="applyScenario('conservative')" data-scenario="conservative">
                            <span class="amount">CAC AED 50</span>
                            <span class="label">Realistic CAC</span>
                        </button>
                        <button class="scenario-btn" onclick="applyScenario('moderate')" data-scenario="moderate">
                            <span class="amount">CAC AED 35</span>
                            <span class="label">Baseline ($400K)</span>
                        </button>
                        <button class="scenario-btn" onclick="applyScenario('aggressive')" data-scenario="aggressive">
                            <span class="amount">CAC AED 20</span>
                            <span class="label">Optimized</span>
                        </button>
                        <button class="scenario-btn" onclick="applyScenario('moonshot')" data-scenario="moonshot">
                            <span class="amount">CAC AED 15</span>
                            <span class="label">Stretch (10K MAU)</span>
                        </button>
                    </div>

                    <div class="quick-inputs">
                        <div class="quick-input">
                            <label>üí∞ Initial Budget (AED)</label>
                            <input type="number" id="quick-budget" value="1468000" step="100000"
                                   oninput="quickUpdateBudget(this.value)">
                        </div>
                        <div class="quick-input">
                            <label>üìÖ Target Runway (months)</label>
                            <input type="number" id="quick-runway" value="6" min="3" max="24"
                                   oninput="quickUpdateRunway(this.value)">
                        </div>
                        <div class="quick-input">
                            <label>üíµ CAC (AED per user)</label>
                            <input type="number" id="quick-cac" value="35" min="10" max="200"
                                   oninput="quickUpdateCAC(this.value)">
                        </div>
                        <div class="quick-input">
                            <label>üìà User Activation Rate (%)</label>
                            <input type="number" id="quick-activation" value="40" min="10" max="100"
                                   oninput="quickUpdateActivation(this.value)">
                        </div>
                    </div>
                </div>

                <!-- Executive Summary Dashboard -->
                <div class="executive-summary">
                    <div class="summary-card positive" id="summary-users">
                        <div class="card-label">Total Users (5 months)</div>
                        <div class="card-value" id="summary-users-value">-</div>
                        <div class="card-change up" id="summary-users-change">
                            <span>‚ñ≤</span>
                            <span>vs last scenario</span>
                        </div>
                    </div>

                    <div class="summary-card positive" id="summary-mau">
                        <div class="card-label">Final MAU</div>
                        <div class="card-value" id="summary-mau-value">-</div>
                        <div class="card-change up" id="summary-mau-change">
                            <span>‚ñ≤</span>
                            <span>Month 5</span>
                        </div>
                    </div>

                    <div class="summary-card positive" id="summary-revenue">
                        <div class="card-label">Total Revenue (5 months)</div>
                        <div class="card-value" id="summary-revenue-value">-</div>
                        <div class="card-change up" id="summary-revenue-change">
                            <span>‚ñ≤</span>
                            <span>All streams</span>
                        </div>
                    </div>

                    <div class="summary-card negative" id="summary-burn">
                        <div class="card-label">Net Burn (5 months)</div>
                        <div class="card-value" id="summary-burn-value">-</div>
                        <div class="card-change down" id="summary-burn-change">
                            <span>‚ñº</span>
                            <span>Cash used</span>
                        </div>
                    </div>

                    <div class="summary-card warning" id="summary-cash">
                        <div class="card-label">Cash Remaining</div>
                        <div class="card-value" id="summary-cash-value">-</div>
                        <div class="card-change" id="summary-cash-change">
                            <span>Month 5 balance</span>
                        </div>
                    </div>

                    <div class="summary-card" id="summary-runway">
                        <div class="card-label">Remaining Runway</div>
                        <div class="card-value" id="summary-runway-value">-</div>
                        <div class="card-change" id="summary-runway-change">
                            <span>At current burn</span>
                        </div>
                    </div>
                </div>

                <!-- Visual Analytics Dashboard -->
                <div class="charts-dashboard">
                    <div class="section-header">
                        <h3 class="charts-title">üìä Visual Analytics</h3>
                        <p class="charts-subtitle">Real-time projections based on current scenario</p>
                    </div>

                    <div class="charts-grid">
                        <!-- Growth Trend Chart -->
                        <div class="chart-card">
                            <div class="chart-header">
                                <div class="chart-title">üìà Growth Trajectory</div>
                                <div class="chart-legend">
                                    <span class="legend-item"><span class="legend-dot blue"></span> MAU</span>
                                    <span class="legend-item"><span class="legend-dot green"></span> Revenue</span>
                                </div>
                            </div>
                            <div class="chart-container" id="growth-chart">
                                <svg viewBox="0 0 400 200" preserveAspectRatio="xMidYMid meet">
                                    <g id="growth-chart-content"></g>
                                </svg>
                            </div>
                        </div>

                        <!-- Revenue Breakdown Chart -->
                        <div class="chart-card">
                            <div class="chart-header">
                                <div class="chart-title">üí∞ Revenue Streams</div>
                                <div class="chart-subtitle">Total revenue distribution</div>
                            </div>
                            <div class="chart-container" id="revenue-chart">
                                <!-- Bars will be rendered here -->
                            </div>
                        </div>

                        <!-- Expense Allocation Chart -->
                        <div class="chart-card">
                            <div class="chart-header">
                                <div class="chart-title">üíµ Expense Allocation</div>
                                <div class="chart-subtitle">Budget distribution</div>
                            </div>
                            <div class="chart-container donut-container" id="expense-chart">
                                <svg viewBox="0 0 200 200" preserveAspectRatio="xMidYMid meet">
                                    <g id="expense-chart-content"></g>
                                </svg>
                            </div>
                        </div>

                        <!-- Cash Flow Chart -->
                        <div class="chart-card">
                            <div class="chart-header">
                                <div class="chart-title">üí∏ Cash Runway</div>
                                <div class="chart-subtitle">Bank balance over time</div>
                            </div>
                            <div class="chart-container" id="cashflow-chart">
                                <svg viewBox="0 0 400 200" preserveAspectRatio="xMidYMid meet">
                                    <g id="cashflow-chart-content"></g>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

                <h2 class="section-title">H1 Monthly Breakdown (Until Gate Hit)</h2>

                <div class="alert alert-info">
                    <strong>üéØ H1 Phase Gates:</strong> Advances to H2 when: 5K MAU (conservative) ‚Ä¢ 250 Merchants (minimum) ‚Ä¢ Tranche 2 triggers at: 10 merchants, 1K MAU, CTO hired
                </div>

                <div class="alert alert-warning" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-left: 4px solid #f59e0b; margin: 20px 0; padding: 20px; border-radius: 8px;">
                    <div style="display: flex; align-items: start; gap: 12px;">
                        <span style="font-size: 24px;">üìä</span>
                        <div style="flex: 1;">
                            <strong style="font-size: 1.1rem; color: #92400e; display: block; margin-bottom: 8px;">üí° Model vs Target Explained</strong>
                            <p style="color: #78350f; margin: 8px 0; line-height: 1.6;">
                                <strong>Conservative Model (shown below):</strong> This projection uses conservative assumptions (30% activation, 4x order frequency, AED 35 CAC) based on UAE marketplace benchmarks. With these inputs, H1 typically achieves <strong>~5-7K MAU, 150-200 merchants, AED 5-7M GMV</strong>.
                            </p>
                            <p style="color: #78350f; margin: 8px 0; line-height: 1.6;">
                                <strong>Aggressive Target (pitch deck):</strong> Our target is <strong>10K MAU, 250 merchants, AED 10M GMV</strong>. This requires optimized execution (40% activation, 6x frequency, AED 20 CAC via merchant-QR strategy). Research shows this is achievable‚Äîcomparable UAE platforms like Tabby and Cobone hit 100K-200K users in 6 months‚Äîbut requires flawless merchant acquisition (50/month).
                            </p>
                            <p style="color: #78350f; margin: 8px 0; line-height: 1.6;">
                                <strong>How to bridge the gap:</strong> Test scenario buttons above! Click <strong>"Aggressive"</strong> to see 10K MAU projection with optimized inputs. The difference is execution quality, not market potential.
                            </p>
                            <p style="color: #92400e; margin: 12px 0 0 0; font-weight: 600; font-size: 0.95rem;">
                                üìà <strong>Benchmark context:</strong> WaffarX (Egypt) reached 450K users with 260 merchants. Tabby (UAE) grew from 400K to 15M users in 5 years. Nuqta's 10K target represents 0.1% of UAE's 10M population‚Äîaggressive but defensible.
                            </p>
                        </div>
                    </div>
                </div>

                <div class="table-container enhanced-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Metric</th>
                                <th>Month 1</th>
                                <th>Month 2</th>
                                <th>Month 3</th>
                                <th>Month 4</th>
                                <th>Month 5</th>
                                <th>Total/Final</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- USER METRICS -->
                            <tr class="section-header-row">
                                <td colspan="7">üì± USER METRICS</td>
                            </tr>
                            <tr>
                                <td>Total Number of New Users</td>
                                <td id="h1-new-users-m1">-</td>
                                <td id="h1-new-users-m2">-</td>
                                <td id="h1-new-users-m3">-</td>
                                <td id="h1-new-users-m4">-</td>
                                <td id="h1-new-users-m5">-</td>
                                <td id="h1-new-users-total">-</td>
                            </tr>
                            <tr>
                                <td>Total Active Users (MAU)</td>
                                <td id="h1-mau-m1">-</td>
                                <td id="h1-mau-m2">-</td>
                                <td id="h1-mau-m3">-</td>
                                <td id="h1-mau-m4">-</td>
                                <td id="h1-mau-m5">-</td>
                                <td id="h1-mau-total">-</td>
                            </tr>
                            <tr>
                                <td>Monthly Growth Rate</td>
                                <td id="h1-growth-m1">-</td>
                                <td id="h1-growth-m2">-</td>
                                <td id="h1-growth-m3">-</td>
                                <td id="h1-growth-m4">-</td>
                                <td id="h1-growth-m5">-</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>Churn Rate</td>
                                <td id="h1-churn-m1">-</td>
                                <td id="h1-churn-m2">-</td>
                                <td id="h1-churn-m3">-</td>
                                <td id="h1-churn-m4">-</td>
                                <td id="h1-churn-m5">-</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>Activation Rate</td>
                                <td id="h1-activation-m1">-</td>
                                <td id="h1-activation-m2">-</td>
                                <td id="h1-activation-m3">-</td>
                                <td id="h1-activation-m4">-</td>
                                <td id="h1-activation-m5">-</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>Total Downloads (Cumulative)</td>
                                <td id="h1-downloads-m1">-</td>
                                <td id="h1-downloads-m2">-</td>
                                <td id="h1-downloads-m3">-</td>
                                <td id="h1-downloads-m4">-</td>
                                <td id="h1-downloads-m5">-</td>
                                <td id="h1-downloads-total">-</td>
                            </tr>

                            <!-- MERCHANT METRICS -->
                            <tr class="section-header-row">
                                <td colspan="7">üè™ MERCHANT METRICS</td>
                            </tr>
                            <tr>
                                <td>Number of New Business on App</td>
                                <td id="h1-new-merchants-m1">-</td>
                                <td id="h1-new-merchants-m2">-</td>
                                <td id="h1-new-merchants-m3">-</td>
                                <td id="h1-new-merchants-m4">-</td>
                                <td id="h1-new-merchants-m5">-</td>
                                <td id="h1-new-merchants-total">-</td>
                            </tr>
                            <tr>
                                <td>Number of Active Business Users</td>
                                <td id="h1-merchants-m1">-</td>
                                <td id="h1-merchants-m2">-</td>
                                <td id="h1-merchants-m3">-</td>
                                <td id="h1-merchants-m4">-</td>
                                <td id="h1-merchants-m5">-</td>
                                <td id="h1-merchants-total">-</td>
                            </tr>
                            <tr>
                                <td>Merchant Churn Rate</td>
                                <td id="h1-merchant-churn-m1">-</td>
                                <td id="h1-merchant-churn-m2">-</td>
                                <td id="h1-merchant-churn-m3">-</td>
                                <td id="h1-merchant-churn-m4">-</td>
                                <td id="h1-merchant-churn-m5">-</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>Paid Business Subscribers</td>
                                <td id="h1-paid-merchants-m1">-</td>
                                <td id="h1-paid-merchants-m2">-</td>
                                <td id="h1-paid-merchants-m3">-</td>
                                <td id="h1-paid-merchants-m4">-</td>
                                <td id="h1-paid-merchants-m5">-</td>
                                <td id="h1-paid-merchants-total">-</td>
                            </tr>

                            <!-- LOCATION METRICS -->
                            <tr class="section-header-row">
                                <td colspan="7">üìç LOCATION METRICS</td>
                            </tr>
                            <tr>
                                <td>Number of Cities</td>
                                <td id="h1-cities-m1">-</td>
                                <td id="h1-cities-m2">-</td>
                                <td id="h1-cities-m3">-</td>
                                <td id="h1-cities-m4">-</td>
                                <td id="h1-cities-m5">-</td>
                                <td id="h1-cities-total">-</td>
                            </tr>

                            <!-- REVENUE STREAMS -->
                            <tr class="section-header-row">
                                <td colspan="7">üí∞ REVENUE BREAKDOWN</td>
                            </tr>
                            <tr>
                                <td>Commission on Sales</td>
                                <td id="h1-commission-m1">-</td>
                                <td id="h1-commission-m2">-</td>
                                <td id="h1-commission-m3">-</td>
                                <td id="h1-commission-m4">-</td>
                                <td id="h1-commission-m5">-</td>
                                <td id="h1-commission-total">-</td>
                            </tr>
                            <tr>
                                <td>Promoted Sales Revenue</td>
                                <td id="h1-promoted-m1">-</td>
                                <td id="h1-promoted-m2">-</td>
                                <td id="h1-promoted-m3">-</td>
                                <td id="h1-promoted-m4">-</td>
                                <td id="h1-promoted-m5">-</td>
                                <td id="h1-promoted-total">-</td>
                            </tr>
                            <tr>
                                <td>Business Subscription</td>
                                <td id="h1-merchant-sub-m1">-</td>
                                <td id="h1-merchant-sub-m2">-</td>
                                <td id="h1-merchant-sub-m3">-</td>
                                <td id="h1-merchant-sub-m4">-</td>
                                <td id="h1-merchant-sub-m5">-</td>
                                <td id="h1-merchant-sub-total">-</td>
                            </tr>
                            <tr>
                                <td>Affiliate Commission</td>
                                <td id="h1-affiliate-m1">-</td>
                                <td id="h1-affiliate-m2">-</td>
                                <td id="h1-affiliate-m3">-</td>
                                <td id="h1-affiliate-m4">-</td>
                                <td id="h1-affiliate-m5">-</td>
                                <td id="h1-affiliate-total">-</td>
                            </tr>
                            <tr>
                                <td>User Subscription</td>
                                <td id="h1-user-sub-m1">-</td>
                                <td id="h1-user-sub-m2">-</td>
                                <td id="h1-user-sub-m3">-</td>
                                <td id="h1-user-sub-m4">-</td>
                                <td id="h1-user-sub-m5">-</td>
                                <td id="h1-user-sub-total">-</td>
                            </tr>
                            <tr>
                                <td>Finance Revenue</td>
                                <td id="h1-finance-m1">-</td>
                                <td id="h1-finance-m2">-</td>
                                <td id="h1-finance-m3">-</td>
                                <td id="h1-finance-m4">-</td>
                                <td id="h1-finance-m5">-</td>
                                <td id="h1-finance-total">-</td>
                            </tr>
                            <tr>
                                <td>B2B Revenue</td>
                                <td id="h1-b2b-m1">-</td>
                                <td id="h1-b2b-m2">-</td>
                                <td id="h1-b2b-m3">-</td>
                                <td id="h1-b2b-m4">-</td>
                                <td id="h1-b2b-m5">-</td>
                                <td id="h1-b2b-total">-</td>
                            </tr>
                            <tr style="font-weight: 600; background: #e6f7ff;">
                                <td>Total Revenue</td>
                                <td id="h1-revenue-m1">-</td>
                                <td id="h1-revenue-m2">-</td>
                                <td id="h1-revenue-m3">-</td>
                                <td id="h1-revenue-m4">-</td>
                                <td id="h1-revenue-m5">-</td>
                                <td id="h1-revenue-total">-</td>
                            </tr>
                            <tr>
                                <td>Monthly GMV</td>
                                <td id="h1-gmv-m1">-</td>
                                <td id="h1-gmv-m2">-</td>
                                <td id="h1-gmv-m3">-</td>
                                <td id="h1-gmv-m4">-</td>
                                <td id="h1-gmv-m5">-</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>Cumulative GMV</td>
                                <td id="h1-cum-gmv-m1">-</td>
                                <td id="h1-cum-gmv-m2">-</td>
                                <td id="h1-cum-gmv-m3">-</td>
                                <td id="h1-cum-gmv-m4">-</td>
                                <td id="h1-cum-gmv-m5">-</td>
                                <td id="h1-cum-gmv-total">-</td>
                            </tr>

                            <!-- EXPENSES -->
                            <tr style="background: #fff3f3; font-weight: 600;">
                                <td colspan="7">üí∏ EXPENSES BREAKDOWN</td>
                            </tr>
                            <tr>
                                <td>Rent & Office Expenses</td>
                                <td id="h1-rent-m1">-</td>
                                <td id="h1-rent-m2">-</td>
                                <td id="h1-rent-m3">-</td>
                                <td id="h1-rent-m4">-</td>
                                <td id="h1-rent-m5">-</td>
                                <td id="h1-rent-total">-</td>
                            </tr>
                            <tr>
                                <td>Technology & Infrastructure</td>
                                <td id="h1-tech-m1">-</td>
                                <td id="h1-tech-m2">-</td>
                                <td id="h1-tech-m3">-</td>
                                <td id="h1-tech-m4">-</td>
                                <td id="h1-tech-m5">-</td>
                                <td id="h1-tech-total">-</td>
                            </tr>
                            <tr>
                                <td>Operations & Partnerships</td>
                                <td id="h1-ops-m1">-</td>
                                <td id="h1-ops-m2">-</td>
                                <td id="h1-ops-m3">-</td>
                                <td id="h1-ops-m4">-</td>
                                <td id="h1-ops-m5">-</td>
                                <td id="h1-ops-total">-</td>
                            </tr>
                            <tr>
                                <td>Customer Support Costs</td>
                                <td id="h1-support-m1">-</td>
                                <td id="h1-support-m2">-</td>
                                <td id="h1-support-m3">-</td>
                                <td id="h1-support-m4">-</td>
                                <td id="h1-support-m5">-</td>
                                <td id="h1-support-total">-</td>
                            </tr>
                            <tr>
                                <td>Marketing & User Acquisition</td>
                                <td id="h1-marketing-m1">-</td>
                                <td id="h1-marketing-m2">-</td>
                                <td id="h1-marketing-m3">-</td>
                                <td id="h1-marketing-m4">-</td>
                                <td id="h1-marketing-m5">-</td>
                                <td id="h1-marketing-total">-</td>
                            </tr>
                            <tr style="font-weight: 600; background: #fff3f3;">
                                <td>Total Expenses</td>
                                <td id="h1-total-expense-m1">-</td>
                                <td id="h1-total-expense-m2">-</td>
                                <td id="h1-total-expense-m3">-</td>
                                <td id="h1-total-expense-m4">-</td>
                                <td id="h1-total-expense-m5">-</td>
                                <td id="h1-total-expense-total">-</td>
                            </tr>

                            <!-- NET & CASH FLOW -->
                            <tr style="background: #f0f9ff; font-weight: 600;">
                                <td colspan="7">üìä NET & CASH FLOW</td>
                            </tr>
                            <tr>
                                <td>Net (Revenue - Expenses)</td>
                                <td id="h1-net-m1">-</td>
                                <td id="h1-net-m2">-</td>
                                <td id="h1-net-m3">-</td>
                                <td id="h1-net-m4">-</td>
                                <td id="h1-net-m5">-</td>
                                <td id="h1-net-total">-</td>
                            </tr>
                            <tr>
                                <td>Cash In Hand (End of Month)</td>
                                <td id="h1-cash-m1">-</td>
                                <td id="h1-cash-m2">-</td>
                                <td id="h1-cash-m3">-</td>
                                <td id="h1-cash-m4">-</td>
                                <td id="h1-cash-m5">-</td>
                                <td id="h1-cash-total">-</td>
                            </tr>
                            <tr>
                                <td>Budget Allocated for Month</td>
                                <td id="h1-budget-allocated-m1">-</td>
                                <td id="h1-budget-allocated-m2">-</td>
                                <td id="h1-budget-allocated-m3">-</td>
                                <td id="h1-budget-allocated-m4">-</td>
                                <td id="h1-budget-allocated-m5">-</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>Revenue Allocated to Next 3 Months</td>
                                <td id="h1-future-allocation-m1">-</td>
                                <td id="h1-future-allocation-m2">-</td>
                                <td id="h1-future-allocation-m3">-</td>
                                <td id="h1-future-allocation-m4">-</td>
                                <td id="h1-future-allocation-m5">-</td>
                                <td id="h1-future-allocation-total">-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="alert alert-success">
                    <strong>‚úÖ H1 Phase Summary:</strong> <span id="h1-final-mau">-</span> MAU with
                    <span id="h1-final-merchants">-</span> merchants, generating <span id="h1-final-gmv">-</span> cumulative GMV.
                </div>
            </div>

            <!-- H2 MONTHLY SHEET -->
            <div id="h2-monthly" class="sheet">
                <h2 class="section-title">H2 Monthly Breakdown (Until Gate Hit)</h2>

                <div class="alert alert-info">
                    <strong>üìà H2 Phase:</strong> Scale Categories - Advances to H3 when: 37.5K MAU ‚Ä¢ 250 Merchants ‚Ä¢ AED 25M GMV ‚Ä¢ 15% Retention
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Metric</th>
                                <th>Month 6</th>
                                <th>Month 7</th>
                                <th>Month 8</th>
                                <th>Total/Final</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- USER METRICS -->
                            <tr class="section-header-row">
                                <td colspan="5">üì± USER METRICS</td>
                            </tr>
                            <tr>
                                <td>Total Number of New Users</td>
                                <td id="h2-new-users-m6">-</td>
                                <td id="h2-new-users-m7">-</td>
                                <td id="h2-new-users-m8">-</td>
                                <td id="h2-new-users-total">-</td>
                            </tr>
                            <tr>
                                <td>Total Active Users (MAU)</td>
                                <td id="h2-mau-m6">-</td>
                                <td id="h2-mau-m7">-</td>
                                <td id="h2-mau-m8">-</td>
                                <td id="h2-mau-total">-</td>
                            </tr>
                            <tr>
                                <td>Monthly Growth Rate</td>
                                <td id="h2-growth-m6">-</td>
                                <td id="h2-growth-m7">-</td>
                                <td id="h2-growth-m8">-</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>Churn Rate</td>
                                <td id="h2-churn-m6">-</td>
                                <td id="h2-churn-m7">-</td>
                                <td id="h2-churn-m8">-</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>Activation Rate</td>
                                <td id="h2-activation-m6">-</td>
                                <td id="h2-activation-m7">-</td>
                                <td id="h2-activation-m8">-</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>Total Downloads (Cumulative)</td>
                                <td id="h2-downloads-m6">-</td>
                                <td id="h2-downloads-m7">-</td>
                                <td id="h2-downloads-m8">-</td>
                                <td id="h2-downloads-total">-</td>
                            </tr>

                            <!-- MERCHANT METRICS -->
                            <tr class="section-header-row">
                                <td colspan="5">üè™ MERCHANT METRICS</td>
                            </tr>
                            <tr>
                                <td>Number of New Business on App</td>
                                <td id="h2-new-merchants-m6">-</td>
                                <td id="h2-new-merchants-m7">-</td>
                                <td id="h2-new-merchants-m8">-</td>
                                <td id="h2-new-merchants-total">-</td>
                            </tr>
                            <tr>
                                <td>Number of Active Business Users</td>
                                <td id="h2-merchants-m6">-</td>
                                <td id="h2-merchants-m7">-</td>
                                <td id="h2-merchants-m8">-</td>
                                <td id="h2-merchants-total">-</td>
                            </tr>
                            <tr>
                                <td>Merchant Churn Rate</td>
                                <td id="h2-merchant-churn-m6">-</td>
                                <td id="h2-merchant-churn-m7">-</td>
                                <td id="h2-merchant-churn-m8">-</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>Paid Business Subscribers</td>
                                <td id="h2-paid-merchants-m6">-</td>
                                <td id="h2-paid-merchants-m7">-</td>
                                <td id="h2-paid-merchants-m8">-</td>
                                <td id="h2-paid-merchants-total">-</td>
                            </tr>

                            <!-- LOCATION METRICS -->
                            <tr class="section-header-row">
                                <td colspan="5">üìç LOCATION METRICS</td>
                            </tr>
                            <tr>
                                <td>Number of Cities</td>
                                <td id="h2-cities-m6">-</td>
                                <td id="h2-cities-m7">-</td>
                                <td id="h2-cities-m8">-</td>
                                <td id="h2-cities-total">-</td>
                            </tr>

                            <!-- REVENUE STREAMS -->
                            <tr class="section-header-row">
                                <td colspan="5">üí∞ REVENUE BREAKDOWN</td>
                            </tr>
                            <tr>
                                <td>Commission on Sales</td>
                                <td id="h2-commission-m6">-</td>
                                <td id="h2-commission-m7">-</td>
                                <td id="h2-commission-m8">-</td>
                                <td id="h2-commission-total">-</td>
                            </tr>
                            <tr>
                                <td>Promoted Sales Revenue</td>
                                <td id="h2-promoted-m6">-</td>
                                <td id="h2-promoted-m7">-</td>
                                <td id="h2-promoted-m8">-</td>
                                <td id="h2-promoted-total">-</td>
                            </tr>
                            <tr>
                                <td>Business Subscription</td>
                                <td id="h2-merchant-sub-m6">-</td>
                                <td id="h2-merchant-sub-m7">-</td>
                                <td id="h2-merchant-sub-m8">-</td>
                                <td id="h2-merchant-sub-total">-</td>
                            </tr>
                            <tr>
                                <td>Affiliate Commission</td>
                                <td id="h2-affiliate-m6">-</td>
                                <td id="h2-affiliate-m7">-</td>
                                <td id="h2-affiliate-m8">-</td>
                                <td id="h2-affiliate-total">-</td>
                            </tr>
                            <tr>
                                <td>User Subscription</td>
                                <td id="h2-user-sub-m6">-</td>
                                <td id="h2-user-sub-m7">-</td>
                                <td id="h2-user-sub-m8">-</td>
                                <td id="h2-user-sub-total">-</td>
                            </tr>
                            <tr>
                                <td>Finance Revenue</td>
                                <td id="h2-finance-m6">-</td>
                                <td id="h2-finance-m7">-</td>
                                <td id="h2-finance-m8">-</td>
                                <td id="h2-finance-total">-</td>
                            </tr>
                            <tr>
                                <td>B2B Revenue</td>
                                <td id="h2-b2b-m6">-</td>
                                <td id="h2-b2b-m7">-</td>
                                <td id="h2-b2b-m8">-</td>
                                <td id="h2-b2b-total">-</td>
                            </tr>
                            <tr style="font-weight: 600; background: #e6f7ff;">
                                <td>Total Revenue</td>
                                <td id="h2-revenue-m6">-</td>
                                <td id="h2-revenue-m7">-</td>
                                <td id="h2-revenue-m8">-</td>
                                <td id="h2-revenue-total">-</td>
                            </tr>
                            <tr>
                                <td>Monthly GMV</td>
                                <td id="h2-gmv-m6">-</td>
                                <td id="h2-gmv-m7">-</td>
                                <td id="h2-gmv-m8">-</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>Cumulative GMV</td>
                                <td id="h2-cum-gmv-m6">-</td>
                                <td id="h2-cum-gmv-m7">-</td>
                                <td id="h2-cum-gmv-m8">-</td>
                                <td id="h2-cum-gmv-total">-</td>
                            </tr>

                            <!-- EXPENSES -->
                            <tr style="background: #fff3f3; font-weight: 600;">
                                <td colspan="5">üí∏ EXPENSES BREAKDOWN</td>
                            </tr>
                            <tr>
                                <td>Rent & Office Expenses</td>
                                <td id="h2-rent-m6">-</td>
                                <td id="h2-rent-m7">-</td>
                                <td id="h2-rent-m8">-</td>
                                <td id="h2-rent-total">-</td>
                            </tr>
                            <tr>
                                <td>Technology & Infrastructure</td>
                                <td id="h2-tech-m6">-</td>
                                <td id="h2-tech-m7">-</td>
                                <td id="h2-tech-m8">-</td>
                                <td id="h2-tech-total">-</td>
                            </tr>
                            <tr>
                                <td>Operations & Partnerships</td>
                                <td id="h2-ops-m6">-</td>
                                <td id="h2-ops-m7">-</td>
                                <td id="h2-ops-m8">-</td>
                                <td id="h2-ops-total">-</td>
                            </tr>
                            <tr>
                                <td>Customer Support Costs</td>
                                <td id="h2-support-m6">-</td>
                                <td id="h2-support-m7">-</td>
                                <td id="h2-support-m8">-</td>
                                <td id="h2-support-total">-</td>
                            </tr>
                            <tr>
                                <td>Marketing & User Acquisition</td>
                                <td id="h2-marketing-m6">-</td>
                                <td id="h2-marketing-m7">-</td>
                                <td id="h2-marketing-m8">-</td>
                                <td id="h2-marketing-total">-</td>
                            </tr>
                            <tr style="font-weight: 600; background: #fff3f3;">
                                <td>Total Expenses</td>
                                <td id="h2-total-expense-m6">-</td>
                                <td id="h2-total-expense-m7">-</td>
                                <td id="h2-total-expense-m8">-</td>
                                <td id="h2-total-expense-total">-</td>
                            </tr>

                            <!-- NET & CASH FLOW -->
                            <tr style="background: #f0f9ff; font-weight: 600;">
                                <td colspan="5">üìä NET & CASH FLOW</td>
                            </tr>
                            <tr>
                                <td>Net (Revenue - Expenses)</td>
                                <td id="h2-net-m6">-</td>
                                <td id="h2-net-m7">-</td>
                                <td id="h2-net-m8">-</td>
                                <td id="h2-net-total">-</td>
                            </tr>
                            <tr>
                                <td>Cash In Hand (End of Month)</td>
                                <td id="h2-cash-m6">-</td>
                                <td id="h2-cash-m7">-</td>
                                <td id="h2-cash-m8">-</td>
                                <td id="h2-cash-total">-</td>
                            </tr>
                            <tr>
                                <td>Budget Allocated for Month</td>
                                <td id="h2-budget-allocated-m6">-</td>
                                <td id="h2-budget-allocated-m7">-</td>
                                <td id="h2-budget-allocated-m8">-</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>Revenue Allocated to Next 3 Months</td>
                                <td id="h2-future-allocation-m6">-</td>
                                <td id="h2-future-allocation-m7">-</td>
                                <td id="h2-future-allocation-m8">-</td>
                                <td id="h2-future-allocation-total">-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="alert alert-success">
                    <strong>‚úÖ H2 Phase Summary:</strong> <span id="h2-final-mau">-</span> MAU with
                    <span id="h2-final-merchants">-</span> merchants, generating <span id="h2-final-gmv">-</span> cumulative GMV.
                </div>
            </div>

            <!-- H3 MONTHLY SHEET -->
            <div id="h3-monthly" class="sheet">
                <h2 class="section-title">H3 Monthly Breakdown (Until Gate Hit)</h2>

                <div class="alert alert-info">
                    <strong>üöÄ H3 Phase:</strong> B2B Infrastructure - Advances to Phase 2 when: 75K MAU ‚Ä¢ 500 Merchants ‚Ä¢ AED 100M GMV ‚Ä¢ 15% EBITDA
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Metric</th>
                                <th>M9</th>
                                <th>M10</th>
                                <th>M11</th>
                                <th>M12</th>
                                <th>M13-M20</th>
                                <th>Total/Final</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- USER METRICS -->
                            <tr class="section-header-row">
                                <td colspan="7">üì± USER METRICS</td>
                            </tr>
                            <tr>
                                <td>Total Number of New Users</td>
                                <td id="h3-new-users-m9">-</td>
                                <td id="h3-new-users-m10">-</td>
                                <td id="h3-new-users-m11">-</td>
                                <td id="h3-new-users-m12">-</td>
                                <td id="h3-new-users-m13-20">-</td>
                                <td id="h3-new-users-total">-</td>
                            </tr>
                            <tr>
                                <td>Total Active Users (MAU)</td>
                                <td id="h3-mau-m9">-</td>
                                <td id="h3-mau-m10">-</td>
                                <td id="h3-mau-m11">-</td>
                                <td id="h3-mau-m12">-</td>
                                <td id="h3-mau-m13-20">-</td>
                                <td id="h3-mau-total">-</td>
                            </tr>
                            <tr>
                                <td>Monthly Growth Rate</td>
                                <td id="h3-growth-m9">-</td>
                                <td id="h3-growth-m10">-</td>
                                <td id="h3-growth-m11">-</td>
                                <td id="h3-growth-m12">-</td>
                                <td id="h3-growth-m13-20">-</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>Churn Rate</td>
                                <td id="h3-churn-m9">-</td>
                                <td id="h3-churn-m10">-</td>
                                <td id="h3-churn-m11">-</td>
                                <td id="h3-churn-m12">-</td>
                                <td id="h3-churn-m13-20">-</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>Activation Rate</td>
                                <td id="h3-activation-m9">-</td>
                                <td id="h3-activation-m10">-</td>
                                <td id="h3-activation-m11">-</td>
                                <td id="h3-activation-m12">-</td>
                                <td id="h3-activation-m13-20">-</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>Total Downloads (Cumulative)</td>
                                <td id="h3-downloads-m9">-</td>
                                <td id="h3-downloads-m10">-</td>
                                <td id="h3-downloads-m11">-</td>
                                <td id="h3-downloads-m12">-</td>
                                <td id="h3-downloads-m13-20">-</td>
                                <td id="h3-downloads-total">-</td>
                            </tr>

                            <!-- MERCHANT METRICS -->
                            <tr class="section-header-row">
                                <td colspan="7">üè™ MERCHANT METRICS</td>
                            </tr>
                            <tr>
                                <td>Number of New Business on App</td>
                                <td id="h3-new-merchants-m9">-</td>
                                <td id="h3-new-merchants-m10">-</td>
                                <td id="h3-new-merchants-m11">-</td>
                                <td id="h3-new-merchants-m12">-</td>
                                <td id="h3-new-merchants-m13-20">-</td>
                                <td id="h3-new-merchants-total">-</td>
                            </tr>
                            <tr>
                                <td>Number of Active Business Users</td>
                                <td id="h3-merchants-m9">-</td>
                                <td id="h3-merchants-m10">-</td>
                                <td id="h3-merchants-m11">-</td>
                                <td id="h3-merchants-m12">-</td>
                                <td id="h3-merchants-m13-20">-</td>
                                <td id="h3-merchants-total">-</td>
                            </tr>
                            <tr>
                                <td>Merchant Churn Rate</td>
                                <td id="h3-merchant-churn-m9">-</td>
                                <td id="h3-merchant-churn-m10">-</td>
                                <td id="h3-merchant-churn-m11">-</td>
                                <td id="h3-merchant-churn-m12">-</td>
                                <td id="h3-merchant-churn-m13-20">-</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>Paid Business Subscribers</td>
                                <td id="h3-paid-merchants-m9">-</td>
                                <td id="h3-paid-merchants-m10">-</td>
                                <td id="h3-paid-merchants-m11">-</td>
                                <td id="h3-paid-merchants-m12">-</td>
                                <td id="h3-paid-merchants-m13-20">-</td>
                                <td id="h3-paid-merchants-total">-</td>
                            </tr>

                            <!-- LOCATION METRICS -->
                            <tr class="section-header-row">
                                <td colspan="7">üìç LOCATION METRICS</td>
                            </tr>
                            <tr>
                                <td>Number of Cities</td>
                                <td id="h3-cities-m9">-</td>
                                <td id="h3-cities-m10">-</td>
                                <td id="h3-cities-m11">-</td>
                                <td id="h3-cities-m12">-</td>
                                <td id="h3-cities-m13-20">-</td>
                                <td id="h3-cities-total">-</td>
                            </tr>

                            <!-- REVENUE STREAMS -->
                            <tr class="section-header-row">
                                <td colspan="7">üí∞ REVENUE BREAKDOWN</td>
                            </tr>
                            <tr>
                                <td>Commission on Sales</td>
                                <td id="h3-commission-m9">-</td>
                                <td id="h3-commission-m10">-</td>
                                <td id="h3-commission-m11">-</td>
                                <td id="h3-commission-m12">-</td>
                                <td id="h3-commission-m13-20">-</td>
                                <td id="h3-commission-total">-</td>
                            </tr>
                            <tr>
                                <td>Promoted Sales Revenue</td>
                                <td id="h3-promoted-m9">-</td>
                                <td id="h3-promoted-m10">-</td>
                                <td id="h3-promoted-m11">-</td>
                                <td id="h3-promoted-m12">-</td>
                                <td id="h3-promoted-m13-20">-</td>
                                <td id="h3-promoted-total">-</td>
                            </tr>
                            <tr>
                                <td>Business Subscription</td>
                                <td id="h3-merchant-sub-m9">-</td>
                                <td id="h3-merchant-sub-m10">-</td>
                                <td id="h3-merchant-sub-m11">-</td>
                                <td id="h3-merchant-sub-m12">-</td>
                                <td id="h3-merchant-sub-m13-20">-</td>
                                <td id="h3-merchant-sub-total">-</td>
                            </tr>
                            <tr>
                                <td>Affiliate Commission</td>
                                <td id="h3-affiliate-m9">-</td>
                                <td id="h3-affiliate-m10">-</td>
                                <td id="h3-affiliate-m11">-</td>
                                <td id="h3-affiliate-m12">-</td>
                                <td id="h3-affiliate-m13-20">-</td>
                                <td id="h3-affiliate-total">-</td>
                            </tr>
                            <tr>
                                <td>User Subscription</td>
                                <td id="h3-user-sub-m9">-</td>
                                <td id="h3-user-sub-m10">-</td>
                                <td id="h3-user-sub-m11">-</td>
                                <td id="h3-user-sub-m12">-</td>
                                <td id="h3-user-sub-m13-20">-</td>
                                <td id="h3-user-sub-total">-</td>
                            </tr>
                            <tr>
                                <td>Finance Revenue</td>
                                <td id="h3-finance-m9">-</td>
                                <td id="h3-finance-m10">-</td>
                                <td id="h3-finance-m11">-</td>
                                <td id="h3-finance-m12">-</td>
                                <td id="h3-finance-m13-20">-</td>
                                <td id="h3-finance-total">-</td>
                            </tr>
                            <tr>
                                <td>B2B Revenue</td>
                                <td id="h3-b2b-m9">-</td>
                                <td id="h3-b2b-m10">-</td>
                                <td id="h3-b2b-m11">-</td>
                                <td id="h3-b2b-m12">-</td>
                                <td id="h3-b2b-m13-20">-</td>
                                <td id="h3-b2b-total">-</td>
                            </tr>
                            <tr style="font-weight: 600; background: #e6f7ff;">
                                <td>Total Revenue</td>
                                <td id="h3-revenue-m9">-</td>
                                <td id="h3-revenue-m10">-</td>
                                <td id="h3-revenue-m11">-</td>
                                <td id="h3-revenue-m12">-</td>
                                <td id="h3-revenue-m13-20">-</td>
                                <td id="h3-revenue-total">-</td>
                            </tr>
                            <tr>
                                <td>Monthly GMV</td>
                                <td id="h3-gmv-m9">-</td>
                                <td id="h3-gmv-m10">-</td>
                                <td id="h3-gmv-m11">-</td>
                                <td id="h3-gmv-m12">-</td>
                                <td id="h3-gmv-m13-20">-</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>Cumulative GMV</td>
                                <td id="h3-cum-gmv-m9">-</td>
                                <td id="h3-cum-gmv-m10">-</td>
                                <td id="h3-cum-gmv-m11">-</td>
                                <td id="h3-cum-gmv-m12">-</td>
                                <td id="h3-cum-gmv-m13-20">-</td>
                                <td id="h3-cum-gmv-total">-</td>
                            </tr>

                            <!-- EXPENSES -->
                            <tr style="background: #fff3f3; font-weight: 600;">
                                <td colspan="7">üí∏ EXPENSES BREAKDOWN</td>
                            </tr>
                            <tr>
                                <td>Rent & Office Expenses</td>
                                <td id="h3-rent-m9">-</td>
                                <td id="h3-rent-m10">-</td>
                                <td id="h3-rent-m11">-</td>
                                <td id="h3-rent-m12">-</td>
                                <td id="h3-rent-m13-20">-</td>
                                <td id="h3-rent-total">-</td>
                            </tr>
                            <tr>
                                <td>Technology & Infrastructure</td>
                                <td id="h3-tech-m9">-</td>
                                <td id="h3-tech-m10">-</td>
                                <td id="h3-tech-m11">-</td>
                                <td id="h3-tech-m12">-</td>
                                <td id="h3-tech-m13-20">-</td>
                                <td id="h3-tech-total">-</td>
                            </tr>
                            <tr>
                                <td>Operations & Partnerships</td>
                                <td id="h3-ops-m9">-</td>
                                <td id="h3-ops-m10">-</td>
                                <td id="h3-ops-m11">-</td>
                                <td id="h3-ops-m12">-</td>
                                <td id="h3-ops-m13-20">-</td>
                                <td id="h3-ops-total">-</td>
                            </tr>
                            <tr>
                                <td>Customer Support Costs</td>
                                <td id="h3-support-m9">-</td>
                                <td id="h3-support-m10">-</td>
                                <td id="h3-support-m11">-</td>
                                <td id="h3-support-m12">-</td>
                                <td id="h3-support-m13-20">-</td>
                                <td id="h3-support-total">-</td>
                            </tr>
                            <tr>
                                <td>Marketing & User Acquisition</td>
                                <td id="h3-marketing-m9">-</td>
                                <td id="h3-marketing-m10">-</td>
                                <td id="h3-marketing-m11">-</td>
                                <td id="h3-marketing-m12">-</td>
                                <td id="h3-marketing-m13-20">-</td>
                                <td id="h3-marketing-total">-</td>
                            </tr>
                            <tr style="font-weight: 600; background: #fff3f3;">
                                <td>Total Expenses</td>
                                <td id="h3-total-expense-m9">-</td>
                                <td id="h3-total-expense-m10">-</td>
                                <td id="h3-total-expense-m11">-</td>
                                <td id="h3-total-expense-m12">-</td>
                                <td id="h3-total-expense-m13-20">-</td>
                                <td id="h3-total-expense-total">-</td>
                            </tr>

                            <!-- NET & CASH FLOW -->
                            <tr style="background: #f0f9ff; font-weight: 600;">
                                <td colspan="7">üìä NET & CASH FLOW</td>
                            </tr>
                            <tr>
                                <td>Net (Revenue - Expenses)</td>
                                <td id="h3-net-m9">-</td>
                                <td id="h3-net-m10">-</td>
                                <td id="h3-net-m11">-</td>
                                <td id="h3-net-m12">-</td>
                                <td id="h3-net-m13-20">-</td>
                                <td id="h3-net-total">-</td>
                            </tr>
                            <tr>
                                <td>Cash In Hand (End of Month)</td>
                                <td id="h3-cash-m9">-</td>
                                <td id="h3-cash-m10">-</td>
                                <td id="h3-cash-m11">-</td>
                                <td id="h3-cash-m12">-</td>
                                <td id="h3-cash-m13-20">-</td>
                                <td id="h3-cash-total">-</td>
                            </tr>
                            <tr>
                                <td>Budget Allocated for Month</td>
                                <td id="h3-budget-allocated-m9">-</td>
                                <td id="h3-budget-allocated-m10">-</td>
                                <td id="h3-budget-allocated-m11">-</td>
                                <td id="h3-budget-allocated-m12">-</td>
                                <td id="h3-budget-allocated-m13-20">-</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>Revenue Allocated to Next 3 Months</td>
                                <td id="h3-future-allocation-m9">-</td>
                                <td id="h3-future-allocation-m10">-</td>
                                <td id="h3-future-allocation-m11">-</td>
                                <td id="h3-future-allocation-m12">-</td>
                                <td id="h3-future-allocation-m13-20">-</td>
                                <td id="h3-future-allocation-total">-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="alert alert-success">
                    <strong>‚úÖ H3 Phase Summary:</strong> <span id="h3-final-mau">-</span> MAU with
                    <span id="h3-final-merchants">-</span> merchants, generating <span id="h3-final-gmv">-</span> cumulative GMV.
                </div>
            </div>

            <!-- INCOME STATEMENT SHEET -->
            <div id="income" class="sheet">
                <h2 class="section-title">Income Statement (P&L) - H1 to Year 4</h2>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Metric</th>
                                <th>H1 (5mo)</th>
                                <th>H2 (2.5mo)</th>
                                <th>H3 (12mo)</th>
                                <th>Year 2</th>
                                <th>Year 3</th>
                                <th>Year 4</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="section-header-row">
                                <td colspan="7">REVENUE</td>
                            </tr>
                            <tr>
                                <td>MAU</td>
                                <td id="income-mau-h1">4,145</td>
                                <td>75,000</td>
                                <td>250,000</td>
                                <td>500,000</td>
                                <td>1,000,000</td>
                                <td>2,000,000</td>
                            </tr>
                            <tr>
                                <td>Total GMV</td>
                                <td id="income-gmv-h1">AED 4.23M</td>
                                <td>AED 7.5M</td>
                                <td>AED 120M</td>
                                <td>AED 270M</td>
                                <td>AED 600M</td>
                                <td>AED 1.32B</td>
                            </tr>
                            <tr>
                                <td><strong>Total Revenue (7.5%)</strong></td>
                                <td id="income-revenue-h1">AED 317K</td>
                                <td>AED 563K</td>
                                <td>AED 9.45M</td>
                                <td>AED 22.3M</td>
                                <td>AED 51.8M</td>
                                <td>AED 118.8M</td>
                            </tr>
                            <tr class="section-header-row">
                                <td colspan="7">COSTS</td>
                            </tr>
                            <tr>
                                <td>Total Operating Expenses</td>
                                <td>AED 605K</td>
                                <td>AED 1.25M</td>
                                <td>AED 12M</td>
                                <td>AED 25M</td>
                                <td>AED 50M</td>
                                <td>AED 100M</td>
                            </tr>
                            <tr style="background: #fef5e7; font-weight: 600;">
                                <td><strong>Net Profit/(Loss)</strong></td>
                                <td id="income-profit-h1" style="color: #c0392b;">-AED 288K</td>
                                <td style="color: #c0392b;">-AED 687K</td>
                                <td style="color: #c0392b;">-AED 2.55M</td>
                                <td style="color: #c0392b;">-AED 2.7M</td>
                                <td style="color: #27ae60;">+AED 1.8M</td>
                                <td style="color: #27ae60;"><strong>+AED 18.8M</strong></td>
                            </tr>
                            <tr style="background: #e8f8f5;">
                                <td><strong>LTV:CAC Ratio</strong></td>
                                <td id="income-ltvcac">10.3x</td>
                                <td>9.0x</td>
                                <td>12.4x</td>
                                <td>13.5x</td>
                                <td>15.0x</td>
                                <td>16.5x</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="alert alert-success">
                    <strong>‚úÖ Path to Profitability:</strong> Break-even projected Year 3 with dynamic budget allocation.
                    Focus: H1 prove loop with budget-based scaling, Year 1-2 scale efficiently, Year 3+ optimize for margin.
                </div>
            </div>

            <!-- SENSITIVITY SHEET -->
            <div id="sensitivity" class="sheet">
                <h2 class="section-title">Sensitivity Analysis</h2>

                <div class="alert alert-info">
                    <strong>üí° Stress Testing:</strong> Even in downside scenarios, economics remain fundable (5.1x LTV:CAC at 6-month retention).
                </div>

                <h3 class="subsection-title">üîÑ Retention Sensitivity</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Scenario</th>
                                <th>Avg Retention</th>
                                <th>LTV</th>
                                <th>CAC</th>
                                <th>LTV:CAC</th>
                                <th>Verdict</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="background: #fee; border-left: 4px solid #e74c3c;">
                                <td><strong>Downside</strong></td>
                                <td>6 months</td>
                                <td>AED 180</td>
                                <td>AED 35</td>
                                <td><strong>5.1x</strong></td>
                                <td>Still above 3x benchmark ‚úì</td>
                            </tr>
                            <tr style="background: #fef5e7; border-left: 4px solid #f39c12;">
                                <td><strong>Conservative</strong></td>
                                <td>8 months</td>
                                <td>AED 240</td>
                                <td>AED 35</td>
                                <td><strong>6.9x</strong></td>
                                <td>Excellent by SaaS standards ‚úì</td>
                            </tr>
                            <tr style="background: #e8f8f5; border-left: 4px solid #27ae60;">
                                <td><strong>Base Case</strong></td>
                                <td>12 months</td>
                                <td id="sens-ltv-base">AED 360</td>
                                <td id="sens-cac-base">AED 35</td>
                                <td id="sens-ratio-base"><strong>10.3x</strong></td>
                                <td>H1 gate target ‚úì‚úì</td>
                            </tr>
                            <tr style="background: #fef9e7; border-left: 4px solid #f1c40f;">
                                <td><strong>With 3% Fraud</strong></td>
                                <td>12 months</td>
                                <td>AED 319</td>
                                <td>AED 35</td>
                                <td><strong>9.1x</strong></td>
                                <td>Post-fraud mitigation ‚úì‚úì</td>
                            </tr>
                            <tr style="background: #e8f5e9; border-left: 4px solid #4caf50;">
                                <td><strong>Optimistic</strong></td>
                                <td>18 months</td>
                                <td>AED 540</td>
                                <td>AED 35</td>
                                <td><strong>15.4x</strong></td>
                                <td>World-class ‚úì‚úì‚úì</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h3 class="subsection-title">üîÑ CAC Sensitivity</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Scenario</th>
                                <th>Blended CAC</th>
                                <th>LTV (12-mo)</th>
                                <th>LTV:CAC</th>
                                <th>Verdict</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="background: #e8f5e9;">
                                <td><strong>Optimistic</strong></td>
                                <td>AED 25</td>
                                <td id="sens-ltv-opt">AED 360</td>
                                <td><strong>14.4x</strong></td>
                                <td>Better QR conversion ‚úì‚úì‚úì</td>
                            </tr>
                            <tr style="background: #e8f8f5;">
                                <td><strong>Base Case</strong></td>
                                <td id="sens-cac-base2">AED 35</td>
                                <td id="sens-ltv-base2">AED 360</td>
                                <td id="sens-ratio-base2"><strong>10.3x</strong></td>
                                <td>Pitch deck target ‚úì‚úì</td>
                            </tr>
                            <tr style="background: #fef5e7;">
                                <td><strong>Conservative</strong></td>
                                <td>AED 50</td>
                                <td id="sens-ltv-cons">AED 360</td>
                                <td><strong>7.2x</strong></td>
                                <td>Need more ambassadors ‚úì</td>
                            </tr>
                            <tr style="background: #fee;">
                                <td><strong>Pessimistic</strong></td>
                                <td>AED 70</td>
                                <td id="sens-ltv-pess">AED 360</td>
                                <td><strong>5.1x</strong></td>
                                <td>Digital ads needed (still works) ‚úì</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h3 class="subsection-title">üö¶ Decision Matrix: When to Scale to H2</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>LTV:CAC</th>
                                <th>D30 Retention</th>
                                <th>MAU</th>
                                <th>Decision</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="background: #e8f8f5;">
                                <td>‚â• 8x</td>
                                <td>‚â• 25%</td>
                                <td>‚â• 10,000</td>
                                <td><strong>‚úÖ SCALE TO H2</strong> (Green light)</td>
                            </tr>
                            <tr style="background: #fef5e7;">
                                <td>5-8x</td>
                                <td>20-25%</td>
                                <td>7,000-10,000</td>
                                <td><strong>‚ö†Ô∏è ITERATE</strong> (Fix retention before scaling)</td>
                            </tr>
                            <tr style="background: #fee;">
                                <td>&lt; 5x</td>
                                <td>&lt; 20%</td>
                                <td>&lt; 7,000</td>
                                <td><strong>üõë PIVOT</strong> (Economics don't work, rethink model)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        function showSheet(sheetName) {
            console.log('showSheet called with:', sheetName);

            // Get all sheets
            const allSheets = document.querySelectorAll('.sheet');
            console.log('Total sheets found:', allSheets.length);

            // Hide all sheets
            allSheets.forEach(sheet => {
                sheet.classList.remove('active');
                console.log('Hiding sheet:', sheet.id);
            });

            // Show the requested sheet
            const targetSheet = document.getElementById(sheetName);
            if (targetSheet) {
                console.log('Found target sheet:', sheetName, 'Adding active class');
                targetSheet.classList.add('active');
                console.log('Sheet classes after adding active:', targetSheet.className);
                console.log('Sheet display style:', window.getComputedStyle(targetSheet).display);
            } else {
                console.error('Sheet not found:', sheetName);
            }

            // Update tabs to highlight the active one
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
                // Check if this tab's onclick matches the current sheet
                const onclickAttr = tab.getAttribute('onclick');
                if (onclickAttr && onclickAttr.includes(`'${sheetName}'`)) {
                    tab.classList.add('active');
                }
            });
        }

        // Store previous values for comparison
        let previousValues = {
            users: 0,
            mau: 0,
            revenue: 0,
            burn: 0,
            cash: 0
        };

        // Quick Scenario Functions
        function applyScenario(scenario) {
            // Remove active class from all buttons
            document.querySelectorAll('.scenario-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Add active class to clicked button
            document.querySelector(`[data-scenario="${scenario}"]`).classList.add('active');

            const scenarios = {
                conservative: { budget: 1468000, runway: 6, cac: 50, activation: 35 },
                moderate: { budget: 1468000, runway: 6, cac: 35, activation: 40 },
                aggressive: { budget: 1468000, runway: 6, cac: 20, activation: 50 },
                moonshot: { budget: 1468000, runway: 6, cac: 15, activation: 55 }
            };

            const config = scenarios[scenario];

            // Update inputs
            document.getElementById('quick-budget').value = config.budget;
            document.getElementById('quick-runway').value = config.runway;
            document.getElementById('quick-cac').value = config.cac;
            document.getElementById('quick-activation').value = config.activation;

            // Update actual assumption inputs
            document.getElementById('initial-budget-aed').value = config.budget;
            document.getElementById('runway-months').value = config.runway;
            document.getElementById('cac').value = config.cac;
            document.getElementById('activation-rate').value = config.activation;

            // Show calculating overlay
            showCalculating();

            // Recalculate with delay for visual feedback
            setTimeout(() => {
                updateAll();
                hideCalculating();
            }, 500);
        }

        function quickUpdateBudget(value) {
            document.getElementById('initial-budget-aed').value = value;
            debouncedUpdate();
        }

        function quickUpdateRunway(value) {
            document.getElementById('runway-months').value = value;
            debouncedUpdate();
        }

        function quickUpdateCAC(value) {
            document.getElementById('cac').value = value;
            debouncedUpdate();
        }

        function quickUpdateActivation(value) {
            document.getElementById('activation-rate').value = value;
            debouncedUpdate();
        }

        // Debounce function to avoid too many recalculations
        let updateTimeout;
        function debouncedUpdate() {
            clearTimeout(updateTimeout);
            showCalculating();
            updateTimeout = setTimeout(() => {
                updateAll();
                hideCalculating();
            }, 800);
        }

        // Show/hide calculating overlay
        function showCalculating() {
            let overlay = document.querySelector('.calculating-overlay');
            if (!overlay) {
                overlay = document.createElement('div');
                overlay.className = 'calculating-overlay';
                overlay.innerHTML = '<div class="spinner"></div>';
                document.body.appendChild(overlay);
            }
            overlay.classList.add('active');
        }

        function hideCalculating() {
            const overlay = document.querySelector('.calculating-overlay');
            if (overlay) {
                overlay.classList.remove('active');
            }
        }

        // Chart Rendering Functions

        // 1. Growth Trajectory Chart (Line Chart for MAU and Revenue)
        function renderGrowthChart(monthlyData) {
            const svg = document.getElementById('growth-chart-content');
            if (!svg || !monthlyData || monthlyData.length === 0) return;

            svg.innerHTML = ''; // Clear previous chart

            const width = 380;
            const height = 180;
            const padding = { top: 20, right: 20, bottom: 30, left: 50 };
            const chartWidth = width - padding.left - padding.right;
            const chartHeight = height - padding.top - padding.bottom;

            // Find max values for scaling
            const maxMAU = Math.max(...monthlyData.map(d => d.mau || 0));
            const maxRevenue = Math.max(...monthlyData.map(d => d.revenue || 0));

            // Draw grid lines
            for (let i = 0; i <= 4; i++) {
                const y = padding.top + (chartHeight / 4) * i;
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', padding.left);
                line.setAttribute('y1', y);
                line.setAttribute('x2', width - padding.right);
                line.setAttribute('y2', y);
                line.setAttribute('class', 'chart-grid-line');
                svg.appendChild(line);
            }

            // Draw MAU line
            let mauPath = `M ${padding.left} ${padding.top + chartHeight}`;
            monthlyData.forEach((d, i) => {
                const x = padding.left + (chartWidth / (monthlyData.length - 1)) * i;
                const y = padding.top + chartHeight - (d.mau / maxMAU) * chartHeight;
                mauPath += ` L ${x} ${y}`;
            });

            const mauLine = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            mauLine.setAttribute('d', mauPath);
            mauLine.setAttribute('class', 'chart-line');
            mauLine.setAttribute('stroke', '#3b82f6');
            svg.appendChild(mauLine);

            // Draw MAU dots
            monthlyData.forEach((d, i) => {
                const x = padding.left + (chartWidth / (monthlyData.length - 1)) * i;
                const y = padding.top + chartHeight - (d.mau / maxMAU) * chartHeight;
                const dot = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                dot.setAttribute('cx', x);
                dot.setAttribute('cy', y);
                dot.setAttribute('class', 'chart-dot');
                dot.setAttribute('stroke', '#3b82f6');
                svg.appendChild(dot);
            });

            // Draw Revenue line
            let revPath = `M ${padding.left} ${padding.top + chartHeight}`;
            monthlyData.forEach((d, i) => {
                const x = padding.left + (chartWidth / (monthlyData.length - 1)) * i;
                const y = padding.top + chartHeight - (d.revenue / maxRevenue) * chartHeight;
                revPath += ` L ${x} ${y}`;
            });

            const revLine = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            revLine.setAttribute('d', revPath);
            revLine.setAttribute('class', 'chart-line');
            revLine.setAttribute('stroke', '#22c55e');
            svg.appendChild(revLine);

            // Draw Revenue dots
            monthlyData.forEach((d, i) => {
                const x = padding.left + (chartWidth / (monthlyData.length - 1)) * i;
                const y = padding.top + chartHeight - (d.revenue / maxRevenue) * chartHeight;
                const dot = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                dot.setAttribute('cx', x);
                dot.setAttribute('cy', y);
                dot.setAttribute('class', 'chart-dot');
                dot.setAttribute('stroke', '#22c55e');
                svg.appendChild(dot);
            });

            // Add month labels
            monthlyData.forEach((d, i) => {
                const x = padding.left + (chartWidth / (monthlyData.length - 1)) * i;
                const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                label.setAttribute('x', x);
                label.setAttribute('y', height - 5);
                label.setAttribute('class', 'chart-label');
                label.setAttribute('text-anchor', 'middle');
                label.textContent = `M${i + 1}`;
                svg.appendChild(label);
            });
        }

        // 2. Revenue Breakdown Bar Chart
        function renderRevenueChart(revenueStreams) {
            const container = document.getElementById('revenue-chart');
            if (!container || !revenueStreams) return;

            container.innerHTML = ''; // Clear previous chart

            const total = Object.values(revenueStreams).reduce((sum, val) => sum + val, 0);

            // Sort streams by value (descending)
            const sorted = Object.entries(revenueStreams)
                .sort((a, b) => b[1] - a[1])
                .filter(([_, val]) => val > 0);

            sorted.forEach(([name, value]) => {
                const percentage = total > 0 ? (value / total) * 100 : 0;

                const bar = document.createElement('div');
                bar.className = 'revenue-bar';
                bar.innerHTML = `
                    <span class="revenue-bar-label">${name}</span>
                    <div class="revenue-bar-fill" style="--fill-width: ${percentage}%"></div>
                    <span class="revenue-bar-value">AED ${(value / 1000).toFixed(0)}K</span>
                `;
                container.appendChild(bar);
            });
        }

        // 3. Expense Allocation Donut Chart
        function renderExpenseChart(expenses) {
            const svg = document.getElementById('expense-chart-content');
            if (!svg || !expenses) return;

            svg.innerHTML = ''; // Clear previous chart

            const total = Object.values(expenses).reduce((sum, val) => sum + val, 0);
            if (total === 0) return;

            const centerX = 100;
            const centerY = 100;
            const radius = 70;
            const innerRadius = 45;

            const colors = ['#667eea', '#22c55e', '#f97316', '#ec4899', '#a855f7'];

            let currentAngle = -90; // Start from top

            Object.entries(expenses).forEach(([name, value], index) => {
                const percentage = (value / total) * 100;
                const angle = (percentage / 100) * 360;

                // Create donut segment
                const startAngle = currentAngle;
                const endAngle = currentAngle + angle;

                const outerStart = polarToCartesian(centerX, centerY, radius, startAngle);
                const outerEnd = polarToCartesian(centerX, centerY, radius, endAngle);
                const innerStart = polarToCartesian(centerX, centerY, innerRadius, startAngle);
                const innerEnd = polarToCartesian(centerX, centerY, innerRadius, endAngle);

                const largeArc = angle > 180 ? 1 : 0;

                const pathData = [
                    `M ${outerStart.x} ${outerStart.y}`,
                    `A ${radius} ${radius} 0 ${largeArc} 1 ${outerEnd.x} ${outerEnd.y}`,
                    `L ${innerEnd.x} ${innerEnd.y}`,
                    `A ${innerRadius} ${innerRadius} 0 ${largeArc} 0 ${innerStart.x} ${innerStart.y}`,
                    'Z'
                ].join(' ');

                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', pathData);
                path.setAttribute('fill', colors[index % colors.length]);
                path.setAttribute('stroke', 'white');
                path.setAttribute('stroke-width', '2');
                svg.appendChild(path);

                // Add percentage label
                const labelAngle = startAngle + angle / 2;
                const labelRadius = (radius + innerRadius) / 2;
                const labelPos = polarToCartesian(centerX, centerY, labelRadius, labelAngle);

                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', labelPos.x);
                text.setAttribute('y', labelPos.y);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('dominant-baseline', 'middle');
                text.setAttribute('fill', 'white');
                text.setAttribute('font-size', '12');
                text.setAttribute('font-weight', 'bold');
                text.textContent = `${percentage.toFixed(0)}%`;
                svg.appendChild(text);

                currentAngle += angle;
            });

            // Center label
            const centerText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            centerText.setAttribute('x', centerX);
            centerText.setAttribute('y', centerY);
            centerText.setAttribute('text-anchor', 'middle');
            centerText.setAttribute('dominant-baseline', 'middle');
            centerText.setAttribute('fill', '#64748b');
            centerText.setAttribute('font-size', '14');
            centerText.setAttribute('font-weight', 'bold');
            centerText.textContent = `${(total / 1000).toFixed(0)}K`;
            svg.appendChild(centerText);
        }

        // Helper function for donut chart
        function polarToCartesian(centerX, centerY, radius, angleInDegrees) {
            const angleInRadians = (angleInDegrees * Math.PI) / 180.0;
            return {
                x: centerX + radius * Math.cos(angleInRadians),
                y: centerY + radius * Math.sin(angleInRadians)
            };
        }

        // 4. Cash Flow Area Chart
        function renderCashFlowChart(monthlyData) {
            const svg = document.getElementById('cashflow-chart-content');
            if (!svg || !monthlyData || monthlyData.length === 0) return;

            svg.innerHTML = ''; // Clear previous chart

            const width = 380;
            const height = 180;
            const padding = { top: 20, right: 20, bottom: 30, left: 50 };
            const chartWidth = width - padding.left - padding.right;
            const chartHeight = height - padding.top - padding.bottom;

            const maxCash = Math.max(...monthlyData.map(d => d.cash || 0));
            const minCash = Math.min(...monthlyData.map(d => d.cash || 0), 0);

            // Draw grid lines
            for (let i = 0; i <= 4; i++) {
                const y = padding.top + (chartHeight / 4) * i;
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', padding.left);
                line.setAttribute('y1', y);
                line.setAttribute('x2', width - padding.right);
                line.setAttribute('y2', y);
                line.setAttribute('class', 'chart-grid-line');
                svg.appendChild(line);
            }

            // Draw area fill
            let areaPath = `M ${padding.left} ${padding.top + chartHeight}`;
            monthlyData.forEach((d, i) => {
                const x = padding.left + (chartWidth / (monthlyData.length - 1)) * i;
                const y = padding.top + chartHeight - ((d.cash - minCash) / (maxCash - minCash)) * chartHeight;
                areaPath += ` L ${x} ${y}`;
            });
            areaPath += ` L ${padding.left + chartWidth} ${padding.top + chartHeight} Z`;

            const area = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            area.setAttribute('d', areaPath);
            area.setAttribute('fill', '#667eea');
            area.setAttribute('class', 'chart-area');
            svg.appendChild(area);

            // Draw line
            let linePath = `M ${padding.left} ${padding.top + chartHeight}`;
            monthlyData.forEach((d, i) => {
                const x = padding.left + (chartWidth / (monthlyData.length - 1)) * i;
                const y = padding.top + chartHeight - ((d.cash - minCash) / (maxCash - minCash)) * chartHeight;
                linePath += ` L ${x} ${y}`;
            });

            const line = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            line.setAttribute('d', linePath);
            line.setAttribute('class', 'chart-line');
            line.setAttribute('stroke', '#667eea');
            svg.appendChild(line);

            // Draw dots
            monthlyData.forEach((d, i) => {
                const x = padding.left + (chartWidth / (monthlyData.length - 1)) * i;
                const y = padding.top + chartHeight - ((d.cash - minCash) / (maxCash - minCash)) * chartHeight;
                const dot = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                dot.setAttribute('cx', x);
                dot.setAttribute('cy', y);
                dot.setAttribute('class', 'chart-dot');
                dot.setAttribute('stroke', '#667eea');
                svg.appendChild(dot);
            });

            // Add month labels
            monthlyData.forEach((d, i) => {
                const x = padding.left + (chartWidth / (monthlyData.length - 1)) * i;
                const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                label.setAttribute('x', x);
                label.setAttribute('y', height - 5);
                label.setAttribute('class', 'chart-label');
                label.setAttribute('text-anchor', 'middle');
                label.textContent = `M${i + 1}`;
                svg.appendChild(label);
            });
        }

        // Update Executive Summary Dashboard
        function updateExecutiveSummary(totalUsers, finalMAU, totalRevenue, netBurn, finalCash, runway) {
            // Format values
            const formatValue = (val, type) => {
                if (type === 'users') return Math.round(val).toLocaleString();
                if (type === 'aed') return 'AED ' + (val / 1000).toFixed(0) + 'K';
                if (type === 'runway') return val.toFixed(1) + ' mo';
                return val;
            };

            // Calculate changes
            const changes = {
                users: totalUsers - previousValues.users,
                mau: finalMAU - previousValues.mau,
                revenue: totalRevenue - previousValues.revenue,
                burn: netBurn - previousValues.burn,
                cash: finalCash - previousValues.cash
            };

            // Update values
            document.getElementById('summary-users-value').textContent = formatValue(totalUsers, 'users');
            document.getElementById('summary-mau-value').textContent = formatValue(finalMAU, 'users');
            document.getElementById('summary-revenue-value').textContent = formatValue(totalRevenue, 'aed');
            document.getElementById('summary-burn-value').textContent = formatValue(Math.abs(netBurn), 'aed');
            document.getElementById('summary-cash-value').textContent = formatValue(finalCash, 'aed');
            document.getElementById('summary-runway-value').textContent = formatValue(runway, 'runway');

            // Update change indicators
            if (previousValues.users > 0) {
                const changePercent = ((changes.users / previousValues.users) * 100).toFixed(0);
                if (changes.users > 0) {
                    document.getElementById('summary-users-change').innerHTML = `<span>‚ñ≤ ${changePercent}%</span><span>vs last scenario</span>`;
                    document.getElementById('summary-users-change').classList.add('up');
                    document.getElementById('summary-users-change').classList.remove('down');
                } else if (changes.users < 0) {
                    document.getElementById('summary-users-change').innerHTML = `<span>‚ñº ${Math.abs(changePercent)}%</span><span>vs last scenario</span>`;
                    document.getElementById('summary-users-change').classList.add('down');
                    document.getElementById('summary-users-change').classList.remove('up');
                }
            }

            // Store current values for next comparison
            previousValues = {
                users: totalUsers,
                mau: finalMAU,
                revenue: totalRevenue,
                burn: netBurn,
                cash: finalCash
            };
        }

        function updateAll() {
            console.log('üîÑ updateAll() called - recalculating entire model...');

            // Check if all required elements exist before proceeding
            if (!document.getElementById('aov') || !document.getElementById('user-churn') || !document.getElementById('initial-budget-aed')) {
                console.warn('‚ö†Ô∏è Some input elements not found yet, skipping update');
                return;
            }

            // ==========================================
            // STEP 1: GET ALL INPUT VALUES
            // ==========================================
            const aov = parseFloat(document.getElementById('aov').value) || 100;
            const frequency = parseFloat(document.getElementById('frequency').value) || 4;
            const cac = parseFloat(document.getElementById('cac').value) || 35;
            // monthlyRpu is calculated below from 7 revenue streams
            const retentionMonths = parseFloat(document.getElementById('retention-months').value) || 12;
            const activationRate = parseFloat(document.getElementById('activation-rate').value) || 30;
            const userChurn = parseFloat(document.getElementById('user-churn').value) || 8.3;
            const merchantChurn = parseFloat(document.getElementById('merchant-churn').value) || 5;
            // Legacy fields - use defaults (not in UI)
            const merchantFeeRate = 15; // Not used in current model
            const userCashbackRate = 7;  // Not used in current model
            const initialBudgetAed = parseFloat(document.getElementById('initial-budget-aed').value) || 500000;
            const runwayTarget = parseFloat(document.getElementById('runway-months').value) || 9;
            console.log(`üí∞ Initial Budget: AED ${(initialBudgetAed/1000).toFixed(0)}K, Target Runway: ${runwayTarget} months`);

            // Additional funding for each month (up to 12 months)
            const fundingM1 = parseFloat(document.getElementById('funding-m1').value) || 0;
            const fundingM2 = parseFloat(document.getElementById('funding-m2').value) || 0;
            const fundingM3 = parseFloat(document.getElementById('funding-m3').value) || 0;
            const fundingM4 = parseFloat(document.getElementById('funding-m4').value) || 0;
            const fundingM5 = parseFloat(document.getElementById('funding-m5').value) || 0;
            const fundingM6 = parseFloat(document.getElementById('funding-m6').value) || 0;
            const fundingM7 = parseFloat(document.getElementById('funding-m7').value) || 0;
            const fundingM8 = parseFloat(document.getElementById('funding-m8').value) || 0;
            const fundingM9 = parseFloat(document.getElementById('funding-m9').value) || 0;
            const fundingM10 = parseFloat(document.getElementById('funding-m10').value) || 0;
            const fundingM11 = parseFloat(document.getElementById('funding-m11').value) || 0;
            const fundingM12 = parseFloat(document.getElementById('funding-m12').value) || 0;

            // One-time expenses for each month (up to 12 months)
            const expenseM1 = parseFloat(document.getElementById('expense-m1').value) || 0;
            const expenseM2 = parseFloat(document.getElementById('expense-m2').value) || 0;
            const expenseM3 = parseFloat(document.getElementById('expense-m3').value) || 0;
            const expenseM4 = parseFloat(document.getElementById('expense-m4').value) || 0;
            const expenseM5 = parseFloat(document.getElementById('expense-m5').value) || 0;
            const expenseM6 = parseFloat(document.getElementById('expense-m6').value) || 0;
            const expenseM7 = parseFloat(document.getElementById('expense-m7').value) || 0;
            const expenseM8 = parseFloat(document.getElementById('expense-m8').value) || 0;
            const expenseM9 = parseFloat(document.getElementById('expense-m9').value) || 0;
            const expenseM10 = parseFloat(document.getElementById('expense-m10').value) || 0;
            const expenseM11 = parseFloat(document.getElementById('expense-m11').value) || 0;
            const expenseM12 = parseFloat(document.getElementById('expense-m12').value) || 0;

            // New percentage-based budget allocation inputs
            const marketingPct = parseFloat(document.getElementById('marketing-pct').value) || 55;
            const salaryPct = parseFloat(document.getElementById('salary-pct').value) || 25;
            const techopsPct = parseFloat(document.getElementById('techops-pct').value) || 20;
            const customerAcqPct = parseFloat(document.getElementById('customer-acq-pct').value) || 60;
            const merchantAcqPct = parseFloat(document.getElementById('merchant-acq-pct').value) || 40;
            const rentFixed = parseFloat(document.getElementById('rent-fixed').value) || 5000;
            const cam = parseFloat(document.getElementById('cam').value) || 1000;

            // Log budget allocation percentages
            console.log(`üìä Budget Allocation: Marketing ${marketingPct}%, Salaries ${salaryPct}%, Tech/Ops ${techopsPct}%`);

            // Calculate monthly budget from initial budget and target runway
            // This means: if you have 500K and want 5 months runway, you can spend 100K/month
            const fixedMonthlyBudget = initialBudgetAed / runwayTarget;
            console.log(`üìä Calculated Monthly Budget: AED ${(fixedMonthlyBudget/1000).toFixed(1)}K (${(initialBudgetAed/1000).toFixed(0)}K √∑ ${runwayTarget} months)`);
            console.log(`   Raw values: initialBudgetAed=${initialBudgetAed}, runwayTarget=${runwayTarget}, fixedMonthlyBudget=${fixedMonthlyBudget}`);

            // Update the display field to show calculated monthly budget
            document.getElementById('fixed-monthly-budget').value = Math.round(fixedMonthlyBudget).toString();

            // KPI-gated phase progression (100% of targets)
            const h2GateMAU = parseFloat(document.getElementById('h2-gate-mau').value) || 10000;
            const h2GateMerchants = parseFloat(document.getElementById('h2-gate-merchants').value) || 250;
            const h2GateGMV = parseFloat(document.getElementById('h2-gate-gmv').value) || 10000000;
            const h2GateLtvCac = parseFloat(document.getElementById('h2-gate-ltvcac').value) || 10;

            const h3GateMAU = parseFloat(document.getElementById('h3-gate-mau').value) || 75000;
            const h3GateMerchants = parseFloat(document.getElementById('h3-gate-merchants').value) || 500;
            const h3GateGMV = parseFloat(document.getElementById('h3-gate-gmv').value) || 50000000;
            const h3GateRetention = parseFloat(document.getElementById('h3-gate-retention').value) || 30;

            const phase2GateMAU = parseFloat(document.getElementById('phase2-gate-mau').value) || 150000;
            const phase2GateMerchants = parseFloat(document.getElementById('phase2-gate-merchants').value) || 1000;
            const phase2GateEBITDA = parseFloat(document.getElementById('phase2-gate-ebitda').value) || 30;
            const phase2GateGMV = parseFloat(document.getElementById('phase2-gate-gmv').value) || 200000000;

            const locationExpansionMAU = parseFloat(document.getElementById('location-expansion-mau').value) || 50000;
            const maxMonths = parseInt(document.getElementById('max-months').value) || 36;
            const supportCostPer1K = parseFloat(document.getElementById('support-cost-per-1k').value) || 2000;
            const fundingAllocationWindow = parseInt(document.getElementById('funding-allocation-window').value) || 3;

            // 7 Revenue Streams
            const baseCommission = parseFloat(document.getElementById('base-commission').value) || 5;
            const noShareBonus = parseFloat(document.getElementById('no-share-bonus').value) || 5;
            const noShareRate = parseFloat(document.getElementById('no-share-rate').value) || 40;
            const promotedCommission = parseFloat(document.getElementById('promoted-commission').value) || 5;
            const promotedGmvPct = parseFloat(document.getElementById('promoted-gmv-pct').value) || 15;
            const merchantSubPrice = parseFloat(document.getElementById('merchant-sub-price').value) || 500;
            const merchantSubAttach = parseFloat(document.getElementById('merchant-sub-attach').value) || 20;
            const affiliateCommission = parseFloat(document.getElementById('affiliate-commission').value) || 3;
            const affiliateGmvPct = parseFloat(document.getElementById('affiliate-gmv-pct').value) || 10;
            const userSubPrice = parseFloat(document.getElementById('user-sub-price').value) || 29;
            const userSubAttach = parseFloat(document.getElementById('user-sub-attach').value) || 5;
            const financeRevenuePerUser = parseFloat(document.getElementById('finance-revenue-per-user').value) || 10;
            const financeAttach = parseFloat(document.getElementById('finance-attach').value) || 15;
            const b2bCommission = parseFloat(document.getElementById('b2b-commission').value) || 3;
            const b2bGmvPct = parseFloat(document.getElementById('b2b-gmv-pct').value) || 5;

            // ==========================================
            // STEP 2: CALCULATE DERIVED METRICS
            // ==========================================

            // Calculate weighted average commission rate for regular sales
            const avgCommissionRate = baseCommission + (noShareBonus * noShareRate / 100);

            // Calculate blended take rate from all GMV-based revenue
            const regularGmvPct = 100 - promotedGmvPct - affiliateGmvPct - b2bGmvPct;
            const blendedTakeRate = (
                (avgCommissionRate * regularGmvPct / 100) +
                (promotedCommission * promotedGmvPct / 100) +
                (affiliateCommission * affiliateGmvPct / 100) +
                (b2bCommission * b2bGmvPct / 100)
            );

            // Calculate RPU from all 7 revenue streams
            // GMV-based revenue per MAU
            const gmvPerMau = aov * frequency;
            const gmvBasedRevenue = gmvPerMau * (blendedTakeRate / 100);

            // Subscription revenue per MAU
            const userSubRevenue = userSubPrice * (userSubAttach / 100);
            const financeRevenue = financeRevenuePerUser * (financeAttach / 100);

            // Total RPU (will be adjusted with merchant subs in loop based on MAU:Merchant ratio)
            const monthlyRpuBase = gmvBasedRevenue + userSubRevenue + financeRevenue;

            // Update display fields
            document.getElementById('avg-commission-rate').value = avgCommissionRate.toFixed(1);
            document.getElementById('total-take-rate').value = blendedTakeRate.toFixed(2);
            document.getElementById('monthly-rpu').value = monthlyRpuBase.toFixed(0);

            const monthlyRpu = monthlyRpuBase; // For compatibility
            const ltv = monthlyRpu * retentionMonths;
            const ltvCacRatio = ltv / cac;
            const cacPayback = cac / monthlyRpu;
            const grossMargin = 100;
            const arpu = monthlyRpu;
            const contributionMargin = arpu;
            const cmPerUser = contributionMargin;
            const minBuffer = fixedMonthlyBudget * 3; // 3-month safety buffer

            // ==========================================
            // STEP 3: MONTH-BY-MONTH BUDGET ALLOCATION
            // ==========================================
            const months = 5; // For legacy H1 display
            let bankBalance = [initialBudgetAed];
            let revenues = [0]; // Month 0 revenue = 0
            let newFunding = [fundingM1, fundingM2, fundingM3, fundingM4, fundingM5, fundingM6, fundingM7, fundingM8, fundingM9, fundingM10, fundingM11, fundingM12];
            let oneTimeExpenses = [expenseM1, expenseM2, expenseM3, expenseM4, expenseM5, expenseM6, expenseM7, expenseM8, expenseM9, expenseM10, expenseM11, expenseM12];
            // Extend arrays to cover max possible months beyond month 12
            for (let i = 12; i < maxMonths; i++) {
                newFunding.push(0);
                oneTimeExpenses.push(0);
            }

            let rentBudgets = [];
            let techBudgets = [];
            let opsBudgets = [];
            let marketingBudgets = [];
            let customerAcqBudgets = [];
            let merchantAcqBudgets = [];
            let supportBudgets = [];
            let totalExpenses = [];
            let surpluses = [];
            let locationCounts = [];

            let newUsers = [];
            let newMerchants = [];
            let mauArray = [];
            let merchantsArray = [];
            let monthlyGMVs = [];
            let monthlyRevenues = [];

            let budgetFrozenMonths = []; // Track which months had frozen budgets

            // Track cumulative metrics for KPI gates
            let cumulativeGMV = 0;
            let currentPhase = 'H1'; // Start in H1
            let h1EndMonth = null; // Track when H1 ended
            let h2EndMonth = null; // Track when H2 ended
            let h3EndMonth = null; // Track when H3 ended

            // Monthly budget allocation array (calculated upfront for all months)
            // Initialize with base monthly budget for all months
            let monthlyBudgetAllocation = new Array(maxMonths).fill(fixedMonthlyBudget);

            console.log(`üìä Initial Setup: ${(initialBudgetAed/1000).toFixed(0)}K budget √∑ ${runwayTarget} months = ${(fixedMonthlyBudget/1000).toFixed(1)}K/month base allocation`);
            console.log(`   Array created: ${maxMonths} months, each with ${fixedMonthlyBudget} AED budget`);

            // Process each month - continue until Phase 2 achieved or max months reached
            let monthsSimulated = 0;
            for (let i = 0; i < maxMonths; i++) {
                const month = i + 1;
                monthsSimulated = month;

                // Get previous month's metrics for KPI gate checking
                const prevMAU = i === 0 ? 0 : mauArray[i - 1];
                const prevMerchants = i === 0 ? 0 : merchantsArray[i - 1];
                // LTV:CAC is constant (calculated from assumptions), use the initial value
                const currentLtvCac = ltvCacRatio;

                // Check KPI gates and advance phases
                if (currentPhase === 'H1' && h1EndMonth === null) {
                    // Log progress every 6 months
                    if (month % 6 === 0) {
                        console.log(`üìä H1‚ÜíH2 Gate Progress (Month ${month}): MAU=${Math.floor(prevMAU)}/${h2GateMAU} (${(prevMAU/h2GateMAU*100).toFixed(0)}%), Merchants=${Math.floor(prevMerchants)}/${h2GateMerchants}, GMV=${(cumulativeGMV/1000000).toFixed(1)}M/${(h2GateGMV/1000000).toFixed(0)}M, LTV:CAC=${currentLtvCac.toFixed(1)}x/${h2GateLtvCac}x`);
                    }

                    // Check if we hit H2 gate
                    if (prevMAU >= h2GateMAU && prevMerchants >= h2GateMerchants &&
                        cumulativeGMV >= h2GateGMV && currentLtvCac >= h2GateLtvCac) {
                        currentPhase = 'H2';
                        h1EndMonth = i;
                        console.log(`üéØ H1‚ÜíH2 TRANSITION at Month ${month}: MAU=${Math.floor(prevMAU)}, Merchants=${Math.floor(prevMerchants)}, GMV=${(cumulativeGMV/1000000).toFixed(1)}M, LTV:CAC=${currentLtvCac.toFixed(1)}x`);
                    }
                } else if (currentPhase === 'H2' && h2EndMonth === null) {
                    // Check if we hit H3 gate
                    if (prevMAU >= h3GateMAU && prevMerchants >= h3GateMerchants && cumulativeGMV >= h3GateGMV) {
                        currentPhase = 'H3';
                        h2EndMonth = i;
                        console.log(`üöÄ H2‚ÜíH3 TRANSITION at Month ${month}: MAU=${Math.floor(prevMAU)}, Merchants=${Math.floor(prevMerchants)}, GMV=${(cumulativeGMV/1000000).toFixed(1)}M`);
                    }
                } else if (currentPhase === 'H3' && h3EndMonth === null) {
                    // Check if we hit Phase 2 gate
                    const prevEBITDA = i === 0 ? 0 : ((monthlyRevenues[i-1] - totalExpenses[i-1]) / monthlyRevenues[i-1] * 100);
                    if (prevMAU >= phase2GateMAU && prevMerchants >= phase2GateMerchants &&
                        prevEBITDA >= phase2GateEBITDA && cumulativeGMV >= phase2GateGMV) {
                        currentPhase = 'Phase2';
                        h3EndMonth = i;
                        console.log(`üíº H3‚ÜíPhase2 TRANSITION at Month ${month}: MAU=${Math.floor(prevMAU)}, Merchants=${Math.floor(prevMerchants)}, EBITDA=${prevEBITDA.toFixed(1)}%, GMV=${(cumulativeGMV/1000000).toFixed(1)}M`);
                        console.log(`üéâ All KPI gates achieved! Projection will continue for a few more months to show stability.`);
                    }
                }

                // If we've been in Phase 2 for 6+ months, we can stop (optional stopping point)
                if (currentPhase === 'Phase2' && h3EndMonth !== null && (i - h3EndMonth) >= 6) {
                    console.log(`‚úÖ Phase 2 stable for 6 months. Projection complete at Month ${month}.`);
                    break;
                }

                // Determine number of locations based on MAU
                let numLocations = 1;
                if (locationExpansionMAU > 0 && prevMAU >= locationExpansionMAU) {
                    numLocations = 2;
                }
                locationCounts.push(numLocations);

                // STEP 1: Get this month's allocated budget (already calculated)
                const thisMonthAllocation = monthlyBudgetAllocation[i];

                // STEP 2: Deduct one-time expenses if any for this month
                const oneTimeExpense = oneTimeExpenses[i];
                let availableCash = thisMonthAllocation;

                if (oneTimeExpense > 0) {
                    console.log(`üí∏ Month ${month}: One-time expense of AED ${(oneTimeExpense/1000).toFixed(0)}K (hiring, equipment, legal, etc.)`);
                    availableCash -= oneTimeExpense;
                }

                // STEP 3: Calculate runway based on actual bank balance (for safety monitoring)
                const actualBankBalance = bankBalance[i];
                const currentRunway = actualBankBalance / fixedMonthlyBudget;
                const hasMinimumRunway = currentRunway >= 3;

                surpluses.push(availableCash - minBuffer);

                // STEP 3: PERCENTAGE-BASED BUDGET ALLOCATION
                // Allocate based on user preferences: Marketing 50-60%, Salaries 20-30%, Tech/Ops 10-20%

                // Marketing Budget (50-60% of total - for user & merchant acquisition)
                const marketingBudget = availableCash * (marketingPct / 100);
                marketingBudgets.push(marketingBudget);

                // Salary Budget (20-30% of total - founder, co-founder, key hires)
                const salaryBudget = availableCash * (salaryPct / 100);

                // Tech & Ops Budget (10-20% of total - infrastructure, operations)
                const techopsBudget = availableCash * (techopsPct / 100);

                // Rent is fixed per location
                const rent = rentFixed * numLocations;
                rentBudgets.push(rent);

                // Tech budget comes from techops allocation (minus rent)
                const techBudget = Math.max(0, techopsBudget - rent) * 0.6; // 60% of remaining for tech
                const opsBudget = Math.max(0, techopsBudget - rent) * 0.4; // 40% of remaining for ops

                // Customer Support scales with MAU (actual business metric)
                const currentMAUEstimate = i === 0 ? 0 : mauArray[i - 1];
                const supportBudget = (currentMAUEstimate / 1000) * supportCostPer1K;
                supportBudgets.push(supportBudget);

                techBudgets.push(techBudget);
                opsBudgets.push(opsBudget);

                // STEP 4: Calculate Total Expenses
                const totalFixedExpenses = rent + techBudget + opsBudget + supportBudget + salaryBudget;

                // Log budget breakdown (every 3 months or when funding received)
                if (month % 3 === 0 || newFunding[i] > 0 || month === 1) {
                    console.log(`Month ${month} Budget: Total=${(availableCash/1000).toFixed(0)}K | Marketing=${(marketingBudget/1000).toFixed(0)}K (${marketingPct}%) | Salaries=${(salaryBudget/1000).toFixed(0)}K (${salaryPct}%) | Tech/Ops=${(techopsBudget/1000).toFixed(0)}K (${techopsPct}%)`);
                }

                // Track if budget was affected by low runway
                budgetFrozenMonths.push(!hasMinimumRunway);

                // Within Marketing: Split between customer and merchant acquisition
                const customerAcqBudget = marketingBudget * (customerAcqPct / 100);
                const merchantAcqBudget = marketingBudget * (merchantAcqPct / 100);
                customerAcqBudgets.push(customerAcqBudget);
                merchantAcqBudgets.push(merchantAcqBudget);

                // STEP 6: Calculate Acquisitions
                const usersAcquired = Math.floor(customerAcqBudget / cac);
                const merchantsAcquired = Math.floor(merchantAcqBudget / cam);

                // Debug log for Month 1 and Month 5 to verify calculations (after all calculations)

                newUsers.push(usersAcquired);
                newMerchants.push(merchantsAcquired);

                // STEP 7: Calculate MAU with Churn
                let currentMAU;
                if (i === 0) {
                    currentMAU = usersAcquired * (activationRate / 100);
                } else {
                    currentMAU = (mauArray[i - 1] * (1 - userChurn / 100)) + (usersAcquired * (activationRate / 100));
                }
                mauArray.push(currentMAU);

                // Calculate Active Merchants with Churn
                let activeMerchants;
                if (i === 0) {
                    activeMerchants = merchantsAcquired;
                } else {
                    activeMerchants = (merchantsArray[i - 1] * (1 - merchantChurn / 100)) + merchantsAcquired;
                }
                merchantsArray.push(activeMerchants);

                // STEP 8: Calculate Revenue (All 7 Streams)
                const monthlyGMV = currentMAU * gmvPerMau;
                cumulativeGMV += monthlyGMV; // Track cumulative GMV for KPI gates

                // 1. Regular Sales Commission (weighted avg with social sharing)
                const regularGmv = monthlyGMV * (regularGmvPct / 100);
                const regularCommissionRev = regularGmv * (avgCommissionRate / 100);

                // 2. Promoted Sales Commission
                const promotedGmv = monthlyGMV * (promotedGmvPct / 100);
                const promotedRev = promotedGmv * (promotedCommission / 100);

                // 3. Business Subscription (Merchant SaaS)
                const merchantSubRev = activeMerchants * (merchantSubAttach / 100) * merchantSubPrice;

                // 4. Cash Store Affiliates Commission
                const affiliateGmv = monthlyGMV * (affiliateGmvPct / 100);
                const affiliateRev = affiliateGmv * (affiliateCommission / 100);

                // 5. User Subscription (Premium) - FREE FOR FIRST 12 MONTHS
                const userSubRev = month > 12 ? currentMAU * (userSubAttach / 100) * userSubPrice : 0;

                // 6. Finance (BNPL / Lending) - FREE FOR FIRST 12 MONTHS
                const financeRev = month > 12 ? currentMAU * (financeAttach / 100) * financeRevenuePerUser : 0;

                // 7. B2B Buying (Bulk Orders) - FREE FOR FIRST 12 MONTHS
                const b2bGmv = monthlyGMV * (b2bGmvPct / 100);
                const b2bRev = month > 12 ? b2bGmv * (b2bCommission / 100) : 0;

                // Total Revenue
                const monthlyRevenue = regularCommissionRev + promotedRev + merchantSubRev +
                                      affiliateRev + userSubRev + financeRev + b2bRev;

                monthlyGMVs.push(monthlyGMV);
                monthlyRevenues.push(monthlyRevenue);
                revenues.push(monthlyRevenue);

                // Total expenses for this month (recurring + one-time)
                const recurringExpenses = rent + techBudget + opsBudget + marketingBudget + supportBudget + salaryBudget;
                const totalExpense = recurringExpenses + oneTimeExpense;
                totalExpenses.push(totalExpense);

                // STEP 9: Update Bank Balance
                // Add: revenue earned this month + any new funding received this month
                // Subtract: total expenses for this month (already includes one-time expenses)
                const newBankBalance = bankBalance[i] + monthlyRevenue + newFunding[i] - totalExpense;
                bankBalance.push(newBankBalance);

                // STEP 10: Allocate revenue and funding to NEXT 3 months
                // This is the key: money earned THIS month gets allocated to NEXT 3 months
                const incomingCash = monthlyRevenue + newFunding[i];
                if (incomingCash > 0 && i + 1 < maxMonths) {
                    const allocationPerMonth = incomingCash / fundingAllocationWindow;
                    const allocationEndMonth = Math.min(i + fundingAllocationWindow, maxMonths - 1);

                    for (let j = i + 1; j <= allocationEndMonth; j++) {
                        monthlyBudgetAllocation[j] += allocationPerMonth;
                    }

                    if (monthlyRevenue > 0 && newFunding[i] > 0) {
                        console.log(`üí∞ Month ${month}: Revenue ${(monthlyRevenue/1000).toFixed(0)}K + Funding ${(newFunding[i]/1000).toFixed(0)}K = ${(incomingCash/1000).toFixed(0)}K allocated at ${(allocationPerMonth/1000).toFixed(1)}K/month to Months ${month+1}-${allocationEndMonth+1}`);
                    } else if (monthlyRevenue > 0) {
                        console.log(`üí∞ Month ${month}: Revenue ${(monthlyRevenue/1000).toFixed(0)}K allocated at ${(allocationPerMonth/1000).toFixed(1)}K/month to Months ${month+1}-${allocationEndMonth+1}`);
                    } else if (newFunding[i] > 0) {
                        console.log(`üí∞ Month ${month}: Funding ${(newFunding[i]/1000).toFixed(0)}K allocated at ${(allocationPerMonth/1000).toFixed(1)}K/month to Months ${month+1}-${allocationEndMonth+1}`);
                    }
                }

                // Debug log for Month 1 and Month 5 to verify calculations
                if (month === 1 || month === 5) {
                    console.log(`\nüîç MONTH ${month} DETAILED BREAKDOWN:`);
                    console.log(`   Allocated Budget: ${thisMonthAllocation.toFixed(0)} AED`);
                    console.log(`   Fixed Expenses: ${totalFixedExpenses.toFixed(0)} AED`);
                    console.log(`   Marketing Budget: ${marketingBudget.toFixed(0)} AED`);
                    console.log(`   Customer Acq Budget (${customerAcqPct}%): ${customerAcqBudget.toFixed(0)} AED`);
                    console.log(`   CAC: ${cac} AED per user`);
                    console.log(`   Users Acquired: ${usersAcquired} users`);
                    console.log(`   MAU: ${Math.round(currentMAU).toLocaleString()}`);
                    console.log(`   Merchants: ${Math.round(activeMerchants).toLocaleString()}`);
                    console.log(`   GMV: AED ${(monthlyGMV/1000).toFixed(0)}K`);
                    console.log(`   Revenue: AED ${(monthlyRevenue/1000).toFixed(0)}K\n`);
                }

                // STEP 11: Check for Cash Depletion
                // If cash runs out, stop the projection (can't continue without funding)
                if (newBankBalance < 0) {
                    console.warn(`üí∏ CASH DEPLETED at Month ${month}! Bank Balance: AED ${newBankBalance.toFixed(0)}`);
                    console.warn('Projection stopped. Add more funding or reduce expenses to continue.');
                    // Break the loop - can't project further without cash
                    break;
                }

                // Log current phase progress every 3 months
                if (month % 3 === 0) {
                    console.log(`Month ${month} Status: Phase=${currentPhase}, MAU=${Math.floor(currentMAU)}, Merchants=${Math.floor(activeMerchants)}, Cumulative GMV=AED ${(cumulativeGMV/1000000).toFixed(1)}M, Cash=AED ${(newBankBalance/1000).toFixed(0)}K`);
                }
            }

            // ==========================================
            // STEP 4: CALCULATE SUMMARY METRICS
            // ==========================================
            const actualMonthsRun = mauArray.length; // Actual months simulated (may be less than maxMonths if cash depleted)
            const finalMAU = mauArray[actualMonthsRun - 1] || 0;
            const finalMerchants = merchantsArray[actualMonthsRun - 1] || 0;
            const totalUsersAcquired = newUsers.reduce((a, b) => a + b, 0);
            const totalMerchantsAcquired = newMerchants.reduce((a, b) => a + b, 0);

            // cumulativeGMV is already tracked in the loop above
            let cumulativeRevenue = 0;
            for (let i = 0; i < actualMonthsRun; i++) {
                cumulativeRevenue += monthlyRevenues[i] || 0;
            }

            // Use last month's revenue as MRR
            const lastMonthRevenue = monthlyRevenues[actualMonthsRun - 1] || 0;
            const mrr = lastMonthRevenue;
            const arr = mrr * 12;

            const avgMonthlyBurn = totalExpenses.reduce((a, b) => a + b, 0) / actualMonthsRun;
            const netBurn = avgMonthlyBurn - mrr;
            const burnMultiple = arr > 0 ? netBurn / (arr / 12) : 0;
            const avgMarketingSpend = marketingBudgets.reduce((a, b) => a + b, 0) / actualMonthsRun;
            const magicNumber = avgMarketingSpend > 0 ? (mrr * 12) / avgMarketingSpend : 0;

            const finalCash = bankBalance[actualMonthsRun] || 0;
            const runwayRemaining = avgMonthlyBurn > 0 ? finalCash / avgMonthlyBurn : 0;

            // Growth metrics (use actual H1 end or first 5 months for CMGR)
            const h1EndIndex = h1EndMonth !== null ? h1EndMonth : Math.min(5, actualMonthsRun - 1);
            const cmgr = mauArray[h1EndIndex] > 0 && mauArray[0] > 0 ? Math.pow(mauArray[h1EndIndex] / mauArray[0], 1/h1EndIndex) - 1 : 0;
            const annualGrowth = (Math.pow(1 + cmgr, 12) - 1) * 100;
            const nrr = (1 - (userChurn / 100));

            const fixedCost = avgMonthlyBurn * 0.4; // Approximation
            const variableCost = avgMonthlyBurn * 0.6;
            const breakEvenMau = cmPerUser > 0 ? Math.ceil(fixedCost / cmPerUser) : 0;

            // ==========================================
            // STEP 5: UPDATE ALL UI ELEMENTS
            // ==========================================

            // Update auto-calculated fields (if they exist)
            const netTakeRateEl = document.getElementById('net-take-rate');
            if (netTakeRateEl) netTakeRateEl.value = blendedTakeRate.toFixed(1);

            // Update Dashboard
            document.getElementById('dash-ltvcac').textContent = ltvCacRatio.toFixed(1) + 'x';
            document.getElementById('dash-payback').textContent = cacPayback.toFixed(1);
            document.getElementById('dash-gross-margin').textContent = grossMargin + '%';
            document.getElementById('dash-burn-multiple').textContent = burnMultiple.toFixed(1);
            document.getElementById('dash-magic-number').textContent = magicNumber.toFixed(1);
            document.getElementById('dash-burn').textContent = 'AED ' + Math.round(avgMonthlyBurn/1000) + 'K';
            document.getElementById('dash-mrr').textContent = 'AED ' + Math.round(mrr/1000) + 'K';
            document.getElementById('dash-arr').textContent = 'AED ' + Math.round(arr/1000) + 'K';
            document.getElementById('dash-arpu').textContent = 'AED ' + arpu;
            document.getElementById('dash-cm').textContent = 'AED ' + contributionMargin.toFixed(0);
            document.getElementById('dash-breakeven-mau').textContent = breakEvenMau.toLocaleString();
            document.getElementById('dash-gmv-mau').textContent = 'AED ' + gmvPerMau;
            document.getElementById('dash-cmgr').textContent = (cmgr * 100).toFixed(0) + '%';
            document.getElementById('dash-user-churn').textContent = userChurn + '%';
            document.getElementById('dash-merchant-churn').textContent = merchantChurn + '%';
            document.getElementById('dash-nrr').textContent = (nrr * 100).toFixed(0) + '%';

            // Display Cash Runway Alert
            const cashRunwayAlert = document.getElementById('cash-runway-alert');
            if (cashRunwayAlert) {
                if (finalCash < 0) {
                    cashRunwayAlert.style.display = 'block';
                    cashRunwayAlert.className = 'alert alert-danger';
                    cashRunwayAlert.innerHTML = `<strong>üö® CRITICAL: Cash Depleted!</strong> Bank balance is negative (AED ${(finalCash/1000).toFixed(0)}K). Projection stopped at Month ${mauArray.length}. Add funding immediately or reduce expenses.`;
                } else if (runwayRemaining < 2) {
                    cashRunwayAlert.style.display = 'block';
                    cashRunwayAlert.className = 'alert alert-danger';
                    cashRunwayAlert.innerHTML = `<strong>‚ö†Ô∏è URGENT: Less than 2 months runway!</strong> Current cash: AED ${(finalCash/1000).toFixed(0)}K. Runway: ${runwayRemaining.toFixed(1)} months. Secure funding or cut costs now.`;
                } else if (runwayRemaining < 3) {
                    cashRunwayAlert.style.display = 'block';
                    cashRunwayAlert.className = 'alert alert-warning';
                    cashRunwayAlert.innerHTML = `<strong>‚ö†Ô∏è WARNING: Low runway.</strong> Current cash: AED ${(finalCash/1000).toFixed(0)}K. Runway: ${runwayRemaining.toFixed(1)} months. Start fundraising or cost optimization soon.`;
                } else if (runwayRemaining < 6) {
                    cashRunwayAlert.style.display = 'block';
                    cashRunwayAlert.className = 'alert alert-info';
                    cashRunwayAlert.innerHTML = `<strong>üí° Monitor: ${runwayRemaining.toFixed(1)} months runway.</strong> Current cash: AED ${(finalCash/1000).toFixed(0)}K. Consider fundraising timeline.`;
                } else {
                    cashRunwayAlert.style.display = 'none';
                }
            }

            // Display Budget Freeze Alert
            const budgetFreezeAlert = document.getElementById('budget-freeze-alert');
            if (budgetFreezeAlert) {
                const frozenMonthsCount = budgetFrozenMonths.filter(f => f).length;
                if (frozenMonthsCount > 0) {
                    budgetFreezeAlert.style.display = 'block';
                    budgetFreezeAlert.className = 'alert alert-warning';
                    budgetFreezeAlert.innerHTML = `<strong>üîí Budget Freeze Active:</strong> Budget was frozen for ${frozenMonthsCount} month(s) due to runway below 3 months. Budget increases (from revenue/funding) were paused to preserve cash. Add funding or reduce expenses to unlock budget growth.`;
                } else {
                    budgetFreezeAlert.style.display = 'none';
                }
            }

            // Update Advanced Metrics
            document.getElementById('adv-ltv').textContent = 'AED ' + ltv;
            document.getElementById('adv-cac').textContent = 'AED ' + cac;
            document.getElementById('adv-ltvcac').textContent = ltvCacRatio.toFixed(1) + 'x';
            document.getElementById('adv-cac-payback').textContent = cacPayback.toFixed(1);
            document.getElementById('adv-arpu').textContent = 'AED ' + arpu;
            document.getElementById('adv-cm').textContent = 'AED ' + contributionMargin.toFixed(0);
            document.getElementById('adv-cm-per-user').textContent = 'AED ' + cmPerUser.toFixed(0);
            document.getElementById('adv-gross-margin').textContent = grossMargin + '%';
            document.getElementById('adv-mrr').textContent = 'AED ' + Math.round(mrr/1000) + 'K';
            document.getElementById('adv-arr').textContent = 'AED ' + Math.round(arr/1000) + 'K';
            document.getElementById('adv-cmgr').textContent = (cmgr * 100).toFixed(0) + '%';
            document.getElementById('adv-annual-growth').textContent = annualGrowth.toFixed(0) + '%';
            document.getElementById('adv-gmv').textContent = 'AED ' + (cumulativeGMV/1000000).toFixed(2) + 'M';
            document.getElementById('adv-take-rate').textContent = blendedTakeRate.toFixed(1) + '%';
            document.getElementById('adv-nrr').textContent = (nrr * 100).toFixed(0) + '%';
            document.getElementById('adv-burn').textContent = 'AED ' + Math.round(avgMonthlyBurn/1000) + 'K';
            document.getElementById('adv-burn-multiple').textContent = burnMultiple.toFixed(1);
            document.getElementById('adv-magic').textContent = magicNumber.toFixed(1);
            document.getElementById('adv-runway').textContent = runwayRemaining.toFixed(1);
            document.getElementById('adv-cash').textContent = 'AED ' + (initialBudgetAed/1000).toFixed(0) + 'K';
            document.getElementById('adv-breakeven').textContent = breakEvenMau.toLocaleString();
            document.getElementById('adv-fixed-cost').textContent = 'AED ' + Math.round(fixedCost/1000) + 'K';
            document.getElementById('adv-variable-cost').textContent = 'AED ' + Math.round(variableCost/1000) + 'K';
            document.getElementById('adv-marketing').textContent = 'AED ' + Math.round(avgMarketingSpend/1000) + 'K';
            document.getElementById('adv-tech').textContent = 'AED ' + Math.round(techBudgets.reduce((a,b) => a+b, 0)/months/1000) + 'K';
            document.getElementById('adv-ops').textContent = 'AED ' + Math.round(opsBudgets.reduce((a,b) => a+b, 0)/months/1000) + 'K';
            document.getElementById('adv-downloads').textContent = totalUsersAcquired.toLocaleString();
            document.getElementById('adv-activation').textContent = activationRate + '%';
            document.getElementById('adv-mau').textContent = Math.round(finalMAU).toLocaleString();
            document.getElementById('adv-user-churn-display').textContent = userChurn + '%';
            document.getElementById('adv-merchants').textContent = Math.round(finalMerchants);
            document.getElementById('adv-merchant-churn-display').textContent = merchantChurn + '%';
            document.getElementById('adv-users-per-merchant').textContent = Math.round(finalMAU / finalMerchants);
            document.getElementById('adv-trans-merchant').textContent = Math.round((finalMAU * frequency) / finalMerchants / 30);

            // Update Cash Flow Sheet - Monthly Details
            for (let i = 0; i < months; i++) {
                const m = i + 1;
                document.getElementById(`cf-cash-m${m}-start`).textContent = 'AED ' + (bankBalance[i]/1000).toFixed(0) + 'K';
                document.getElementById(`cf-revenue-m${m}`).textContent = 'AED ' + ((i === 0 ? 0 : revenues[i])/1000).toFixed(0) + 'K';
                document.getElementById(`cf-funding-m${m}`).textContent = 'AED ' + (newFunding[i]/1000).toFixed(0) + 'K';
                document.getElementById(`cf-rent-m${m}`).textContent = 'AED ' + (rentBudgets[i]/1000).toFixed(0) + 'K';
                document.getElementById(`cf-tech-m${m}`).textContent = 'AED ' + (techBudgets[i]/1000).toFixed(0) + 'K';
                document.getElementById(`cf-ops-m${m}`).textContent = 'AED ' + (opsBudgets[i]/1000).toFixed(0) + 'K';
                document.getElementById(`cf-marketing-m${m}`).textContent = 'AED ' + (marketingBudgets[i]/1000).toFixed(0) + 'K';
                document.getElementById(`cf-cust-acq-m${m}`).textContent = 'AED ' + (customerAcqBudgets[i]/1000).toFixed(0) + 'K';
                document.getElementById(`cf-merch-acq-m${m}`).textContent = 'AED ' + (merchantAcqBudgets[i]/1000).toFixed(0) + 'K';
                document.getElementById(`cf-new-users-m${m}`).textContent = newUsers[i].toLocaleString();
                document.getElementById(`cf-new-merchants-m${m}`).textContent = newMerchants[i];
                document.getElementById(`cf-total-exp-m${m}`).textContent = 'AED ' + (totalExpenses[i]/1000).toFixed(0) + 'K';
                document.getElementById(`cf-cash-m${m}-end`).textContent = 'AED ' + (bankBalance[i+1]/1000).toFixed(0) + 'K';
                document.getElementById(`cf-surplus-m${m}`).textContent = 'AED ' + (surpluses[i]/1000).toFixed(0) + 'K';
            }

            // Update Cash Flow Summary
            document.getElementById('cf-total-users').textContent = totalUsersAcquired.toLocaleString();
            document.getElementById('cf-total-merchants').textContent = totalMerchantsAcquired;
            document.getElementById('cf-final-cash').textContent = 'AED ' + (finalCash/1000).toFixed(0) + 'K';
            document.getElementById('cf-runway').textContent = runwayRemaining.toFixed(1);

            // Update H1 Monthly Sheet
            const h1ActualMonths = h1EndMonth !== null ? h1EndMonth : Math.min(5, actualMonthsRun);
            console.log(`\nüìÖ Updating H1 Monthly Sheet: ${h1ActualMonths} months, actualMonthsRun=${actualMonthsRun}`);
            console.log(`üìä Sample data - Month 1: users=${newUsers[0]}, MAU=${Math.round(mauArray[0])}, merchants=${newMerchants[0]}`);
            console.log(`üìä Total users acquired across all H1 months: ${newUsers.slice(0, h1ActualMonths).reduce((a,b) => a+b, 0).toLocaleString()}\n`);

            for (let i = 0; i < h1ActualMonths; i++) {
                const m = i + 1;

                // USER METRICS
                const el = document.getElementById(`h1-new-users-m${m}`);
                if (el) {
                    el.textContent = newUsers[i].toLocaleString();
                    if (i === 0) console.log(`‚úÖ Updated h1-new-users-m1 element with value: ${newUsers[i]}`);
                } else {
                    console.error(`‚ùå Element h1-new-users-m${m} NOT FOUND`);
                }

                const setElText = (id, value) => {
                    const element = document.getElementById(id);
                    if (element) element.textContent = value;
                };

                setElText(`h1-mau-m${m}`, Math.round(mauArray[i]).toLocaleString());

                // Growth rate
                if (i > 0) {
                    const growthRate = ((mauArray[i] - mauArray[i-1]) / mauArray[i-1]) * 100;
                    setElText(`h1-growth-m${m}`, growthRate.toFixed(0) + '%');
                } else {
                    setElText(`h1-growth-m${m}`, '-');
                }

                // Churn rate (user churn percentage)
                setElText(`h1-churn-m${m}`, userChurn.toFixed(1) + '%');

                // Activation rate
                setElText(`h1-activation-m${m}`, activationRate.toFixed(0) + '%');

                // Total downloads (cumulative)
                let cumDownloads = 0;
                for (let j = 0; j <= i; j++) {
                    cumDownloads += newUsers[j];
                }
                setElText(`h1-downloads-m${m}`, cumDownloads.toLocaleString());

                // MERCHANT METRICS
                setElText(`h1-new-merchants-m${m}`, newMerchants[i]);
                setElText(`h1-merchants-m${m}`, Math.round(merchantsArray[i]));
                setElText(`h1-merchant-churn-m${m}`, merchantChurn.toFixed(1) + '%');

                // Paid business subscribers (merchant sub attach rate)
                const paidMerchants = Math.round(merchantsArray[i] * (merchantSubAttach / 100));
                setElText(`h1-paid-merchants-m${m}`, paidMerchants);

                // LOCATION METRICS
                setElText(`h1-cities-m${m}`, locationCounts[i]);

                // REVENUE BREAKDOWN (7 streams)
                const mau = mauArray[i];
                const gmv = monthlyGMVs[i];

                // 1. Commission on sales
                const commissionRev = (gmv * (baseCommission / 100)) + (gmv * (noShareRate / 100) * (noShareBonus / 100));
                setElText(`h1-commission-m${m}`, 'AED ' + (commissionRev / 1000).toFixed(0) + 'K');

                // 2. Promoted sales
                const promotedRev = gmv * (promotedGmvPct / 100) * (promotedCommission / 100);
                setElText(`h1-promoted-m${m}`, 'AED ' + (promotedRev / 1000).toFixed(0) + 'K');

                // 3. Merchant subscription
                const merchantSubRev = paidMerchants * merchantSubPrice;
                setElText(`h1-merchant-sub-m${m}`, 'AED ' + (merchantSubRev / 1000).toFixed(0) + 'K');

                // 4. Affiliate commission
                const affiliateRev = gmv * (affiliateGmvPct / 100) * (affiliateCommission / 100);
                setElText(`h1-affiliate-m${m}`, 'AED ' + (affiliateRev / 1000).toFixed(0) + 'K');

                // 5. User subscription
                const userSubRev = mau * (userSubAttach / 100) * userSubPrice;
                setElText(`h1-user-sub-m${m}`, 'AED ' + (userSubRev / 1000).toFixed(0) + 'K');

                // 6. Finance revenue
                const financeRev = mau * (financeAttach / 100) * financeRevenuePerUser;
                setElText(`h1-finance-m${m}`, 'AED ' + (financeRev / 1000).toFixed(0) + 'K');

                // 7. B2B revenue
                const b2bRev = gmv * (b2bGmvPct / 100) * (b2bCommission / 100);
                setElText(`h1-b2b-m${m}`, 'AED ' + (b2bRev / 1000).toFixed(0) + 'K');

                // Total revenue
                setElText(`h1-revenue-m${m}`, 'AED ' + (monthlyRevenues[i] / 1000).toFixed(0) + 'K');
                setElText(`h1-gmv-m${m}`, 'AED ' + (gmv / 1000000).toFixed(2) + 'M');

                // Cumulative GMV
                let cumGMV = 0;
                for (let j = 0; j <= i; j++) {
                    cumGMV += monthlyGMVs[j];
                }
                setElText(`h1-cum-gmv-m${m}`, 'AED ' + (cumGMV / 1000000).toFixed(2) + 'M');

                // EXPENSES BREAKDOWN
                setElText(`h1-rent-m${m}`, 'AED ' + (rentBudgets[i] / 1000).toFixed(0) + 'K');
                setElText(`h1-tech-m${m}`, 'AED ' + (techBudgets[i] / 1000).toFixed(0) + 'K');
                setElText(`h1-ops-m${m}`, 'AED ' + (opsBudgets[i] / 1000).toFixed(0) + 'K');
                setElText(`h1-support-m${m}`, 'AED ' + (supportBudgets[i] / 1000).toFixed(0) + 'K');
                setElText(`h1-marketing-m${m}`, 'AED ' + (marketingBudgets[i] / 1000).toFixed(0) + 'K');
                setElText(`h1-total-expense-m${m}`, 'AED ' + (totalExpenses[i] / 1000).toFixed(0) + 'K');

                // NET & CASH FLOW
                const netBurnMonth = monthlyRevenues[i] - totalExpenses[i];
                if (netBurnMonth >= 0) {
                    setElText(`h1-net-m${m}`, '+AED ' + (netBurnMonth / 1000).toFixed(0) + 'K');
                } else {
                    setElText(`h1-net-m${m}`, '-AED ' + (Math.abs(netBurnMonth) / 1000).toFixed(0) + 'K');
                }

                // Cash in hand (end of month)
                setElText(`h1-cash-m${m}`, 'AED ' + (bankBalance[i + 1] / 1000).toFixed(0) + 'K');

                // Budget allocated for this month
                setElText(`h1-budget-allocated-m${m}`, 'AED ' + (monthlyBudgetAllocation[i] / 1000).toFixed(0) + 'K');

                // Revenue allocated to future months
                const futureAllocation = (monthlyRevenues[i] + newFunding[i]) / fundingAllocationWindow;
                setElText(`h1-future-allocation-m${m}`, 'AED ' + (futureAllocation / 1000).toFixed(0) + 'K/mo');
            }

            const setElText = (id, value) => {
                const element = document.getElementById(id);
                if (element) element.textContent = value;
            };

            // Calculate totals for H1
            let h1TotalDownloads = 0;
            let h1TotalPaidMerchants = 0;
            let h1TotalCommission = 0;
            let h1TotalPromoted = 0;
            let h1TotalMerchantSub = 0;
            let h1TotalAffiliate = 0;
            let h1TotalUserSub = 0;
            let h1TotalFinance = 0;
            let h1TotalB2B = 0;
            let h1TotalRent = 0;
            let h1TotalTech = 0;
            let h1TotalOps = 0;
            let h1TotalSupport = 0;
            let h1TotalMarketing = 0;
            let h1TotalExpenses = 0;
            let h1TotalFutureAllocation = 0;

            for (let i = 0; i < h1ActualMonths; i++) {
                h1TotalDownloads += newUsers[i];
                const paidMerchants = Math.round(merchantsArray[i] * (merchantSubAttach / 100));
                h1TotalPaidMerchants = paidMerchants; // Latest value

                const gmv = monthlyGMVs[i];
                const mau = mauArray[i];
                h1TotalCommission += (gmv * (baseCommission / 100)) + (gmv * (noShareRate / 100) * (noShareBonus / 100));
                h1TotalPromoted += gmv * (promotedGmvPct / 100) * (promotedCommission / 100);
                h1TotalMerchantSub += paidMerchants * merchantSubPrice;
                h1TotalAffiliate += gmv * (affiliateGmvPct / 100) * (affiliateCommission / 100);
                h1TotalUserSub += mau * (userSubAttach / 100) * userSubPrice;
                h1TotalFinance += mau * (financeAttach / 100) * financeRevenuePerUser;
                h1TotalB2B += gmv * (b2bGmvPct / 100) * (b2bCommission / 100);

                h1TotalRent += rentBudgets[i];
                h1TotalTech += techBudgets[i];
                h1TotalOps += opsBudgets[i];
                h1TotalSupport += supportBudgets[i];
                h1TotalMarketing += marketingBudgets[i];
                h1TotalExpenses += totalExpenses[i];
                h1TotalFutureAllocation += (monthlyRevenues[i] + newFunding[i]);
            }

            // USER METRICS TOTALS
            setElText('h1-new-users-total', h1TotalDownloads.toLocaleString()); // Sum of all new users
            setElText('h1-mau-total', Math.round(finalMAU).toLocaleString()); // Final MAU (not sum)
            setElText('h1-downloads-total', h1TotalDownloads.toLocaleString()); // Cumulative downloads = total new users

            // MERCHANT METRICS TOTALS
            setElText('h1-new-merchants-total', totalMerchantsAcquired); // Sum of all new merchants
            setElText('h1-merchants-total', Math.round(finalMerchants)); // Final active merchants (not sum)
            setElText('h1-paid-merchants-total', h1TotalPaidMerchants); // Final paid merchants (not sum)
            setElText('h1-cities-total', locationCounts[h1ActualMonths - 1]); // Final city count (not sum)

            console.log(`\nüìä H1 TOTALS VERIFICATION:`);
            console.log(`   Total New Users (sum): ${h1TotalDownloads.toLocaleString()}`);
            console.log(`   Final MAU: ${Math.round(finalMAU).toLocaleString()}`);
            console.log(`   Total New Merchants (sum): ${totalMerchantsAcquired}`);
            console.log(`   Final Active Merchants: ${Math.round(finalMerchants)}`);
            console.log(`   Total Revenue (sum): AED ${(cumulativeRevenue/1000).toFixed(0)}K`);
            console.log(`   Total Expenses (sum): AED ${(h1TotalExpenses/1000).toFixed(0)}K`);
            console.log(`   Net (Revenue - Expenses): AED ${((cumulativeRevenue - h1TotalExpenses)/1000).toFixed(0)}K`);
            console.log(`   Final Cash Balance: AED ${(bankBalance[h1ActualMonths]/1000).toFixed(0)}K\n`);

            // Revenue breakdown totals
            setElText('h1-commission-total', 'AED ' + (h1TotalCommission / 1000).toFixed(0) + 'K');
            setElText('h1-promoted-total', 'AED ' + (h1TotalPromoted / 1000).toFixed(0) + 'K');
            setElText('h1-merchant-sub-total', 'AED ' + (h1TotalMerchantSub / 1000).toFixed(0) + 'K');
            setElText('h1-affiliate-total', 'AED ' + (h1TotalAffiliate / 1000).toFixed(0) + 'K');
            setElText('h1-user-sub-total', 'AED ' + (h1TotalUserSub / 1000).toFixed(0) + 'K');
            setElText('h1-finance-total', 'AED ' + (h1TotalFinance / 1000).toFixed(0) + 'K');
            setElText('h1-b2b-total', 'AED ' + (h1TotalB2B / 1000).toFixed(0) + 'K');

            setElText('h1-cum-gmv-total', 'AED ' + (cumulativeGMV / 1000000).toFixed(2) + 'M');
            setElText('h1-revenue-total', 'AED ' + (cumulativeRevenue / 1000).toFixed(0) + 'K');

            // Expenses breakdown totals
            setElText('h1-rent-total', 'AED ' + (h1TotalRent / 1000).toFixed(0) + 'K');
            setElText('h1-tech-total', 'AED ' + (h1TotalTech / 1000).toFixed(0) + 'K');
            setElText('h1-ops-total', 'AED ' + (h1TotalOps / 1000).toFixed(0) + 'K');
            setElText('h1-support-total', 'AED ' + (h1TotalSupport / 1000).toFixed(0) + 'K');
            setElText('h1-marketing-total', 'AED ' + (h1TotalMarketing / 1000).toFixed(0) + 'K');
            setElText('h1-total-expense-total', 'AED ' + (h1TotalExpenses / 1000).toFixed(0) + 'K');

            // Net & cash flow totals
            const h1TotalNet = cumulativeRevenue - h1TotalExpenses;
            if (h1TotalNet >= 0) {
                setElText('h1-net-total', '+AED ' + (h1TotalNet / 1000).toFixed(0) + 'K');
            } else {
                setElText('h1-net-total', '-AED ' + (Math.abs(h1TotalNet) / 1000).toFixed(0) + 'K');
            }

            setElText('h1-cash-total', 'AED ' + (bankBalance[h1ActualMonths] / 1000).toFixed(0) + 'K');
            setElText('h1-future-allocation-total', 'AED ' + (h1TotalFutureAllocation / 1000).toFixed(0) + 'K');

            // Summary
            setElText('h1-final-mau', Math.round(finalMAU).toLocaleString());
            setElText('h1-final-merchants', Math.round(finalMerchants));
            setElText('h1-final-gmv', 'AED ' + (cumulativeGMV / 1000000).toFixed(2) + 'M');

            // Update Executive Summary Dashboard
            const h1RunwayRemaining = bankBalance[h1ActualMonths] / (h1TotalExpenses / h1ActualMonths);
            updateExecutiveSummary(
                h1TotalDownloads,                    // Total users
                finalMAU,                            // Final MAU
                cumulativeRevenue,                   // Total revenue
                h1TotalNet,                          // Net burn
                bankBalance[h1ActualMonths],         // Final cash
                h1RunwayRemaining                    // Runway
            );

            // Update Visual Analytics Charts
            // Prepare data for Growth Chart (MAU & Revenue)
            const growthData = [];
            for (let i = 0; i < h1ActualMonths; i++) {
                growthData.push({
                    mau: mauArray[i],
                    revenue: commissionRevenue[i] + promotedRevenue[i] + merchantSubRevenue[i] +
                             affiliateRevenue[i] + userSubRevenue[i] + financeRevenue[i] + b2bRevenue[i]
                });
            }
            renderGrowthChart(growthData);

            // Prepare data for Revenue Breakdown Chart
            const revenueStreams = {
                'Commission': commissionRevenue.slice(0, h1ActualMonths).reduce((a, b) => a + b, 0),
                'Promoted Sales': promotedRevenue.slice(0, h1ActualMonths).reduce((a, b) => a + b, 0),
                'Merchant Subs': merchantSubRevenue.slice(0, h1ActualMonths).reduce((a, b) => a + b, 0),
                'Affiliate': affiliateRevenue.slice(0, h1ActualMonths).reduce((a, b) => a + b, 0),
                'User Subs': userSubRevenue.slice(0, h1ActualMonths).reduce((a, b) => a + b, 0),
                'Finance': financeRevenue.slice(0, h1ActualMonths).reduce((a, b) => a + b, 0),
                'B2B': b2bRevenue.slice(0, h1ActualMonths).reduce((a, b) => a + b, 0)
            };
            renderRevenueChart(revenueStreams);

            // Prepare data for Expense Allocation Chart
            const expenseCategories = {
                'Marketing': marketingBudget.slice(0, h1ActualMonths).reduce((a, b) => a + b, 0),
                'Tech & Dev': devBudget.slice(0, h1ActualMonths).reduce((a, b) => a + b, 0),
                'Operations': opsBudget.slice(0, h1ActualMonths).reduce((a, b) => a + b, 0),
                'Fixed Costs': fixedExpenses.slice(0, h1ActualMonths).reduce((a, b) => a + b, 0),
                'One-Time': oneTimeExpenses.slice(0, h1ActualMonths).reduce((a, b) => a + b, 0)
            };
            renderExpenseChart(expenseCategories);

            // Prepare data for Cash Flow Chart
            const cashFlowData = [];
            for (let i = 0; i < h1ActualMonths; i++) {
                cashFlowData.push({
                    cash: bankBalance[i]
                });
            }
            renderCashFlowChart(cashFlowData);

            // Update H2 Monthly Sheet
            const h2StartMonth = h1EndMonth !== null ? h1EndMonth + 1 : 999; // Start after H1 ends
            const h2EndMonthCalc = h2EndMonth !== null ? h2EndMonth : actualMonthsRun; // End when H2 gate hit or projection ends
            const h2Duration = h2EndMonthCalc - h2StartMonth;
            const h2DurationEl = document.getElementById('h2-duration');
            if (h2DurationEl) h2DurationEl.textContent = h2Duration > 0 ? h2Duration + ' months' : 'Not reached';

            if (h2Duration > 0 && actualMonthsRun > h2StartMonth) {
                const h2ActualMonths = Math.min(h2EndMonthCalc - h2StartMonth, 3); // Up to 3 months (M6, M7, M8)
                console.log(`\nüìÖ Updating H2 Monthly Sheet: ${h2ActualMonths} months starting from index ${h2StartMonth}`);

                for (let idx = 0; idx < h2ActualMonths; idx++) {
                    const i = h2StartMonth + idx; // Array index
                    if (i >= actualMonthsRun) break;

                    const m = i + 1; // Month number (1-based)

                    const setElText = (id, value) => {
                        const element = document.getElementById(id);
                        if (element) element.textContent = value;
                    };

                    // USER METRICS
                    setElText(`h2-new-users-m${m}`, newUsers[i].toLocaleString());
                    setElText(`h2-mau-m${m}`, Math.round(mauArray[i]).toLocaleString());

                    // Growth rate
                    if (i > 0) {
                        const growthRate = ((mauArray[i] - mauArray[i-1]) / mauArray[i-1]) * 100;
                        setElText(`h2-growth-m${m}`, growthRate.toFixed(0) + '%');
                    } else {
                        setElText(`h2-growth-m${m}`, '-');
                    }

                    // Churn rate (user churn percentage)
                    setElText(`h2-churn-m${m}`, userChurn.toFixed(1) + '%');

                    // Activation rate
                    setElText(`h2-activation-m${m}`, activationRate.toFixed(0) + '%');

                    // Total downloads (cumulative)
                    let cumDownloads = 0;
                    for (let j = 0; j <= i; j++) {
                        cumDownloads += newUsers[j];
                    }
                    setElText(`h2-downloads-m${m}`, cumDownloads.toLocaleString());

                    // MERCHANT METRICS
                    setElText(`h2-new-merchants-m${m}`, newMerchants[i]);
                    setElText(`h2-merchants-m${m}`, Math.round(merchantsArray[i]));
                    setElText(`h2-merchant-churn-m${m}`, merchantChurn.toFixed(1) + '%');

                    // Paid business subscribers (merchant sub attach rate)
                    const paidMerchants = Math.round(merchantsArray[i] * (merchantSubAttach / 100));
                    setElText(`h2-paid-merchants-m${m}`, paidMerchants);

                    // LOCATION METRICS
                    setElText(`h2-cities-m${m}`, locationCounts[i]);

                    // REVENUE BREAKDOWN (7 streams)
                    const mau = mauArray[i];
                    const gmv = monthlyGMVs[i];

                    // 1. Commission on sales
                    const commissionRev = (gmv * (baseCommission / 100)) + (gmv * (noShareRate / 100) * (noShareBonus / 100));
                    setElText(`h2-commission-m${m}`, 'AED ' + (commissionRev / 1000).toFixed(0) + 'K');

                    // 2. Promoted sales
                    const promotedRev = gmv * (promotedGmvPct / 100) * (promotedCommission / 100);
                    setElText(`h2-promoted-m${m}`, 'AED ' + (promotedRev / 1000).toFixed(0) + 'K');

                    // 3. Merchant subscription
                    const merchantSubRev = paidMerchants * merchantSubPrice;
                    setElText(`h2-merchant-sub-m${m}`, 'AED ' + (merchantSubRev / 1000).toFixed(0) + 'K');

                    // 4. Affiliate commission
                    const affiliateRev = gmv * (affiliateGmvPct / 100) * (affiliateCommission / 100);
                    setElText(`h2-affiliate-m${m}`, 'AED ' + (affiliateRev / 1000).toFixed(0) + 'K');

                    // 5. User subscription
                    const userSubRev = mau * (userSubAttach / 100) * userSubPrice;
                    setElText(`h2-user-sub-m${m}`, 'AED ' + (userSubRev / 1000).toFixed(0) + 'K');

                    // 6. Finance revenue
                    const financeRev = mau * (financeAttach / 100) * financeRevenuePerUser;
                    setElText(`h2-finance-m${m}`, 'AED ' + (financeRev / 1000).toFixed(0) + 'K');

                    // 7. B2B revenue
                    const b2bRev = gmv * (b2bGmvPct / 100) * (b2bCommission / 100);
                    setElText(`h2-b2b-m${m}`, 'AED ' + (b2bRev / 1000).toFixed(0) + 'K');

                    // Total revenue
                    setElText(`h2-revenue-m${m}`, 'AED ' + (monthlyRevenues[i] / 1000).toFixed(0) + 'K');
                    setElText(`h2-gmv-m${m}`, 'AED ' + (gmv / 1000000).toFixed(2) + 'M');

                    // Cumulative GMV
                    let cumGMV = 0;
                    for (let j = 0; j <= i; j++) {
                        cumGMV += monthlyGMVs[j];
                    }
                    setElText(`h2-cum-gmv-m${m}`, 'AED ' + (cumGMV / 1000000).toFixed(2) + 'M');

                    // EXPENSES BREAKDOWN
                    setElText(`h2-rent-m${m}`, 'AED ' + (rentBudgets[i] / 1000).toFixed(0) + 'K');
                    setElText(`h2-tech-m${m}`, 'AED ' + (techBudgets[i] / 1000).toFixed(0) + 'K');
                    setElText(`h2-ops-m${m}`, 'AED ' + (opsBudgets[i] / 1000).toFixed(0) + 'K');
                    setElText(`h2-support-m${m}`, 'AED ' + (supportBudgets[i] / 1000).toFixed(0) + 'K');
                    setElText(`h2-marketing-m${m}`, 'AED ' + (marketingBudgets[i] / 1000).toFixed(0) + 'K');
                    setElText(`h2-total-expense-m${m}`, 'AED ' + (totalExpenses[i] / 1000).toFixed(0) + 'K');

                    // NET & CASH FLOW
                    const netBurnMonth = monthlyRevenues[i] - totalExpenses[i];
                    if (netBurnMonth >= 0) {
                        setElText(`h2-net-m${m}`, '+AED ' + (netBurnMonth / 1000).toFixed(0) + 'K');
                    } else {
                        setElText(`h2-net-m${m}`, '-AED ' + (Math.abs(netBurnMonth) / 1000).toFixed(0) + 'K');
                    }

                    // Cash in hand (end of month)
                    setElText(`h2-cash-m${m}`, 'AED ' + (bankBalance[i + 1] / 1000).toFixed(0) + 'K');

                    // Budget allocated for this month
                    setElText(`h2-budget-allocated-m${m}`, 'AED ' + (monthlyBudgetAllocation[i] / 1000).toFixed(0) + 'K');

                    // Revenue allocated to future months
                    const futureAllocation = (monthlyRevenues[i] + newFunding[i]) / fundingAllocationWindow;
                    setElText(`h2-future-allocation-m${m}`, 'AED ' + (futureAllocation / 1000).toFixed(0) + 'K/mo');
                }

                // H2 TOTALS
                const h2FinalIndex = Math.min(h2EndMonthCalc - 1, actualMonthsRun - 1);
                if (h2FinalIndex >= h2StartMonth) {
                    const h2FinalMAU = mauArray[h2FinalIndex] || 0;
                    const h2FinalMerchants = merchantsArray[h2FinalIndex] || 0;

                    let h2TotalDownloads = 0;
                    let h2TotalPaidMerchants = 0;
                    let h2TotalCommission = 0;
                    let h2TotalPromoted = 0;
                    let h2TotalMerchantSub = 0;
                    let h2TotalAffiliate = 0;
                    let h2TotalUserSub = 0;
                    let h2TotalFinance = 0;
                    let h2TotalB2B = 0;
                    let h2TotalRent = 0;
                    let h2TotalTech = 0;
                    let h2TotalOps = 0;
                    let h2TotalSupport = 0;
                    let h2TotalMarketing = 0;
                    let h2TotalExpenses = 0;
                    let h2TotalRevenue = 0;
                    let h2CumGMV = 0;
                    let h2TotalFutureAllocation = 0;

                    for (let i = h2StartMonth; i <= h2FinalIndex; i++) {
                        h2TotalDownloads += newUsers[i];
                        const paidMerchants = Math.round(merchantsArray[i] * (merchantSubAttach / 100));
                        h2TotalPaidMerchants = paidMerchants; // Latest value

                        const gmv = monthlyGMVs[i];
                        const mau = mauArray[i];
                        h2TotalCommission += (gmv * (baseCommission / 100)) + (gmv * (noShareRate / 100) * (noShareBonus / 100));
                        h2TotalPromoted += gmv * (promotedGmvPct / 100) * (promotedCommission / 100);
                        h2TotalMerchantSub += paidMerchants * merchantSubPrice;
                        h2TotalAffiliate += gmv * (affiliateGmvPct / 100) * (affiliateCommission / 100);
                        h2TotalUserSub += mau * (userSubAttach / 100) * userSubPrice;
                        h2TotalFinance += mau * (financeAttach / 100) * financeRevenuePerUser;
                        h2TotalB2B += gmv * (b2bGmvPct / 100) * (b2bCommission / 100);

                        h2TotalRent += rentBudgets[i];
                        h2TotalTech += techBudgets[i];
                        h2TotalOps += opsBudgets[i];
                        h2TotalSupport += supportBudgets[i];
                        h2TotalMarketing += marketingBudgets[i];
                        h2TotalExpenses += totalExpenses[i];
                        h2TotalRevenue += monthlyRevenues[i];
                        h2CumGMV += monthlyGMVs[i];
                        h2TotalFutureAllocation += (monthlyRevenues[i] + newFunding[i]);
                    }

                    const setElText = (id, value) => {
                        const element = document.getElementById(id);
                        if (element) element.textContent = value;
                    };

                    // USER METRICS TOTALS
                    setElText('h2-new-users-total', h2TotalDownloads.toLocaleString());
                    setElText('h2-mau-total', Math.round(h2FinalMAU).toLocaleString());

                    // Cumulative downloads from start through H2
                    let cumulativeDownloadsH2 = 0;
                    for (let j = 0; j <= h2FinalIndex; j++) {
                        cumulativeDownloadsH2 += newUsers[j];
                    }
                    setElText('h2-downloads-total', cumulativeDownloadsH2.toLocaleString());

                    // MERCHANT METRICS TOTALS
                    setElText('h2-new-merchants-total', newMerchants.slice(h2StartMonth, h2FinalIndex + 1).reduce((a,b) => a+b, 0));
                    setElText('h2-merchants-total', Math.round(h2FinalMerchants));
                    setElText('h2-paid-merchants-total', h2TotalPaidMerchants);
                    setElText('h2-cities-total', locationCounts[h2FinalIndex]);

                    // Revenue breakdown totals
                    setElText('h2-commission-total', 'AED ' + (h2TotalCommission / 1000).toFixed(0) + 'K');
                    setElText('h2-promoted-total', 'AED ' + (h2TotalPromoted / 1000).toFixed(0) + 'K');
                    setElText('h2-merchant-sub-total', 'AED ' + (h2TotalMerchantSub / 1000).toFixed(0) + 'K');
                    setElText('h2-affiliate-total', 'AED ' + (h2TotalAffiliate / 1000).toFixed(0) + 'K');
                    setElText('h2-user-sub-total', 'AED ' + (h2TotalUserSub / 1000).toFixed(0) + 'K');
                    setElText('h2-finance-total', 'AED ' + (h2TotalFinance / 1000).toFixed(0) + 'K');
                    setElText('h2-b2b-total', 'AED ' + (h2TotalB2B / 1000).toFixed(0) + 'K');

                    setElText('h2-cum-gmv-total', 'AED ' + (h2CumGMV / 1000000).toFixed(2) + 'M');
                    setElText('h2-revenue-total', 'AED ' + (h2TotalRevenue / 1000).toFixed(0) + 'K');

                    // Expenses breakdown totals
                    setElText('h2-rent-total', 'AED ' + (h2TotalRent / 1000).toFixed(0) + 'K');
                    setElText('h2-tech-total', 'AED ' + (h2TotalTech / 1000).toFixed(0) + 'K');
                    setElText('h2-ops-total', 'AED ' + (h2TotalOps / 1000).toFixed(0) + 'K');
                    setElText('h2-support-total', 'AED ' + (h2TotalSupport / 1000).toFixed(0) + 'K');
                    setElText('h2-marketing-total', 'AED ' + (h2TotalMarketing / 1000).toFixed(0) + 'K');
                    setElText('h2-total-expense-total', 'AED ' + (h2TotalExpenses / 1000).toFixed(0) + 'K');

                    // Net & cash flow totals
                    const h2TotalNet = h2TotalRevenue - h2TotalExpenses;
                    if (h2TotalNet >= 0) {
                        setElText('h2-net-total', '+AED ' + (h2TotalNet / 1000).toFixed(0) + 'K');
                    } else {
                        setElText('h2-net-total', '-AED ' + (Math.abs(h2TotalNet) / 1000).toFixed(0) + 'K');
                    }

                    setElText('h2-cash-total', 'AED ' + (bankBalance[h2FinalIndex + 1] / 1000).toFixed(0) + 'K');
                    setElText('h2-future-allocation-total', 'AED ' + (h2TotalFutureAllocation / 1000).toFixed(0) + 'K');

                    // Summary
                    setElText('h2-final-mau', Math.round(h2FinalMAU).toLocaleString());
                    setElText('h2-final-merchants', Math.round(h2FinalMerchants));
                    setElText('h2-final-gmv', 'AED ' + (h2CumGMV / 1000000).toFixed(2) + 'M');
                }
            }

            // Update H3 Monthly Sheet
            const h3StartMonth = h2EndMonth !== null ? h2EndMonth + 1 : 999; // Start after H2 ends
            const h3EndMonthCalc = h3EndMonth !== null ? h3EndMonth : actualMonthsRun; // End when H3 gate hit or projection ends
            const h3Duration = h3EndMonthCalc - h3StartMonth;
            const h3DurationEl = document.getElementById('h3-duration');
            if (h3DurationEl) h3DurationEl.textContent = h3Duration > 0 ? h3Duration + ' months' : 'Not reached';

            if (h3Duration > 0 && actualMonthsRun > h3StartMonth) {
                const h3ActualMonths = Math.min(h3EndMonthCalc - h3StartMonth, 4); // Up to 4 months (M9, M10, M11, M12)
                console.log(`\nüìÖ Updating H3 Monthly Sheet: ${h3ActualMonths} months starting from index ${h3StartMonth}`);

                for (let idx = 0; idx < h3ActualMonths; idx++) {
                    const i = h3StartMonth + idx; // Array index
                    if (i >= actualMonthsRun) break;

                    const m = i + 1; // Month number (1-based)

                    const setElText = (id, value) => {
                        const element = document.getElementById(id);
                        if (element) element.textContent = value;
                    };

                    // USER METRICS
                    setElText(`h3-new-users-m${m}`, newUsers[i].toLocaleString());
                    setElText(`h3-mau-m${m}`, Math.round(mauArray[i]).toLocaleString());

                    // Growth rate
                    if (i > 0) {
                        const growthRate = ((mauArray[i] - mauArray[i-1]) / mauArray[i-1]) * 100;
                        setElText(`h3-growth-m${m}`, growthRate.toFixed(0) + '%');
                    } else {
                        setElText(`h3-growth-m${m}`, '-');
                    }

                    // Churn rate (user churn percentage)
                    setElText(`h3-churn-m${m}`, userChurn.toFixed(1) + '%');

                    // Activation rate
                    setElText(`h3-activation-m${m}`, activationRate.toFixed(0) + '%');

                    // Total downloads (cumulative)
                    let cumDownloads = 0;
                    for (let j = 0; j <= i; j++) {
                        cumDownloads += newUsers[j];
                    }
                    setElText(`h3-downloads-m${m}`, cumDownloads.toLocaleString());

                    // MERCHANT METRICS
                    setElText(`h3-new-merchants-m${m}`, newMerchants[i]);
                    setElText(`h3-merchants-m${m}`, Math.round(merchantsArray[i]));
                    setElText(`h3-merchant-churn-m${m}`, merchantChurn.toFixed(1) + '%');

                    // Paid business subscribers (merchant sub attach rate)
                    const paidMerchants = Math.round(merchantsArray[i] * (merchantSubAttach / 100));
                    setElText(`h3-paid-merchants-m${m}`, paidMerchants);

                    // LOCATION METRICS
                    setElText(`h3-cities-m${m}`, locationCounts[i]);

                    // REVENUE BREAKDOWN (7 streams)
                    const mau = mauArray[i];
                    const gmv = monthlyGMVs[i];

                    // 1. Commission on sales
                    const commissionRev = (gmv * (baseCommission / 100)) + (gmv * (noShareRate / 100) * (noShareBonus / 100));
                    setElText(`h3-commission-m${m}`, 'AED ' + (commissionRev / 1000).toFixed(0) + 'K');

                    // 2. Promoted sales
                    const promotedRev = gmv * (promotedGmvPct / 100) * (promotedCommission / 100);
                    setElText(`h3-promoted-m${m}`, 'AED ' + (promotedRev / 1000).toFixed(0) + 'K');

                    // 3. Merchant subscription
                    const merchantSubRev = paidMerchants * merchantSubPrice;
                    setElText(`h3-merchant-sub-m${m}`, 'AED ' + (merchantSubRev / 1000).toFixed(0) + 'K');

                    // 4. Affiliate commission
                    const affiliateRev = gmv * (affiliateGmvPct / 100) * (affiliateCommission / 100);
                    setElText(`h3-affiliate-m${m}`, 'AED ' + (affiliateRev / 1000).toFixed(0) + 'K');

                    // 5. User subscription
                    const userSubRev = mau * (userSubAttach / 100) * userSubPrice;
                    setElText(`h3-user-sub-m${m}`, 'AED ' + (userSubRev / 1000).toFixed(0) + 'K');

                    // 6. Finance revenue
                    const financeRev = mau * (financeAttach / 100) * financeRevenuePerUser;
                    setElText(`h3-finance-m${m}`, 'AED ' + (financeRev / 1000).toFixed(0) + 'K');

                    // 7. B2B revenue
                    const b2bRev = gmv * (b2bGmvPct / 100) * (b2bCommission / 100);
                    setElText(`h3-b2b-m${m}`, 'AED ' + (b2bRev / 1000).toFixed(0) + 'K');

                    // Total revenue
                    setElText(`h3-revenue-m${m}`, 'AED ' + (monthlyRevenues[i] / 1000).toFixed(0) + 'K');
                    setElText(`h3-gmv-m${m}`, 'AED ' + (gmv / 1000000).toFixed(2) + 'M');

                    // Cumulative GMV
                    let cumGMV = 0;
                    for (let j = 0; j <= i; j++) {
                        cumGMV += monthlyGMVs[j];
                    }
                    setElText(`h3-cum-gmv-m${m}`, 'AED ' + (cumGMV / 1000000).toFixed(2) + 'M');

                    // EXPENSES BREAKDOWN
                    setElText(`h3-rent-m${m}`, 'AED ' + (rentBudgets[i] / 1000).toFixed(0) + 'K');
                    setElText(`h3-tech-m${m}`, 'AED ' + (techBudgets[i] / 1000).toFixed(0) + 'K');
                    setElText(`h3-ops-m${m}`, 'AED ' + (opsBudgets[i] / 1000).toFixed(0) + 'K');
                    setElText(`h3-support-m${m}`, 'AED ' + (supportBudgets[i] / 1000).toFixed(0) + 'K');
                    setElText(`h3-marketing-m${m}`, 'AED ' + (marketingBudgets[i] / 1000).toFixed(0) + 'K');
                    setElText(`h3-total-expense-m${m}`, 'AED ' + (totalExpenses[i] / 1000).toFixed(0) + 'K');

                    // NET & CASH FLOW
                    const netBurnMonth = monthlyRevenues[i] - totalExpenses[i];
                    if (netBurnMonth >= 0) {
                        setElText(`h3-net-m${m}`, '+AED ' + (netBurnMonth / 1000).toFixed(0) + 'K');
                    } else {
                        setElText(`h3-net-m${m}`, '-AED ' + (Math.abs(netBurnMonth) / 1000).toFixed(0) + 'K');
                    }

                    // Cash in hand (end of month)
                    setElText(`h3-cash-m${m}`, 'AED ' + (bankBalance[i + 1] / 1000).toFixed(0) + 'K');

                    // Budget allocated for this month
                    setElText(`h3-budget-allocated-m${m}`, 'AED ' + (monthlyBudgetAllocation[i] / 1000).toFixed(0) + 'K');

                    // Revenue allocated to future months
                    const futureAllocation = (monthlyRevenues[i] + newFunding[i]) / fundingAllocationWindow;
                    setElText(`h3-future-allocation-m${m}`, 'AED ' + (futureAllocation / 1000).toFixed(0) + 'K/mo');
                }

                // H3 TOTALS
                const h3FinalIndex = Math.min(h3EndMonthCalc - 1, actualMonthsRun - 1);
                if (h3FinalIndex >= h3StartMonth) {
                    const h3FinalMAU = mauArray[h3FinalIndex] || 0;
                    const h3FinalMerchants = merchantsArray[h3FinalIndex] || 0;

                    let h3TotalDownloads = 0;
                    let h3TotalPaidMerchants = 0;
                    let h3TotalCommission = 0;
                    let h3TotalPromoted = 0;
                    let h3TotalMerchantSub = 0;
                    let h3TotalAffiliate = 0;
                    let h3TotalUserSub = 0;
                    let h3TotalFinance = 0;
                    let h3TotalB2B = 0;
                    let h3TotalRent = 0;
                    let h3TotalTech = 0;
                    let h3TotalOps = 0;
                    let h3TotalSupport = 0;
                    let h3TotalMarketing = 0;
                    let h3TotalExpenses = 0;
                    let h3TotalRevenue = 0;
                    let h3CumGMV = 0;
                    let h3TotalFutureAllocation = 0;

                    for (let i = h3StartMonth; i <= h3FinalIndex; i++) {
                        h3TotalDownloads += newUsers[i];
                        const paidMerchants = Math.round(merchantsArray[i] * (merchantSubAttach / 100));
                        h3TotalPaidMerchants = paidMerchants; // Latest value

                        const gmv = monthlyGMVs[i];
                        const mau = mauArray[i];
                        h3TotalCommission += (gmv * (baseCommission / 100)) + (gmv * (noShareRate / 100) * (noShareBonus / 100));
                        h3TotalPromoted += gmv * (promotedGmvPct / 100) * (promotedCommission / 100);
                        h3TotalMerchantSub += paidMerchants * merchantSubPrice;
                        h3TotalAffiliate += gmv * (affiliateGmvPct / 100) * (affiliateCommission / 100);
                        h3TotalUserSub += mau * (userSubAttach / 100) * userSubPrice;
                        h3TotalFinance += mau * (financeAttach / 100) * financeRevenuePerUser;
                        h3TotalB2B += gmv * (b2bGmvPct / 100) * (b2bCommission / 100);

                        h3TotalRent += rentBudgets[i];
                        h3TotalTech += techBudgets[i];
                        h3TotalOps += opsBudgets[i];
                        h3TotalSupport += supportBudgets[i];
                        h3TotalMarketing += marketingBudgets[i];
                        h3TotalExpenses += totalExpenses[i];
                        h3TotalRevenue += monthlyRevenues[i];
                        h3CumGMV += monthlyGMVs[i];
                        h3TotalFutureAllocation += (monthlyRevenues[i] + newFunding[i]);
                    }

                    const setElText = (id, value) => {
                        const element = document.getElementById(id);
                        if (element) element.textContent = value;
                    };

                    // USER METRICS TOTALS
                    setElText('h3-new-users-total', h3TotalDownloads.toLocaleString());
                    setElText('h3-mau-total', Math.round(h3FinalMAU).toLocaleString());

                    // Cumulative downloads from start through H3
                    let cumulativeDownloadsH3 = 0;
                    for (let j = 0; j <= h3FinalIndex; j++) {
                        cumulativeDownloadsH3 += newUsers[j];
                    }
                    setElText('h3-downloads-total', cumulativeDownloadsH3.toLocaleString());

                    // MERCHANT METRICS TOTALS
                    setElText('h3-new-merchants-total', newMerchants.slice(h3StartMonth, h3FinalIndex + 1).reduce((a,b) => a+b, 0));
                    setElText('h3-merchants-total', Math.round(h3FinalMerchants));
                    setElText('h3-paid-merchants-total', h3TotalPaidMerchants);
                    setElText('h3-cities-total', locationCounts[h3FinalIndex]);

                    // Revenue breakdown totals
                    setElText('h3-commission-total', 'AED ' + (h3TotalCommission / 1000).toFixed(0) + 'K');
                    setElText('h3-promoted-total', 'AED ' + (h3TotalPromoted / 1000).toFixed(0) + 'K');
                    setElText('h3-merchant-sub-total', 'AED ' + (h3TotalMerchantSub / 1000).toFixed(0) + 'K');
                    setElText('h3-affiliate-total', 'AED ' + (h3TotalAffiliate / 1000).toFixed(0) + 'K');
                    setElText('h3-user-sub-total', 'AED ' + (h3TotalUserSub / 1000).toFixed(0) + 'K');
                    setElText('h3-finance-total', 'AED ' + (h3TotalFinance / 1000).toFixed(0) + 'K');
                    setElText('h3-b2b-total', 'AED ' + (h3TotalB2B / 1000).toFixed(0) + 'K');

                    setElText('h3-cum-gmv-total', 'AED ' + (h3CumGMV / 1000000).toFixed(2) + 'M');
                    setElText('h3-revenue-total', 'AED ' + (h3TotalRevenue / 1000).toFixed(0) + 'K');

                    // Expenses breakdown totals
                    setElText('h3-rent-total', 'AED ' + (h3TotalRent / 1000).toFixed(0) + 'K');
                    setElText('h3-tech-total', 'AED ' + (h3TotalTech / 1000).toFixed(0) + 'K');
                    setElText('h3-ops-total', 'AED ' + (h3TotalOps / 1000).toFixed(0) + 'K');
                    setElText('h3-support-total', 'AED ' + (h3TotalSupport / 1000).toFixed(0) + 'K');
                    setElText('h3-marketing-total', 'AED ' + (h3TotalMarketing / 1000).toFixed(0) + 'K');
                    setElText('h3-total-expense-total', 'AED ' + (h3TotalExpenses / 1000).toFixed(0) + 'K');

                    // Net & cash flow totals
                    const h3TotalNet = h3TotalRevenue - h3TotalExpenses;
                    if (h3TotalNet >= 0) {
                        setElText('h3-net-total', '+AED ' + (h3TotalNet / 1000).toFixed(0) + 'K');
                    } else {
                        setElText('h3-net-total', '-AED ' + (Math.abs(h3TotalNet) / 1000).toFixed(0) + 'K');
                    }

                    setElText('h3-cash-total', 'AED ' + (bankBalance[h3FinalIndex + 1] / 1000).toFixed(0) + 'K');
                    setElText('h3-future-allocation-total', 'AED ' + (h3TotalFutureAllocation / 1000).toFixed(0) + 'K');

                    // Summary
                    setElText('h3-final-mau', Math.round(h3FinalMAU).toLocaleString());
                    setElText('h3-final-merchants', Math.round(h3FinalMerchants));
                    setElText('h3-final-locations', locationCounts[h3FinalIndex]);
                    setElText('h3-final-gmv', 'AED ' + (h3CumGMV / 1000000).toFixed(2) + 'M');
                }
            }

            // Update Income Statement
            // H1 Data (already calculated above)
            const h1IncomeEndIndex = Math.min(Math.ceil(h1Months) - 1, totalMonths - 1);
            const h1MAU = mauArray[h1IncomeEndIndex] || 0;
            let h1GMV = 0, h1Revenue = 0;
            for (let i = 0; i <= h1IncomeEndIndex; i++) {
                h1GMV += monthlyGMVs[i] || 0;
                h1Revenue += monthlyRevenues[i] || 0;
            }

            document.getElementById('income-mau-h1').textContent = Math.round(h1MAU).toLocaleString();
            document.getElementById('income-gmv-h1').textContent = 'AED ' + (h1GMV/1000000).toFixed(2) + 'M';
            document.getElementById('income-revenue-h1').textContent = 'AED ' + (h1Revenue/1000).toFixed(0) + 'K';

            // H2 Data
            const h2StartIdx = Math.ceil(h1Months);
            const h2EndIdx = Math.min(Math.ceil(h1Months + h2Months) - 1, totalMonths - 1);
            if (h2EndIdx >= h2StartIdx && h2Months > 0) {
                const h2MAU = mauArray[h2EndIdx] || 0;
                let h2GMV = 0, h2Revenue = 0;
                for (let i = h2StartIdx; i <= h2EndIdx; i++) {
                    h2GMV += monthlyGMVs[i] || 0;
                    h2Revenue += monthlyRevenues[i] || 0;
                }
                // Update H2 column in Income Statement (assuming IDs exist)
                const h2Cell = document.querySelector('#income tbody tr:nth-child(2) td:nth-child(3)');
                if (h2Cell) h2Cell.textContent = Math.round(h2MAU).toLocaleString();
                const h2GMVCell = document.querySelector('#income tbody tr:nth-child(3) td:nth-child(3)');
                if (h2GMVCell) h2GMVCell.textContent = 'AED ' + (h2GMV/1000000).toFixed(2) + 'M';
                const h2RevCell = document.querySelector('#income tbody tr:nth-child(4) td:nth-child(3)');
                if (h2RevCell) h2RevCell.textContent = 'AED ' + (h2Revenue/1000).toFixed(0) + 'K';
            }

            // H3 Data
            const h3StartIdx = Math.ceil(h1Months + h2Months);
            const h3EndIdx = totalMonths - 1;
            if (h3EndIdx >= h3StartIdx && h3Months > 0) {
                const h3MAU = mauArray[h3EndIdx] || 0;
                let h3GMV = 0, h3Revenue = 0;
                for (let i = h3StartIdx; i <= h3EndIdx; i++) {
                    h3GMV += monthlyGMVs[i] || 0;
                    h3Revenue += monthlyRevenues[i] || 0;
                }
                // Update H3 column in Income Statement
                const h3Cell = document.querySelector('#income tbody tr:nth-child(2) td:nth-child(4)');
                if (h3Cell) h3Cell.textContent = Math.round(h3MAU).toLocaleString();
                const h3GMVCell = document.querySelector('#income tbody tr:nth-child(3) td:nth-child(4)');
                if (h3GMVCell) h3GMVCell.textContent = 'AED ' + (h3GMV/1000000).toFixed(2) + 'M';
                const h3RevCell = document.querySelector('#income tbody tr:nth-child(4) td:nth-child(4)');
                if (h3RevCell) h3RevCell.textContent = 'AED ' + (h3Revenue/1000).toFixed(0) + 'K';
            }

            // Use totalNetBurn calculated earlier
            document.getElementById('income-profit-h1').textContent = '-AED ' + (totalNetBurn/1000).toFixed(0) + 'K';
            document.getElementById('income-ltvcac').textContent = ltvCacRatio.toFixed(1) + 'x';

            // Update Sensitivity Analysis
            document.getElementById('sens-ltv-base').textContent = 'AED ' + ltv;
            document.getElementById('sens-cac-base').textContent = 'AED ' + cac;
            document.getElementById('sens-ratio-base').textContent = ltvCacRatio.toFixed(1) + 'x';
            document.getElementById('sens-ltv-opt').textContent = 'AED ' + ltv;
            document.getElementById('sens-cac-base2').textContent = 'AED ' + cac;
            document.getElementById('sens-ltv-base2').textContent = 'AED ' + ltv;
            document.getElementById('sens-ratio-base2').textContent = ltvCacRatio.toFixed(1) + 'x';
            document.getElementById('sens-ltv-cons').textContent = 'AED ' + ltv;
            document.getElementById('sens-ltv-pess').textContent = 'AED ' + ltv;
        }

        // Listen for messages from parent to switch tabs
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'showSheet') {
                const sheetName = event.data.sheet;
                console.log('Received showSheet message for:', sheetName);
                showSheet(sheetName);
            }
        });

        window.onload = function() {
            console.log('Financial projection content loaded');
            // Small delay to ensure all DOM elements are fully ready
            setTimeout(() => {
                updateAll();
            }, 100);
        };
    </script>
</body>
</html>
